#pragma once

#include <array>
#include <cstdint>
#include <algorithm>
#include "primitives.h"

namespace math::fp::detail {

// Arccosine lookup table with 2183 entries using multi-region approach
// Region 1: 0.0-0.8 uniform (512+1 points)
// Region 2: 0.8-0.93 Hermite interpolation (128 segments = 387 points)
// Region 3: 0.93-0.99 denser uniform (512+1 points)
// Region 4: 0.99-0.999 even denser (512+1 points)
// Region 5: 0.999-1.0 densest (256+1 points)
// Fixed-point format: Q32.32
inline constexpr std::array<int64_t, 2183> AcosLut = {
    6746518852LL, 6739807963LL, 6733097057LL, 6726386119LL, 
    6719675131LL, 6712964078LL, 6706252944LL, 6699541710LL, 
    6692830362LL, 6686118883LL, 6679407257LL, 6672695466LL, 
    6665983496LL, 6659271328LL, 6652558948LL, 6645846337LL, 
    6639133481LL, 6632420363LL, 6625706966LL, 6618993273LL, 
    6612279269LL, 6605564936LL, 6598850259LL, 6592135221LL, 
    6585419806LL, 6578703996LL, 6571987775LL, 6565271128LL, 
    6558554037LL, 6551836486LL, 6545118459LL, 6538399938LL, 
    6531680908LL, 6524961351LL, 6518241252LL, 6511520593LL, 
    6504799358LL, 6498077530LL, 6491355093LL, 6484632030LL, 
    6477908325LL, 6471183961LL, 6464458920LL, 6457733187LL, 
    6451006745LL, 6444279577LL, 6437551665LL, 6430822995LL, 
    6424093548LL, 6417363308LL, 6410632258LL, 6403900381LL, 
    6397167660LL, 6390434079LL, 6383699621LL, 6376964269LL, 
    6370228005LL, 6363490813LL, 6356752676LL, 6350013577LL, 
    6343273499LL, 6336532424LL, 6329790337LL, 6323047219LL, 
    6316303054LL, 6309557824LL, 6302811513LL, 6296064102LL, 
    6289315576LL, 6282565917LL, 6275815107LL, 6269063129LL, 
    6262309966LL, 6255555601LL, 6248800016LL, 6242043194LL, 
    6235285117LL, 6228525769LL, 6221765130LL, 6215003185LL, 
    6208239916LL, 6201475304LL, 6194709333LL, 6187941984LL, 
    6181173241LL, 6174403084LL, 6167631498LL, 6160858464LL, 
    6154083963LL, 6147307979LL, 6140530494LL, 6133751489LL, 
    6126970946LL, 6120188849LL, 6113405178LL, 6106619916LL, 
    6099833044LL, 6093044545LL, 6086254401LL, 6079462592LL, 
    6072669102LL, 6065873911LL, 6059077002LL, 6052278355LL, 
    6045477954LL, 6038675778LL, 6031871811LL, 6025066033LL, 
    6018258425LL, 6011448970LL, 6004637648LL, 5997824441LL, 
    5991009330LL, 5984192297LL, 5977373322LL, 5970552387LL, 
    5963729472LL, 5956904559LL, 5950077629LL, 5943248663LL, 
    5936417642LL, 5929584546LL, 5922749356LL, 5915912053LL, 
    5909072618LL, 5902231031LL, 5895387274LL, 5888541325LL, 
    5881693167LL, 5874842779LL, 5867990142LL, 5861135236LL, 
    5854278042LL, 5847418539LL, 5840556708LL, 5833692528LL, 
    5826825981LL, 5819957045LL, 5813085701LL, 5806211929LL, 
    5799335708LL, 5792457019LL, 5785575840LL, 5778692152LL, 
    5771805933LL, 5764917164LL, 5758025825LL, 5751131893LL, 
    5744235349LL, 5737336172LL, 5730434340LL, 5723529834LL, 
    5716622632LL, 5709712712LL, 5702800055LL, 5695884638LL, 
    5688966441LL, 5682045442LL, 5675121620LL, 5668194953LL, 
    5661265420LL, 5654332998LL, 5647397667LL, 5640459405LL, 
    5633518190LL, 5626573999LL, 5619626811LL, 5612676604LL, 
    5605723356LL, 5598767044LL, 5591807646LL, 5584845139LL, 
    5577879502LL, 5570910711LL, 5563938744LL, 5556963578LL, 
    5549985191LL, 5543003559LL, 5536018659LL, 5529030469LL, 
    5522038965LL, 5515044123LL, 5508045921LL, 5501044336LL, 
    5494039342LL, 5487030918LL, 5480019038LL, 5473003680LL, 
    5465984819LL, 5458962432LL, 5451936493LL, 5444906980LL, 
    5437873867LL, 5430837131LL, 5423796746LL, 5416752689LL, 
    5409704933LL, 5402653456LL, 5395598230LL, 5388539233LL, 
    5381476437LL, 5374409819LL, 5367339353LL, 5360265013LL, 
    5353186773LL, 5346104608LL, 5339018493LL, 5331928400LL, 
    5324834305LL, 5317736181LL, 5310634001LL, 5303527739LL, 
    5296417370LL, 5289302865LL, 5282184198LL, 5275061343LL, 
    5267934272LL, 5260802959LL, 5253667375LL, 5246527493LL, 
    5239383287LL, 5232234728LL, 5225081788LL, 5217924440LL, 
    5210762656LL, 5203596406LL, 5196425664LL, 5189250400LL, 
    5182070585LL, 5174886192LL, 5167697191LL, 5160503552LL, 
    5153305248LL, 5146102248LL, 5138894523LL, 5131682043LL, 
    5124464779LL, 5117242701LL, 5110015778LL, 5102783980LL, 
    5095547277LL, 5088305638LL, 5081059032LL, 5073807429LL, 
    5066550798LL, 5059289107LL, 5052022324LL, 5044750419LL, 
    5037473360LL, 5030191114LL, 5022903649LL, 5015610934LL, 
    5008312936LL, 5001009622LL, 4993700959LL, 4986386915LL, 
    4979067456LL, 4971742549LL, 4964412161LL, 4957076257LL, 
    4949734804LL, 4942387767LL, 4935035113LL, 4927676807LL, 
    4920312813LL, 4912943098LL, 4905567627LL, 4898186363LL, 
    4890799271LL, 4883406316LL, 4876007461LL, 4868602671LL, 
    4861191909LL, 4853775138LL, 4846352322LL, 4838923424LL, 
    4831488407LL, 4824047232LL, 4816599862LL, 4809146260LL, 
    4801686386LL, 4794220204LL, 4786747673LL, 4779268755LL, 
    4771783412LL, 4764291603LL, 4756793289LL, 4749288430LL, 
    4741776986LL, 4734258916LL, 4726734180LL, 4719202738LL, 
    4711664547LL, 4704119566LL, 4696567754LL, 4689009068LL, 
    4681443467LL, 4673870907LL, 4666291346LL, 4658704741LL, 
    4651111049LL, 4643510225LL, 4635902225LL, 4628287006LL, 
    4620664523LL, 4613034730LL, 4605397584LL, 4597753037LL, 
    4590101044LL, 4582441560LL, 4574774537LL, 4567099929LL, 
    4559417689LL, 4551727769LL, 4544030121LL, 4536324697LL, 
    4528611450LL, 4520890329LL, 4513161286LL, 4505424271LL, 
    4497679234LL, 4489926126LL, 4482164895LL, 4474395490LL, 
    4466617860LL, 4458831954LL, 4451037718LL, 4443235101LL, 
    4435424050LL, 4427604511LL, 4419776431LL, 4411939755LL, 
    4404094429LL, 4396240397LL, 4388377606LL, 4380505998LL, 
    4372625517LL, 4364736107LL, 4356837711LL, 4348930271LL, 
    4341013728LL, 4333088025LL, 4325153103LL, 4317208902LL, 
    4309255362LL, 4301292423LL, 4293320024LL, 4285338103LL, 
    4277346599LL, 4269345450LL, 4261334592LL, 4253313962LL, 
    4245283496LL, 4237243130LL, 4229192798LL, 4221132436LL, 
    4213061977LL, 4204981354LL, 4196890501LL, 4188789349LL, 
    4180677830LL, 4172555875LL, 4164423415LL, 4156280379LL, 
    4148126698LL, 4139962298LL, 4131787109LL, 4123601057LL, 
    4115404070LL, 4107196074LL, 4098976994LL, 4090746754LL, 
    4082505279LL, 4074252492LL, 4065988316LL, 4057712674LL, 
    4049425485LL, 4041126671LL, 4032816151LL, 4024493845LL, 
    4016159671LL, 4007813547LL, 3999455389LL, 3991085113LL, 
    3982702635LL, 3974307868LL, 3965900727LL, 3957481125LL, 
    3949048972LL, 3940604181LL, 3932146662LL, 3923676323LL, 
    3915193073LL, 3906696820LL, 3898187471LL, 3889664931LL, 
    3881129104LL, 3872579895LL, 3864017207LL, 3855440940LL, 
    3846850997LL, 3838247277LL, 3829629679LL, 3820998100LL, 
    3812352438LL, 3803692587LL, 3795018443LL, 3786329898LL, 
    3777626846LL, 3768909177LL, 3760176781LL, 3751429548LL, 
    3742667364LL, 3733890116LL, 3725097690LL, 3716289970LL, 
    3707466837LL, 3698628174LL, 3689773860LL, 3680903774LL, 
    3672017794LL, 3663115795LL, 3654197653LL, 3645263240LL, 
    3636312428LL, 3627345088LL, 3618361088LL, 3609360295LL, 
    3600342575LL, 3591307793LL, 3582255811LL, 3573186490LL, 
    3564099688LL, 3554995265LL, 3545873075LL, 3536732973LL, 
    3527574812LL, 3518398442LL, 3509203711LL, 3499990467LL, 
    3490758555LL, 3481507818LL, 3472238097LL, 3462949232LL, 
    3453641059LL, 3444313413LL, 3434966129LL, 3425599035LL, 
    3416211962LL, 3406804736LL, 3397377181LL, 3387929118LL, 
    3378460368LL, 3368970747LL, 3359460071LL, 3349928151LL, 
    3340374797LL, 3330799817LL, 3321203015LL, 3311584193LL, 
    3301943150LL, 3292279682LL, 3282593583LL, 3272884644LL, 
    3263152652LL, 3253397392LL, 3243618646LL, 3233816192LL, 
    3223989805LL, 3214139257LL, 3204264318LL, 3194364751LL, 
    3184440320LL, 3174490783LL, 3164515894LL, 3154515404LL, 
    3144489060LL, 3134436606LL, 3124357781LL, 3114252322LL, 
    3104119958LL, 3093960417LL, 3083773422LL, 3073558691LL, 
    3063315939LL, 3053044875LL, 3042745203LL, 3032416623LL, 
    3022058830LL, 3011671515LL, 3001254362LL, 2990807050LL, 
    2980329255LL, 2969820643LL, 2959280880LL, 2948709621LL, 
    2938106518LL, 2927471216LL, 2916803355LL, 2906102567LL, 
    2895368479LL, 2884600709LL, 2873798871LL, 2862962569LL, 
    2852091403LL, 2841184963LL, 2830242833LL, 2819264588LL, 
    2808249796LL, 2797198017LL, 2786108800LL, 2774981689LL, 
    2763816217LL, 3435973836LL, 2763816217LL, -7158278826LL, 
    3440335912LL, 2756537864LL, -7174499890LL, 3444697989LL, 
    2749242969LL, -7190852520LL, 3449060065LL, 2741931399LL, 
    -7207338414LL, 3453422141LL, 2734603017LL, -7223959298LL, 
    3457784217LL, 2727257686LL, -7240716931LL, 3462146293LL, 
    2719895264LL, -7257613102LL, 3466508369LL, 2712515612LL, 
    -7274649637LL, 3470870446LL, 2705118584LL, -7291828392LL, 
    3475232522LL, 2697704036LL, -7309151260LL, 3479594598LL, 
    2690271821LL, -7326620169LL, 3483956674LL, 2682821789LL, 
    -7344237082LL, 3488318750LL, 2675353789LL, -7362004001LL, 
    3492680826LL, 2667867667LL, -7379922966LL, 3497042903LL, 
    2660363268LL, -7397996055LL, 3501404979LL, 2652840435LL, 
    -7416225385LL, 3505767055LL, 2645299007LL, -7434613119LL, 
    3510129131LL, 2637738822LL, -7453161455LL, 3514491207LL, 
    2630159717LL, -7471872641LL, 3518853283LL, 2622561525LL, 
    -7490748964LL, 3523215360LL, 2614944077LL, -7509792759LL, 
    3527577436LL, 2607307201LL, -7529006407LL, 3531939512LL, 
    2599650724LL, -7548392337LL, 3536301588LL, 2591974470LL, 
    -7567953025LL, 3540663664LL, 2584278260LL, -7587691000LL, 
    3545025740LL, 2576561912LL, -7607608841LL, 3549387816LL, 
    2568825242LL, -7627709180LL, 3553749893LL, 2561068065LL, 
    -7647994703LL, 3558111969LL, 2553290189LL, -7668468152LL, 
    3562474045LL, 2545491424LL, -7689132328LL, 3566836121LL, 
    2537671574LL, -7709990087LL, 3571198197LL, 2529830440LL, 
    -7731044348LL, 3575560273LL, 2521967822LL, -7752298092LL, 
    3579922350LL, 2514083516LL, -7773754362LL, 3584284426LL, 
    2506177314LL, -7795416269LL, 3588646502LL, 2498249006LL, 
    -7817286989LL, 3593008578LL, 2490298378LL, -7839369768LL, 
    3597370654LL, 2482325213LL, -7861667923LL, 3601732730LL, 
    2474329291LL, -7884184844LL, 3606094807LL, 2466310388LL, 
    -7906923997LL, 3610456883LL, 2458268275LL, -7929888924LL, 
    3614818959LL, 2450202723LL, -7953083248LL, 3619181035LL, 
    2442113496LL, -7976510673LL, 3623543111LL, 2434000356LL, 
    -8000174988LL, 3627905187LL, 2425863059LL, -8024080067LL, 
    3632267264LL, 2417701360LL, -8048229875LL, 3636629340LL, 
    2409515008LL, -8072628469LL, 3640991416LL, 2401303748LL, 
    -8097280001LL, 3645353492LL, 2393067321LL, -8122188718LL, 
    3649715568LL, 2384805464LL, -8147358971LL, 3654077644LL, 
    2376517908LL, -8172795213LL, 3658439720LL, 2368204382LL, 
    -8198502004LL, 3662801797LL, 2359864608LL, -8224484014LL, 
    3667163873LL, 2351498304LL, -8250746027LL, 3671525949LL, 
    2343105183LL, -8277292944LL, 3675888025LL, 2334684954LL, 
    -8304129787LL, 3680250101LL, 2326237320LL, -8331261703LL, 
    3684612177LL, 2317761977LL, -8358693967LL, 3688974254LL, 
    2309258619LL, -8386431987LL, 3693336330LL, 2300726932LL, 
    -8414481310LL, 3697698406LL, 2292166597LL, -8442847622LL, 
    3702060482LL, 2283577289LL, -8471536759LL, 3706422558LL, 
    2274958676LL, -8500554704LL, 3710784634LL, 2266310423LL, 
    -8529907600LL, 3715146711LL, 2257632186LL, -8559601751LL, 
    3719508787LL, 2248923615LL, -8589643626LL, 3723870863LL, 
    2240184352LL, -8620039871LL, 3728232939LL, 2231414036LL, 
    -8650797307LL, 3732595015LL, 2222612296LL, -8681922942LL, 
    3736957091LL, 2213778753LL, -8713423976LL, 3741319168LL, 
    2204913024LL, -8745307807LL, 3745681244LL, 2196014715LL, 
    -8777582040LL, 3750043320LL, 2187083425LL, -8810254489LL, 
    3754405396LL, 2178118748LL, -8843333194LL, 3758767472LL, 
    2169120265LL, -8876826421LL, 3763129548LL, 2160087551LL, 
    -8910742672LL, 3767491624LL, 2151020172LL, -8945090697LL, 
    3771853701LL, 2141917686LL, -8979879502LL, 3776215777LL, 
    2132779640LL, -9015118356LL, 3780577853LL, 2123605571LL, 
    -9050816803LL, 3784939929LL, 2114395009LL, -9086984675LL, 
    3789302005LL, 2105147471LL, -9123632097LL, 3793664081LL, 
    2095862466LL, -9160769506LL, 3798026158LL, 2086539489LL, 
    -9198407658LL, 3802388234LL, 2077178027LL, -9236557640LL, 
    3806750310LL, 2067777554LL, -9275230889LL, 3811112386LL, 
    2058337533LL, -9314439200LL, 3815474462LL, 2048857414LL, 
    -9354194746LL, 3819836538LL, 2039336635LL, -9394510088LL, 
    3824198615LL, 2029774622LL, -9435398196LL, 3828560691LL, 
    2020170784LL, -9476872462LL, 3832922767LL, 2010524521LL, 
    -9518946724LL, 3837284843LL, 2000835216LL, -9561635278LL, 
    3841646919LL, 1991102237LL, -9604952901LL, 3846008995LL, 
    1981324937LL, -9648914875LL, 3850371072LL, 1971502655LL, 
    -9693537002LL, 3854733148LL, 1961634711LL, -9738835636LL, 
    3859095224LL, 1951720410LL, -9784827700LL, 3863457300LL, 
    1941759039LL, -9831530716LL, 3867819376LL, 1931749867LL, 
    -9878962832LL, 3872181452LL, 1921692143LL, -9927142850LL, 
    3876543528LL, 1911585098LL, -9976090258LL, 3880905605LL, 
    1901427943LL, -10025825261LL, 3885267681LL, 1891219867LL, 
    -10076368817LL, 3889629757LL, 1880960037LL, -10127742669LL, 
    3893991833LL, 1870647601LL, -10179969392LL, 3898353909LL, 
    1860281678LL, -10233072426LL, 3902715985LL, 1849861367LL, 
    -10287076120LL, 3907078062LL, 1839385741LL, -10342005784LL, 
    3911440138LL, 1828853846LL, -10397887731LL, 3915802214LL, 
    1818264700LL, -10454749333LL, 3920164290LL, 1807617295LL, 
    -10512619075LL, 3924526366LL, 1796910591LL, -10571526615LL, 
    3928888442LL, 1786143520LL, -10631502843LL, 3933250519LL, 
    1775314978LL, -10692579954LL, 3937612595LL, 1764423833LL, 
    -10754791514LL, 3941974671LL, 1753468912LL, -10818172537LL, 
    3946336747LL, 1742449011LL, -10882759570LL, 3950698823LL, 
    1731362886LL, -10948590776LL, 3955060899LL, 1720209252LL, 
    -11015706029LL, 3959422976LL, 1708986784LL, -11084147012LL, 
    3963785052LL, 1697694114LL, -11153957329LL, 3968147128LL, 
    1686329829LL, -11225182612LL, 3972509204LL, 1674892467LL, 
    -11297870653LL, 3976871280LL, 1663380517LL, -11372071529LL, 
    3981233356LL, 1651792417LL, -11447837750LL, 3985595432LL, 
    1640126548LL, -11525224411LL, 3989957509LL, 1628381237LL, 
    -11604289356LL, 3994319585LL, 1616554747LL, -11685093363LL, 
    1616554747LL, 1615184847LL, 1613813840LL, 1612441723LL, 
    1611068492LL, 1609694145LL, 1608318680LL, 1606942093LL, 
    1605564381LL, 1604185542LL, 1602805572LL, 1601424469LL, 
    1600042230LL, 1598658851LL, 1597274330LL, 1595888664LL, 
    1594501849LL, 1593113884LL, 1591724764LL, 1590334487LL, 
    1588943050LL, 1587550449LL, 1586156682LL, 1584761746LL, 
    1583365636LL, 1581968352LL, 1580569888LL, 1579170242LL, 
    1577769411LL, 1576367392LL, 1574964182LL, 1573559776LL, 
    1572154173LL, 1570747369LL, 1569339361LL, 1567930145LL, 
    1566519718LL, 1565108077LL, 1563695218LL, 1562281139LL, 
    1560865836LL, 1559449305LL, 1558031544LL, 1556612549LL, 
    1555192316LL, 1553770842LL, 1552348124LL, 1550924158LL, 
    1549498941LL, 1548072470LL, 1546644740LL, 1545215749LL, 
    1543785492LL, 1542353967LL, 1540921170LL, 1539487097LL, 
    1538051745LL, 1536615110LL, 1535177188LL, 1533737976LL, 
    1532297471LL, 1530855668LL, 1529412563LL, 1527968155LL, 
    1526522437LL, 1525075407LL, 1523627062LL, 1522177396LL, 
    1520726407LL, 1519274091LL, 1517820444LL, 1516365461LL, 
    1514909140LL, 1513451476LL, 1511992466LL, 1510532105LL, 
    1509070390LL, 1507607316LL, 1506142880LL, 1504677078LL, 
    1503209905LL, 1501741358LL, 1500271433LL, 1498800125LL, 
    1497327431LL, 1495853346LL, 1494377866LL, 1492900988LL, 
    1491422706LL, 1489943017LL, 1488461917LL, 1486979401LL, 
    1485495465LL, 1484010106LL, 1482523317LL, 1481035096LL, 
    1479545438LL, 1478054338LL, 1476561793LL, 1475067797LL, 
    1473572347LL, 1472075438LL, 1470577065LL, 1469077224LL, 
    1467575911LL, 1466073121LL, 1464568849LL, 1463063091LL, 
    1461555842LL, 1460047097LL, 1458536853LL, 1457025104LL, 
    1455511846LL, 1453997073LL, 1452480782LL, 1450962967LL, 
    1449443624LL, 1447922747LL, 1446400332LL, 1444876375LL, 
    1443350869LL, 1441823811LL, 1440295195LL, 1438765016LL, 
    1437233270LL, 1435699951LL, 1434165054LL, 1432628575LL, 
    1431090507LL, 1429550847LL, 1428009588LL, 1426466726LL, 
    1424922255LL, 1423376170LL, 1421828466LL, 1420279138LL, 
    1418728180LL, 1417175587LL, 1415621354LL, 1414065474LL, 
    1412507943LL, 1410948756LL, 1409387906LL, 1407825388LL, 
    1406261196LL, 1404695326LL, 1403127771LL, 1401558526LL, 
    1399987584LL, 1398414941LL, 1396840591LL, 1395264527LL, 
    1393686744LL, 1392107236LL, 1390525997LL, 1388943022LL, 
    1387358303LL, 1385771837LL, 1384183615LL, 1382593633LL, 
    1381001883LL, 1379408361LL, 1377813060LL, 1376215974LL, 
    1374617095LL, 1373016420LL, 1371413939LL, 1369809649LL, 
    1368203542LL, 1366595611LL, 1364985851LL, 1363374255LL, 
    1361760816LL, 1360145527LL, 1358528383LL, 1356909376LL, 
    1355288500LL, 1353665749LL, 1352041114LL, 1350414590LL, 
    1348786170LL, 1347155846LL, 1345523613LL, 1343889462LL, 
    1342253388LL, 1340615382LL, 1338975438LL, 1337333548LL, 
    1335689706LL, 1334043904LL, 1332396135LL, 1330746392LL, 
    1329094667LL, 1327440953LL, 1325785243LL, 1324127528LL, 
    1322467802LL, 1320806056LL, 1319142284LL, 1317476477LL, 
    1315808628LL, 1314138729LL, 1312466772LL, 1310792749LL, 
    1309116652LL, 1307438474LL, 1305758206LL, 1304075841LL, 
    1302391369LL, 1300704784LL, 1299016076LL, 1297325237LL, 
    1295632260LL, 1293937135LL, 1292239854LL, 1290540409LL, 
    1288838791LL, 1287134991LL, 1285429001LL, 1283720812LL, 
    1282010415LL, 1280297802LL, 1278582963LL, 1276865890LL, 
    1275146573LL, 1273425004LL, 1271701173LL, 1269975070LL, 
    1268246688LL, 1266516016LL, 1264783044LL, 1263047765LL, 
    1261310167LL, 1259570241LL, 1257827979LL, 1256083369LL, 
    1254336402LL, 1252587069LL, 1250835359LL, 1249081262LL, 
    1247324769LL, 1245565869LL, 1243804552LL, 1242040807LL, 
    1240274624LL, 1238505994LL, 1236734905LL, 1234961346LL, 
    1233185308LL, 1231406778LL, 1229625748LL, 1227842205LL, 
    1226056138LL, 1224267538LL, 1222476391LL, 1220682688LL, 
    1218886417LL, 1217087567LL, 1215286126LL, 1213482082LL, 
    1211675424LL, 1209866140LL, 1208054219LL, 1206239649LL, 
    1204422417LL, 1202602511LL, 1200779920LL, 1198954631LL, 
    1197126631LL, 1195295909LL, 1193462451LL, 1191626246LL, 
    1189787280LL, 1187945541LL, 1186101015LL, 1184253690LL, 
    1182403552LL, 1180550588LL, 1178694786LL, 1176836131LL, 
    1174974609LL, 1173110208LL, 1171242914LL, 1169372712LL, 
    1167499589LL, 1165623530LL, 1163744522LL, 1161862550LL, 
    1159977600LL, 1158089656LL, 1156198705LL, 1154304732LL, 
    1152407721LL, 1150507658LL, 1148604527LL, 1146698314LL, 
    1144789002LL, 1142876577LL, 1140961023LL, 1139042323LL, 
    1137120462LL, 1135195424LL, 1133267193LL, 1131335752LL, 
    1129401084LL, 1127463174LL, 1125522005LL, 1123577559LL, 
    1121629820LL, 1119678769LL, 1117724391LL, 1115766668LL, 
    1113805581LL, 1111841113LL, 1109873246LL, 1107901962LL, 
    1105927243LL, 1103949070LL, 1101967425LL, 1099982289LL, 
    1097993642LL, 1096001466LL, 1094005742LL, 1092006450LL, 
    1090003570LL, 1087997083LL, 1085986968LL, 1083973206LL, 
    1081955775LL, 1079934656LL, 1077909828LL, 1075881270LL, 
    1073848960LL, 1071812877LL, 1069773001LL, 1067729308LL, 
    1065681777LL, 1063630385LL, 1061575112LL, 1059515933LL, 
    1057452826LL, 1055385768LL, 1053314735LL, 1051239705LL, 
    1049160653LL, 1047077556LL, 1044990389LL, 1042899128LL, 
    1040803748LL, 1038704225LL, 1036600532LL, 1034492645LL, 
    1032380538LL, 1030264185LL, 1028143559LL, 1026018635LL, 
    1023889385LL, 1021755783LL, 1019617800LL, 1017475410LL, 
    1015328585LL, 1013177296LL, 1011021514LL, 1008861212LL, 
    1006696360LL, 1004526928LL, 1002352887LL, 1000174206LL, 
    997990856LL, 995802805LL, 993610023LL, 991412478LL, 
    989210138LL, 987002972LL, 984790946LL, 982574028LL, 
    980352185LL, 978125383LL, 975893589LL, 973656767LL, 
    971414883LL, 969167903LL, 966915790LL, 964658508LL, 
    962396022LL, 960128294LL, 957855287LL, 955576963LL, 
    953293285LL, 951004213LL, 948709709LL, 946409733LL, 
    944104245LL, 941793205LL, 939476572LL, 937154304LL, 
    934826359LL, 932492695LL, 930153268LL, 927808035LL, 
    925456952LL, 923099974LL, 920737056LL, 918368152LL, 
    915993216LL, 913612200LL, 911225057LL, 908831739LL, 
    906432196LL, 904026379LL, 901614238LL, 899195722LL, 
    896770779LL, 894339357LL, 891901403LL, 889456864LL, 
    887005684LL, 884547809LL, 882083183LL, 879611749LL, 
    877133449LL, 874648225LL, 872156017LL, 869656767LL, 
    867150412LL, 864636892LL, 862116142LL, 859588101LL, 
    857052702LL, 854509882LL, 851959572LL, 849401707LL, 
    846836217LL, 844263032LL, 841682083LL, 839093297LL, 
    836496602LL, 833891924LL, 831279188LL, 828658317LL, 
    826029234LL, 823391861LL, 820746118LL, 818091923LL, 
    815429193LL, 812757846LL, 810077795LL, 807388954LL, 
    804691235LL, 801984549LL, 799268803LL, 796543906LL, 
    793809763LL, 791066278LL, 788313354LL, 785550892LL, 
    782778790LL, 779996946LL, 777205255LL, 774403611LL, 
    771591905LL, 768770026LL, 765937863LL, 763095301LL, 
    760242223LL, 757378511LL, 754504042LL, 751618694LL, 
    748722342LL, 745814856LL, 742896106LL, 739965959LL, 
    737024278LL, 734070926LL, 731105760LL, 728128637LL, 
    725139409LL, 722137926LL, 719124034LL, 716097576LL, 
    713058393LL, 710006321LL, 706941194LL, 703862840LL, 
    700771085LL, 697665751LL, 694546657LL, 691413615LL, 
    688266435LL, 685104923LL, 681928879LL, 678738099LL, 
    675532374LL, 672311491LL, 669075230LL, 665823368LL, 
    662555673LL, 659271913LL, 655971843LL, 652655219LL, 
    649321785LL, 645971281LL, 642603441LL, 639217991LL, 
    635814648LL, 632393125LL, 628953124LL, 625494341LL, 
    622016463LL, 618519166LL, 615002120LL, 611464985LL, 
    607907409LL, 607907409LL, 607371987LL, 606836096LL, 
    606299735LL, 605762902LL, 605225595LL, 604687815LL, 
    604149559LL, 603610826LL, 603071616LL, 602531926LL, 
    601991755LL, 601451102LL, 600909966LL, 600368345LL, 
    599826239LL, 599283645LL, 598740563LL, 598196991LL, 
    597652928LL, 597108372LL, 596563323LL, 596017778LL, 
    595471736LL, 594925197LL, 594378158LL, 593830619LL, 
    593282578LL, 592734033LL, 592184983LL, 591635427LL, 
    591085363LL, 590534790LL, 589983706LL, 589432111LL, 
    588880002LL, 588327378LL, 587774238LL, 587220580LL, 
    586666403LL, 586111705LL, 585556485LL, 585000741LL, 
    584444472LL, 583887677LL, 583330353LL, 582772500LL, 
    582214115LL, 581655197LL, 581095746LL, 580535758LL, 
    579975233LL, 579414169LL, 578852565LL, 578290418LL, 
    577727728LL, 577164493LL, 576600710LL, 576036380LL, 
    575471499LL, 574906066LL, 574340080LL, 573773539LL, 
    573206442LL, 572638786LL, 572070570LL, 571501793LL, 
    570932453LL, 570362547LL, 569792075LL, 569221034LL, 
    568649424LL, 568077241LL, 567504485LL, 566931154LL, 
    566357246LL, 565782759LL, 565207691LL, 564632042LL, 
    564055808LL, 563478988LL, 562901580LL, 562323583LL, 
    561744995LL, 561165814LL, 560586037LL, 560005664LL, 
    559424692LL, 558843120LL, 558260945LL, 557678165LL, 
    557094780LL, 556510786LL, 555926183LL, 555340967LL, 
    554755138LL, 554168692LL, 553581629LL, 552993946LL, 
    552405642LL, 551816713LL, 551227159LL, 550636977LL, 
    550046166LL, 549454722LL, 548862645LL, 548269932LL, 
    547676581LL, 547082589LL, 546487956LL, 545892679LL, 
    545296755LL, 544700182LL, 544102960LL, 543505084LL, 
    542906553LL, 542307366LL, 541707519LL, 541107011LL, 
    540505839LL, 539904001LL, 539301495LL, 538698319LL, 
    538094471LL, 537489947LL, 536884746LL, 536278866LL, 
    535672304LL, 535065059LL, 534457126LL, 533848505LL, 
    533239193LL, 532629188LL, 532018487LL, 531407087LL, 
    530794987LL, 530182184LL, 529568675LL, 528954459LL, 
    528339531LL, 527723891LL, 527107536LL, 526490463LL, 
    525872669LL, 525254152LL, 524634909LL, 524014939LL, 
    523394238LL, 522772803LL, 522150633LL, 521527724LL, 
    520904073LL, 520279679LL, 519654538LL, 519028648LL, 
    518402006LL, 517774610LL, 517146456LL, 516517541LL, 
    515887864LL, 515257421LL, 514626209LL, 513994226LL, 
    513361468LL, 512727934LL, 512093619LL, 511458521LL, 
    510822638LL, 510185966LL, 509548501LL, 508910243LL, 
    508271186LL, 507631329LL, 506990668LL, 506349200LL, 
    505706922LL, 505063831LL, 504419925LL, 503775198LL, 
    503129650LL, 502483276LL, 501836073LL, 501188039LL, 
    500539169LL, 499889460LL, 499238910LL, 498587515LL, 
    497935272LL, 497282177LL, 496628227LL, 495973419LL, 
    495317749LL, 494661213LL, 494003809LL, 493345533LL, 
    492686381LL, 492026350LL, 491365437LL, 490703637LL, 
    490040947LL, 489377363LL, 488712883LL, 488047502LL, 
    487381216LL, 486714022LL, 486045916LL, 485376895LL, 
    484706954LL, 484036090LL, 483364298LL, 482691576LL, 
    482017919LL, 481343322LL, 480667783LL, 479991298LL, 
    479313861LL, 478635470LL, 477956120LL, 477275806LL, 
    476594526LL, 475912274LL, 475229047LL, 474544841LL, 
    473859650LL, 473173471LL, 472486300LL, 471798132LL, 
    471108963LL, 470418788LL, 469727603LL, 469035404LL, 
    468342186LL, 467647944LL, 466952674LL, 466256372LL, 
    465559032LL, 464860650LL, 464161222LL, 463460742LL, 
    462759206LL, 462056609LL, 461352946LL, 460648212LL, 
    459942403LL, 459235513LL, 458527537LL, 457818471LL, 
    457108309LL, 456397046LL, 455684677LL, 454971197LL, 
    454256601LL, 453540883LL, 452824038LL, 452106060LL, 
    451386945LL, 450666686LL, 449945279LL, 449222718LL, 
    448498996LL, 447774110LL, 447048052LL, 446320817LL, 
    445592399LL, 444862794LL, 444131993LL, 443399993LL, 
    442666787LL, 441932368LL, 441196731LL, 440459870LL, 
    439721779LL, 438982451LL, 438241880LL, 437500059LL, 
    436756984LL, 436012646LL, 435267039LL, 434520158LL, 
    433771995LL, 433022544LL, 432271798LL, 431519750LL, 
    430766393LL, 430011721LL, 429255727LL, 428498404LL, 
    427739744LL, 426979741LL, 426218386LL, 425455674LL, 
    424691597LL, 423926147LL, 423159317LL, 422391099LL, 
    421621486LL, 420850470LL, 420078044LL, 419304199LL, 
    418528928LL, 417752223LL, 416974075LL, 416194478LL, 
    415413422LL, 414630899LL, 413846901LL, 413061419LL, 
    412274446LL, 411485972LL, 410695990LL, 409904489LL, 
    409111462LL, 408316899LL, 407520792LL, 406723131LL, 
    405923907LL, 405123111LL, 404320734LL, 403516767LL, 
    402711199LL, 401904021LL, 401095223LL, 400284796LL, 
    399472730LL, 398659014LL, 397843638LL, 397026593LL, 
    396207868LL, 395387453LL, 394565336LL, 393741508LL, 
    392915957LL, 392088673LL, 391259644LL, 390428860LL, 
    389596310LL, 388761981LL, 387925863LL, 387087943LL, 
    386248211LL, 385406654LL, 384563261LL, 383718019LL, 
    382870915LL, 382021939LL, 381171076LL, 380318315LL, 
    379463643LL, 378607046LL, 377748512LL, 376888027LL, 
    376025578LL, 375161152LL, 374294734LL, 373426311LL, 
    372555869LL, 371683394LL, 370808870LL, 369932285LL, 
    369053623LL, 368172869LL, 367290008LL, 366405025LL, 
    365517905LL, 364628631LL, 363737189LL, 362843562LL, 
    361947734LL, 361049688LL, 360149408LL, 359246878LL, 
    358342080LL, 357434996LL, 356525610LL, 355613905LL, 
    354699861LL, 353783460LL, 352864686LL, 351943518LL, 
    351019938LL, 350093928LL, 349165467LL, 348234535LL, 
    347301114LL, 346365184LL, 345426722LL, 344485710LL, 
    343542126LL, 342595948LL, 341647156LL, 340695726LL, 
    339741639LL, 338784869LL, 337825396LL, 336863196LL, 
    335898245LL, 334930519LL, 333959996LL, 332986649LL, 
    332010454LL, 331031387LL, 330049420LL, 329064530LL, 
    328076688LL, 327085869LL, 326092045LL, 325095189LL, 
    324095273LL, 323092268LL, 322086146LL, 321076876LL, 
    320064431LL, 319048778LL, 318029888LL, 317007728LL, 
    315982269LL, 314953477LL, 313921319LL, 312885762LL, 
    311846773LL, 310804317LL, 309758358LL, 308708862LL, 
    307655792LL, 306599111LL, 305538782LL, 304474767LL, 
    303407026LL, 302335521LL, 301260212LL, 300181056LL, 
    299098014LL, 298011042LL, 296920097LL, 295825135LL, 
    294726112LL, 293622982LL, 292515698LL, 291404213LL, 
    290288479LL, 289168447LL, 288044066LL, 286915286LL, 
    285782053LL, 284644316LL, 283502020LL, 282355109LL, 
    281203528LL, 280047217LL, 278886120LL, 277720175LL, 
    276549321LL, 275373495LL, 274192635LL, 273006674LL, 
    271815545LL, 270619181LL, 269417511LL, 268210464LL, 
    266997968LL, 265779948LL, 264556327LL, 263327028LL, 
    262091970LL, 260851071LL, 259604249LL, 258351417LL, 
    257092487LL, 255827370LL, 254555972LL, 253278200LL, 
    251993957LL, 250703142LL, 249405655LL, 248101390LL, 
    246790240LL, 245472094LL, 244146840LL, 242814360LL, 
    241474536LL, 240127244LL, 238772358LL, 237409747LL, 
    236039279LL, 234660816LL, 233274215LL, 231879330LL, 
    230476012LL, 229064105LL, 227643450LL, 226213882LL, 
    224775230LL, 223327319LL, 221869968LL, 220402989LL, 
    218926189LL, 217439369LL, 215942320LL, 214434829LL, 
    212916673LL, 211387624LL, 209847443LL, 208295883LL, 
    206732687LL, 205157591LL, 203570317LL, 201970579LL, 
    200358077LL, 198732502LL, 197093530LL, 195440823LL, 
    193774031LL, 192092786LL, 192092786LL, 191717175LL, 
    191340828LL, 190963739LL, 190585905LL, 190207320LL, 
    189827981LL, 189447883LL, 189067021LL, 188685391LL, 
    188302988LL, 187919808LL, 187535845LL, 187151095LL, 
    186765552LL, 186379213LL, 185992071LL, 185604123LL, 
    185215363LL, 184825785LL, 184435385LL, 184044157LL, 
    183652097LL, 183259198LL, 182865455LL, 182470864LL, 
    182075417LL, 181679111LL, 181281939LL, 180883895LL, 
    180484973LL, 180085169LL, 179684476LL, 179282887LL, 
    178880398LL, 178477001LL, 178072691LL, 177667462LL, 
    177261306LL, 176854219LL, 176446193LL, 176037221LL, 
    175627298LL, 175216416LL, 174804569LL, 174391750LL, 
    173977952LL, 173563168LL, 173147391LL, 172730614LL, 
    172312829LL, 171894029LL, 171474207LL, 171053355LL, 
    170631466LL, 170208531LL, 169784544LL, 169359495LL, 
    168933378LL, 168506184LL, 168077904LL, 167648531LL, 
    167218056LL, 166786470LL, 166353766LL, 165919933LL, 
    165484964LL, 165048849LL, 164611579LL, 164173145LL, 
    163733538LL, 163292748LL, 162850765LL, 162407580LL, 
    161963183LL, 161517563LL, 161070712LL, 160622618LL, 
    160173271LL, 159722660LL, 159270775LL, 158817605LL, 
    158363139LL, 157907365LL, 157450273LL, 156991850LL, 
    156532086LL, 156070967LL, 155608483LL, 155144621LL, 
    154679368LL, 154212713LL, 153744641LL, 153275141LL, 
    152804198LL, 152331801LL, 151857934LL, 151382585LL, 
    150905739LL, 150427383LL, 149947500LL, 149466078LL, 
    148983101LL, 148498553LL, 148012420LL, 147524686LL, 
    147035334LL, 146544349LL, 146051714LL, 145557412LL, 
    145061427LL, 144563741LL, 144064336LL, 143563194LL, 
    143060298LL, 142555628LL, 142049166LL, 141540892LL, 
    141030787LL, 140518831LL, 140005004LL, 139489284LL, 
    138971652LL, 138452085LL, 137930561LL, 137407059LL, 
    136881555LL, 136354027LL, 135824451LL, 135292802LL, 
    134759057LL, 134223189LL, 133685175LL, 133144987LL, 
    132602600LL, 132057985LL, 131511116LL, 130961964LL, 
    130410501LL, 129856696LL, 129300520LL, 128741941LL, 
    128180930LL, 127617453LL, 127051478LL, 126482971LL, 
    125911898LL, 125338223LL, 124761912LL, 124182927LL, 
    123601230LL, 123016784LL, 122429549LL, 121839484LL, 
    121246548LL, 120650699LL, 120051893LL, 119450087LL, 
    118845233LL, 118237287LL, 117626199LL, 117011921LL, 
    116394401LL, 115773589LL, 115149431LL, 114521871LL, 
    113890855LL, 113256324LL, 112618218LL, 111976477LL, 
    111331038LL, 110681836LL, 110028804LL, 109371874LL, 
    108710976LL, 108046035LL, 107376978LL, 106703727LL, 
    106026202LL, 105344320LL, 104657996LL, 103967143LL, 
    103271669LL, 102571481LL, 101866481LL, 101156568LL, 
    100441639LL, 99721585LL, 98996296LL, 98265654LL, 
    97529539LL, 96787828LL, 96040389LL, 95287088LL, 
    94527786LL, 93762335LL, 92990585LL, 92212378LL, 
    91427548LL, 90635923LL, 89837324LL, 89031562LL, 
    88218443LL, 87397760LL, 86569298LL, 85732832LL, 
    84888126LL, 84034930LL, 83172983LL, 82302011LL, 
    81421724LL, 80531816LL, 79631965LL, 78721830LL, 
    77801050LL, 76869242LL, 75926001LL, 74970894LL, 
    74003463LL, 73023218LL, 72029635LL, 71022155LL, 
    70000177LL, 68963058LL, 67910103LL, 66840564LL, 
    65753631LL, 64648428LL, 63524001LL, 62379311LL, 
    61213220LL, 60024481LL, 58811721LL, 57573422LL, 
    56307899LL, 55013274LL, 53687440LL, 52328027LL, 
    50932345LL, 49497326LL, 48019444LL, 46494611LL, 
    44918047LL, 43284099LL, 41586004LL, 39815555LL, 
    37962629LL, 36014501LL, 33954786LL, 31761783LL, 
    29405688LL, 26843589LL, 24009628LL, 20792941LL, 
    16977359LL, 12004802LL, 0LL
};

// Fixed-point constants
constexpr int kFractionBits = 32;
constexpr int64_t kOne = 1LL << kFractionBits;
constexpr int64_t kPi = 13493037704LL;  // дл in Q32.32 format (дл А┴ 2^32)

/**
 * @brief Calculate arccosine value with multi-region interpolation
 * @param x Fixed-point value in [-1,1] range with input_fraction_bits precision
 * @param input_fraction_bits Precision (fractional bits) of the input value
 * @return Fixed-point arccosine value with input_fraction_bits precision in [0, дл] range
 */
inline int64_t LookupAcos(int64_t x, int input_fraction_bits) noexcept {
    // Region boundary constants
    constexpr int64_t kThreshold_0_8 = kOne * 4LL / 5LL;         // 0.8
    constexpr int64_t kThreshold_0_93 = kOne * 93LL / 100LL;      // 0.93
    constexpr int64_t kThreshold_0_99 = kOne * 99LL / 100LL;     // 0.99
    constexpr int64_t kThreshold_0_999 = kOne * 999LL / 1000LL;  // 0.999
    constexpr int64_t kThresholdSmall = kOne - (kOne >> 16);     // 0.999984741211

    // Adjust input to internal precision
    int64_t scaled_x;
    if (input_fraction_bits > kFractionBits) {
        scaled_x = x >> (input_fraction_bits - kFractionBits);
    } else if (input_fraction_bits < kFractionBits) {
        scaled_x = x << (kFractionBits - input_fraction_bits);
    } else {
        scaled_x = x;
    }

    // Boundary check: ensure input is in [-kOne, kOne] range
    if (scaled_x >= kOne) {
        int64_t result = 0;
        // Adjust output precision
        if (input_fraction_bits > kFractionBits) {
            result = result << (input_fraction_bits - kFractionBits);
        } else if (input_fraction_bits < kFractionBits) {
            result = result >> (kFractionBits - input_fraction_bits);
        }
        return result;
    }
    if (scaled_x <= -kOne) {
        int64_t result = kPi;
        // Adjust output precision
        if (input_fraction_bits > kFractionBits) {
            result = result << (input_fraction_bits - kFractionBits);
        } else if (input_fraction_bits < kFractionBits) {
            result = result >> (kFractionBits - input_fraction_bits);
        }
        return result;
    }

    bool is_negative = scaled_x < 0;
    scaled_x = is_negative ? -scaled_x : scaled_x;

    // Handle extremely small angles: x > 0.999984741211, use sqrt(2(1-x)) approximation
    if (scaled_x > kThresholdSmall) {
        int64_t epsilon = kOne - scaled_x;
        int64_t sqrt_input = (epsilon << 1);
        int64_t result = Primitives::Fixed64SqrtFast(sqrt_input, kFractionBits);
        
        // Adjust for negative input
        if (is_negative) {
            result = kPi - result;
        }
        
        // Adjust output precision
        if (input_fraction_bits > kFractionBits) {
            result = result << (input_fraction_bits - kFractionBits);
        } else if (input_fraction_bits < kFractionBits) {
            result = result >> (kFractionBits - input_fraction_bits);
        }
        return result;
    }

    int64_t result;
    // Region 1: [0, 0.8], use 512-point uniform interpolation
    if (scaled_x < kThreshold_0_8) {
        int index = (scaled_x << 9) / kThreshold_0_8;  // x * 512 / (0.8 * kOne)
        index = std::min(index, 511);

        // Calculate interpolation
        int64_t x0 = (index * kThreshold_0_8) >> 9;  // index * 0.8 * kOne / 512
        int64_t dx = scaled_x - x0;
        constexpr int64_t delta = kThreshold_0_8 >> 9;  // 0.8 * kOne / 512
        result = AcosLut[index] + ((AcosLut[index + 1] - AcosLut[index]) * dx) / delta;
    }
    // Region 2: [0.8, 0.93], use 128-segment Hermite interpolation
    else if (scaled_x < kThreshold_0_93) {
        int seg = ((scaled_x - kThreshold_0_8) * 128LL) / (kOne * 13LL / 100LL);  // (x - 0.8) / (0.13/128)
        seg = std::min(seg, 127);

        int base_idx = 513 + seg * 3;
        int64_t x0 = AcosLut[base_idx];
        int64_t y0 = AcosLut[base_idx + 1];
        int64_t dydx = AcosLut[base_idx + 2];

        int64_t dx = scaled_x - x0;
        result = y0 + ((dydx * dx) >> kFractionBits);
    }
    // Region 3: [0.93, 0.99], use 512-point linear interpolation
    else if (scaled_x < kThreshold_0_99) {
        int base_idx = 513 + 387;              // 512 + 1 + 129*3
        int64_t rel_x = scaled_x - kThreshold_0_93;  // x - 0.93
        int64_t scale = (kOne * 6LL / 100LL);   // 0.06 * kOne

        int index = (rel_x * 512LL) / scale;
        index = std::min(index, 511);

        int idx = base_idx + index;
        int64_t x1 = kThreshold_0_93 + (scale * index) / 512LL;
        int64_t x2 = kThreshold_0_93 + (scale * (index + 1)) / 512LL;

        int64_t alpha = ((scaled_x - x1) << kFractionBits) / (x2 - x1);
        result = ((AcosLut[idx] * (kOne - alpha)) + (AcosLut[idx + 1] * alpha)) >> kFractionBits;
    }
    // Region 4: [0.99, 0.999], use 512-point linear interpolation
    else if (scaled_x < kThreshold_0_999) {
        int base_idx = 513 + 387 + 513;
        int64_t rel_x = scaled_x - kThreshold_0_99;  // x - 0.99
        int64_t scale = (kOne * 9LL / 1000LL);  // 0.009 * kOne

        int index = (rel_x * 512LL) / scale;
        index = std::min(index, 511);

        int idx = base_idx + index;
        int64_t x1 = kThreshold_0_99 + (scale * index) / 512LL;
        int64_t x2 = kThreshold_0_99 + (scale * (index + 1)) / 512LL;

        int64_t alpha = ((scaled_x - x1) << kFractionBits) / (x2 - x1);
        result = ((AcosLut[idx] * (kOne - alpha)) + (AcosLut[idx + 1] * alpha)) >> kFractionBits;
    }
    // Region 5: [0.999, 1.0), use 256-point linear interpolation
    else {
        int base_idx = 513 + 387 + 513 + 513;
        int64_t rel_x = scaled_x - kThreshold_0_999;  // x - 0.999
        int64_t scale = kOne / 1000LL;           // 0.001 * kOne

        int index = (rel_x * 256LL) / scale;
        index = std::min(index, 255);

        int idx = base_idx + index;
        int64_t x1 = kThreshold_0_999 + (scale * index) / 256LL;
        int64_t x2 = kThreshold_0_999 + (scale * (index + 1)) / 256LL;

        int64_t alpha = ((scaled_x - x1) << kFractionBits) / (x2 - x1);
        result = ((AcosLut[idx] * (kOne - alpha)) + (AcosLut[idx + 1] * alpha)) >> kFractionBits;
    }

    // Adjust for negative input
    if (is_negative) {
        result = kPi - result;
    }

    // Adjust output precision
    if (input_fraction_bits > kFractionBits) {
        result = result << (input_fraction_bits - kFractionBits);
    } else if (input_fraction_bits < kFractionBits) {
        result = result >> (kFractionBits - input_fraction_bits);
    }

    return result;
}

} // namespace math::fp::detail
