#pragma once

#include <stdint.h>
#include <array>
#include "primitives.h"

// Acos lookup table with 512 entries
// Covers the range [0,1] with values in Q23.40 format
// Generated with mpmath library at 100 digits precision

namespace math::fp::detail {
// Table maps x in [0,1] to acos(x)
// Values stored in Q23.40 fixed-point format
inline constexpr std::array<int64_t, 512> kAcosLut = {
    0x000001921FB54442LL,  // acos(0.00000000000) = 1.57079632679
    0x000001919F751ED5LL,  // acos(0.00195694716) = 1.56883937838
    0x000001911F34D937LL,  // acos(0.00391389432) = 1.56688242248
    0x000001909EF45339LL,  // acos(0.00587084149) = 1.56492545158
    0x000001901EB36CA8LL,  // acos(0.00782778865) = 1.56296845820
    0x0000018F9E720554LL,  // acos(0.00978473581) = 1.56101143484
    0x0000018F1E2FFD09LL,  // acos(0.01174168297) = 1.55905437400
    0x0000018E9DED3392LL,  // acos(0.01369863014) = 1.55709726819
    0x0000018E1DA988BALL,  // acos(0.01565557730) = 1.55514010990
    0x0000018D9D64DC47LL,  // acos(0.01761252446) = 1.55318289164
    0x0000018D1D1F0E01LL,  // acos(0.01956947162) = 1.55122560589
    0x0000018C9CD7FDA8LL,  // acos(0.02152641879) = 1.54926824515
    0x0000018C1C8F8AFFLL,  // acos(0.02348336595) = 1.54731080192
    0x0000018B9C4595C1LL,  // acos(0.02544031311) = 1.54535326868
    0x0000018B1BF9FDA8LL,  // acos(0.02739726027) = 1.54339563792
    0x0000018A9BACA26ALL,  // acos(0.02935420744) = 1.54143790212
    0x0000018A1B5D63B9LL,  // acos(0.03131115460) = 1.53948005376
    0x000001899B0C2142LL,  // acos(0.03326810176) = 1.53752208530
    0x000001891AB8BAAFLL,  // acos(0.03522504892) = 1.53556398924
    0x000001889A630FA4LL,  // acos(0.03718199609) = 1.53360575802
    0x000001881A0AFFC0LL,  // acos(0.03913894325) = 1.53164738411
    0x0000018799B06A9BLL,  // acos(0.04109589041) = 1.52968885997
    0x0000018719532FCCLL,  // acos(0.04305283757) = 1.52773017804
    0x0000018698F32EDELL,  // acos(0.04500978474) = 1.52577133078
    0x000001861890475ALL,  // acos(0.04696673190) = 1.52381231062
    0x00000185982A58C0LL,  // acos(0.04892367906) = 1.52185311000
    0x0000018517C1428CLL,  // acos(0.05088062622) = 1.51989372134
    0x000001849754E42FLL,  // acos(0.05283757339) = 1.51793413707
    0x0000018416E51D16LL,  // acos(0.05479452055) = 1.51597434960
    0x000001839671CCA4LL,  // acos(0.05675146771) = 1.51401435133
    0x0000018315FAD234LL,  // acos(0.05870841487) = 1.51205413467
    0x0000018295800D1ALL,  // acos(0.06066536204) = 1.51009369202
    0x0000018215015CA2LL,  // acos(0.06262230920) = 1.50813301574
    0x00000181947EA00BLL,  // acos(0.06457925636) = 1.50617209823
    0x0000018113F7B690LL,  // acos(0.06653620352) = 1.50421093185
    0x00000180936C7F5FLL,  // acos(0.06849315068) = 1.50224950895
    0x0000018012DCD99DLL,  // acos(0.07045009785) = 1.50028782189
    0x0000017F9248A464LL,  // acos(0.07240704501) = 1.49832586301
    0x0000017F11AFBEC7LL,  // acos(0.07436399217) = 1.49636362465
    0x0000017E911207CALL,  // acos(0.07632093933) = 1.49440109911
    0x0000017E106F5E68LL,  // acos(0.07827788650) = 1.49243827872
    0x0000017D8FC7A191LL,  // acos(0.08023483366) = 1.49047515578
    0x0000017D0F1AB028LL,  // acos(0.08219178082) = 1.48851172257
    0x0000017C8E686906LL,  // acos(0.08414872798) = 1.48654797138
    0x0000017C0DB0AAF5LL,  // acos(0.08610567515) = 1.48458389448
    0x0000017B8CF354B5LL,  // acos(0.08806262231) = 1.48261948412
    0x0000017B0C3044F8LL,  // acos(0.09001956947) = 1.48065473255
    0x0000017A8B675A62LL,  // acos(0.09197651663) = 1.47868963200
    0x0000017A0A98738CLL,  // acos(0.09393346380) = 1.47672417470
    0x0000017989C36EFELL,  // acos(0.09589041096) = 1.47475835285
    0x0000017908E82B34LL,  // acos(0.09784735812) = 1.47279215865
    0x000001788806869BLL,  // acos(0.09980430528) = 1.47082558428
    0x00000178071E5F90LL,  // acos(0.10176125245) = 1.46885862191
    0x00000177862F9464LL,  // acos(0.10371819961) = 1.46689126370
    0x00000177053A0355LL,  // acos(0.10567514677) = 1.46492350179
    0x00000176843D8A94LL,  // acos(0.10763209393) = 1.46295532831
    0x00000176033A0840LL,  // acos(0.10958904110) = 1.46098673536
    0x00000175822F5A69LL,  // acos(0.11154598826) = 1.45901771505
    0x00000175011D5F0DLL,  // acos(0.11350293542) = 1.45704825945
    0x000001748003F41ALL,  // acos(0.11545988258) = 1.45507836065
    0x00000173FEE2F76CLL,  // acos(0.11741682975) = 1.45310801068
    0x000001737DBA46CDLL,  // acos(0.11937377691) = 1.45113720158
    0x00000172FC89BFF7LL,  // acos(0.12133072407) = 1.44916592538
    0x000001727B51408FLL,  // acos(0.12328767123) = 1.44719417406
    0x00000171FA10A629LL,  // acos(0.12524461840) = 1.44522193963
    0x0000017178C7CE44LL,  // acos(0.12720156556) = 1.44324921404
    0x00000170F776964ELL,  // acos(0.12915851272) = 1.44127598924
    0x00000170761CDBA0LL,  // acos(0.13111545988) = 1.43930225718
    0x0000016FF4BA7B7ELL,  // acos(0.13307240705) = 1.43732800975
    0x0000016F734F531ALL,  // acos(0.13502935421) = 1.43535323886
    0x0000016EF1DB3F8FLL,  // acos(0.13698630137) = 1.43337793638
    0x0000016E705E1DE3LL,  // acos(0.13894324853) = 1.43140209417
    0x0000016DEED7CB08LL,  // acos(0.14090019569) = 1.42942570407
    0x0000016D6D4823D9LL,  // acos(0.14285714286) = 1.42744875789
    0x0000016CEBAF051BLL,  // acos(0.14481409002) = 1.42547124743
    0x0000016C6A0C4B7DLL,  // acos(0.14677103718) = 1.42349316447
    0x0000016BE85FD394LL,  // acos(0.14872798434) = 1.42151450077
    0x0000016B66A979E3LL,  // acos(0.15068493151) = 1.41953524805
    0x0000016AE4E91AD1LL,  // acos(0.15264187867) = 1.41755539803
    0x0000016A631E92AFLL,  // acos(0.15459882583) = 1.41557494241
    0x00000169E149BDB4LL,  // acos(0.15655577299) = 1.41359387285
    0x000001695F6A7801LL,  // acos(0.15851272016) = 1.41161218099
    0x00000168DD809D99LL,  // acos(0.16046966732) = 1.40962985847
    0x000001685B8C0A6BLL,  // acos(0.16242661448) = 1.40764689688
    0x00000167D98C9A49LL,  // acos(0.16438356164) = 1.40566328780
    0x00000167578228EALL,  // acos(0.16634050881) = 1.40367902278
    0x00000166D56C91EBLL,  // acos(0.16829745597) = 1.40169409335
    0x00000166534BB0D1LL,  // acos(0.17025440313) = 1.39970849101
    0x00000165D11F60FFLL,  // acos(0.17221135029) = 1.39772220724
    0x000001654EE77DC3LL,  // acos(0.17416829746) = 1.39573523350
    0x00000164CCA3E24ALL,  // acos(0.17612524462) = 1.39374756121
    0x000001644A5469A5LL,  // acos(0.17808219178) = 1.39175918178
    0x00000163C7F8EECBLL,  // acos(0.18003913894) = 1.38977008657
    0x0000016345914C90LL,  // acos(0.18199608611) = 1.38778026695
    0x00000162C31D5DB0LL,  // acos(0.18395303327) = 1.38578971422
    0x00000162409CFCC4LL,  // acos(0.18590998043) = 1.38379841968
    0x00000161BE100448LL,  // acos(0.18786692759) = 1.38180637459
    0x000001613B764E99LL,  // acos(0.18982387476) = 1.37981357020
    0x00000160B8CFB5F4LL,  // acos(0.19178082192) = 1.37781999771
    0x00000160361C1477LL,  // acos(0.19373776908) = 1.37582564830
    0x0000015FB35B441DLL,  // acos(0.19569471624) = 1.37383051312
    0x0000015F308D1EC3LL,  // acos(0.19765166341) = 1.37183458329
    0x0000015EADB17E21LL,  // acos(0.19960861057) = 1.36983784990
    0x0000015E2AC83BD2LL,  // acos(0.20156555773) = 1.36784030400
    0x0000015DA7D1314ALL,  // acos(0.20352250489) = 1.36584193662
    0x0000015D24CC37DDLL,  // acos(0.20547945205) = 1.36384273876
    0x0000015CA1B928BBLL,  // acos(0.20743639922) = 1.36184270138
    0x0000015C1E97DCF0LL,  // acos(0.20939334638) = 1.35984181541
    0x0000015B9B682D65LL,  // acos(0.21135029354) = 1.35784007176
    0x0000015B1829F2DDLL,  // acos(0.21330724070) = 1.35583746127
    0x0000015A94DD05F8LL,  // acos(0.21526418787) = 1.35383397480
    0x0000015A11813F2DLL,  // acos(0.21722113503) = 1.35182960312
    0x000001598E1676D1LL,  // acos(0.21917808219) = 1.34982433701
    0x000001590A9C8510LL,  // acos(0.22113502935) = 1.34781816720
    0x00000158871341EFLL,  // acos(0.22309197652) = 1.34581108436
    0x00000158037A854CLL,  // acos(0.22504892368) = 1.34380307917
    0x000001577FD226DELL,  // acos(0.22700587084) = 1.34179414224
    0x00000156FC19FE32LL,  // acos(0.22896281800) = 1.33978426414
    0x000001567851E2ACLL,  // acos(0.23091976517) = 1.33777343544
    0x00000155F479AB88LL,  // acos(0.23287671233) = 1.33576164663
    0x0000015570912FD6LL,  // acos(0.23483365949) = 1.33374888819
    0x00000154EC98467ELL,  // acos(0.23679060665) = 1.33173515054
    0x00000154688EC639LL,  // acos(0.23874755382) = 1.32972042408
    0x00000153E4748599LL,  // acos(0.24070450098) = 1.32770469915
    0x0000015360495B00LL,  // acos(0.24266144814) = 1.32568796608
    0x00000152DC0D1CA6LL,  // acos(0.24461839530) = 1.32367021512
    0x0000015257BFA093LL,  // acos(0.24657534247) = 1.32165143652
    0x00000151D360BCA4LL,  // acos(0.24853228963) = 1.31963162046
    0x000001514EF04686LL,  // acos(0.25048923679) = 1.31761075708
    0x00000150CA6E13B7LL,  // acos(0.25244618395) = 1.31558883649
    0x0000015045D9F987LL,  // acos(0.25440313112) = 1.31356584875
    0x0000014FC133CD13LL,  // acos(0.25636007828) = 1.31154178387
    0x0000014F3C7B634BLL,  // acos(0.25831702544) = 1.30951663183
    0x0000014EB7B090EALL,  // acos(0.26027397260) = 1.30749038256
    0x0000014E32D32A7DLL,  // acos(0.26223091977) = 1.30546302593
    0x0000014DADE3045BLL,  // acos(0.26418786693) = 1.30343455178
    0x0000014D28DFF2A9LL,  // acos(0.26614481409) = 1.30140494990
    0x0000014CA3C9C95BLL,  // acos(0.26810176125) = 1.29937421003
    0x0000014C1EA05C2CLL,  // acos(0.27005870841) = 1.29734232188
    0x0000014B99637EA7LL,  // acos(0.27201565558) = 1.29530927507
    0x0000014B1413041CLL,  // acos(0.27397260274) = 1.29327505923
    0x0000014A8EAEBFAALL,  // acos(0.27592954990) = 1.29123966388
    0x0000014A09368436LL,  // acos(0.27788649706) = 1.28920307854
    0x0000014983AA246ELL,  // acos(0.27984344423) = 1.28716529264
    0x00000148FE0972C9LL,  // acos(0.28180039139) = 1.28512629559
    0x0000014878544183LL,  // acos(0.28375733855) = 1.28308607673
    0x00000147F28A62A2LL,  // acos(0.28571428571) = 1.28104462536
    0x000001476CABA7EDLL,  // acos(0.28767123288) = 1.27900193071
    0x00000146E6B7E2F4LL,  // acos(0.28962818004) = 1.27695798198
    0x0000014660AEE509LL,  // acos(0.29158512720) = 1.27491276829
    0x00000145DA907F45LL,  // acos(0.29354207436) = 1.27286627872
    0x00000145545C827FLL,  // acos(0.29549902153) = 1.27081850229
    0x00000144CE12BF55LL,  // acos(0.29745596869) = 1.26876942798
    0x0000014447B30623LL,  // acos(0.29941291585) = 1.26671904468
    0x00000143C13D2708LL,  // acos(0.30136986301) = 1.26466734126
    0x000001433AB0F1E2LL,  // acos(0.30332681018) = 1.26261430650
    0x00000142B40E364FLL,  // acos(0.30528375734) = 1.26055992914
    0x000001422D54C3AALL,  // acos(0.30724070450) = 1.25850419786
    0x00000141A684690ELL,  // acos(0.30919765166) = 1.25644710126
    0x000001411F9CF551LL,  // acos(0.31115459883) = 1.25438862790
    0x00000140989E3706LL,  // acos(0.31311154599) = 1.25232876628
    0x000001401187FC7ALL,  // acos(0.31506849315) = 1.25026750483
    0x0000013F8A5A13B8LL,  // acos(0.31702544031) = 1.24820483190
    0x0000013F03144A80LL,  // acos(0.31898238748) = 1.24614073581
    0x0000013E7BB66E4FLL,  // acos(0.32093933464) = 1.24407520478
    0x0000013DF4404C58LL,  // acos(0.32289628180) = 1.24200822700
    0x0000013D6CB1B185LL,  // acos(0.32485322896) = 1.23993979057
    0x0000013CE50A6A76LL,  // acos(0.32681017613) = 1.23786988353
    0x0000013C5D4A4383LL,  // acos(0.32876712329) = 1.23579849385
    0x0000013BD57108B6LL,  // acos(0.33072407045) = 1.23372560942
    0x0000013B4D7E85CELL,  // acos(0.33268101761) = 1.23165121810
    0x0000013AC572863BLL,  // acos(0.33463796477) = 1.22957530763
    0x0000013A3D4CD521LL,  // acos(0.33659491194) = 1.22749786571
    0x00000139B50D3D53LL,  // acos(0.33855185910) = 1.22541887996
    0x000001392CB38957LL,  // acos(0.34050880626) = 1.22333833793
    0x00000138A43F835DLL,  // acos(0.34246575342) = 1.22125622709
    0x000001381BB0F548LL,  // acos(0.34442270059) = 1.21917253483
    0x000001379307A8A6LL,  // acos(0.34637964775) = 1.21708724849
    0x000001370A4366B1LL,  // acos(0.34833659491) = 1.21500035531
    0x000001368163F84DLL,  // acos(0.35029354207) = 1.21291184246
    0x00000135F869260ALL,  // acos(0.35225048924) = 1.21082169703
    0x000001356F52B821LL,  // acos(0.35420743640) = 1.20872990604
    0x00000134E6207672LL,  // acos(0.35616438356) = 1.20663645641
    0x000001345CD22884LL,  // acos(0.35812133072) = 1.20454133500
    0x00000133D3679584LL,  // acos(0.36007827789) = 1.20244452858
    0x0000013349E08443LL,  // acos(0.36203522505) = 1.20034602384
    0x00000132C03CBB39LL,  // acos(0.36399217221) = 1.19824580737
    0x00000132367C007CLL,  // acos(0.36594911937) = 1.19614386570
    0x00000131AC9E19C7LL,  // acos(0.36790606654) = 1.19404018525
    0x0000013122A2CC73LL,  // acos(0.36986301370) = 1.19193475238
    0x000001309889DD79LL,  // acos(0.37181996086) = 1.18982755334
    0x000001300E531171LL,  // acos(0.37377690802) = 1.18771857429
    0x0000012F83FE2C8ELL,  // acos(0.37573385519) = 1.18560780132
    0x0000012EF98AF2A0LL,  // acos(0.37769080235) = 1.18349522041
    0x0000012E6EF92710LL,  // acos(0.37964774951) = 1.18138081745
    0x0000012DE4488CE2LL,  // acos(0.38160469667) = 1.17926457824
    0x0000012D5978E6B0LL,  // acos(0.38356164384) = 1.17714648850
    0x0000012CCE89F6ABLL,  // acos(0.38551859100) = 1.17502653382
    0x0000012C437B7E9BLL,  // acos(0.38747553816) = 1.17290469972
    0x0000012BB84D3FDALL,  // acos(0.38943248532) = 1.17078097161
    0x0000012B2CFEFB55LL,  // acos(0.39138943249) = 1.16865533482
    0x0000012AA190718BLL,  // acos(0.39334637965) = 1.16652777454
    0x0000012A1601628ALL,  // acos(0.39530332681) = 1.16439827591
    0x000001298A518DF1LL,  // acos(0.39726027397) = 1.16226682392
    0x00000128FE80B2E9LL,  // acos(0.39921722114) = 1.16013340347
    0x00000128728E9028LL,  // acos(0.40117416830) = 1.15799799938
    0x00000127E67AE3F0LL,  // acos(0.40313111546) = 1.15586059632
    0x000001275A456C08LL,  // acos(0.40508806262) = 1.15372117889
    0x00000126CDEDE5C3LL,  // acos(0.40704500978) = 1.15157973155
    0x0000012641740DF7LL,  // acos(0.40900195695) = 1.14943623868
    0x00000125B4D7A0FELL,  // acos(0.41095890411) = 1.14729068451
    0x0000012528185AB6LL,  // acos(0.41291585127) = 1.14514305319
    0x000001249B35F67ELL,  // acos(0.41487279843) = 1.14299332874
    0x000001240E302F35LL,  // acos(0.41682974560) = 1.14084149506
    0x000001238106BF37LL,  // acos(0.41878669276) = 1.13868753594
    0x00000122F3B9605CLL,  // acos(0.42074363992) = 1.13653143504
    0x000001226647CBFALL,  // acos(0.42270058708) = 1.13437317591
    0x00000121D8B1BADBLL,  // acos(0.42465753425) = 1.13221274197
    0x000001214AF6E543LL,  // acos(0.42661448141) = 1.13005011651
    0x00000120BD1702EDLL,  // acos(0.42857142857) = 1.12788528272
    0x000001202F11CB05LL,  // acos(0.43052837573) = 1.12571822363
    0x0000011FA0E6F429LL,  // acos(0.43248532290) = 1.12354892217
    0x0000011F1296346ALL,  // acos(0.43444227006) = 1.12137736110
    0x0000011E841F4144LL,  // acos(0.43639921722) = 1.11920352310
    0x0000011DF581CFA1LL,  // acos(0.43835616438) = 1.11702739066
    0x0000011D66BD93D5LL,  // acos(0.44031311155) = 1.11484894618
    0x0000011CD7D2419ELL,  // acos(0.44227005871) = 1.11266817190
    0x0000011C48BF8C1ELL,  // acos(0.44422700587) = 1.11048504992
    0x0000011BB98525DELL,  // acos(0.44618395303) = 1.10829956221
    0x0000011B2A22C0C8LL,  // acos(0.44814090020) = 1.10611169058
    0x0000011A9A980E26LL,  // acos(0.45009784736) = 1.10392141672
    0x0000011A0AE4BEA3LL,  // acos(0.45205479452) = 1.10172872214
    0x000001197B088243LL,  // acos(0.45401174168) = 1.09953358822
    0x00000118EB030866LL,  // acos(0.45596868885) = 1.09733599620
    0x000001185AD3FFC5LL,  // acos(0.45792563601) = 1.09513592715
    0x00000117CA7B166ALL,  // acos(0.45988258317) = 1.09293336198
    0x0000011739F7F9B9LL,  // acos(0.46183953033) = 1.09072828147
    0x00000116A94A5661LL,  // acos(0.46379647750) = 1.08852066621
    0x000001161871D863LL,  // acos(0.46575342466) = 1.08631049664
    0x00000115876E2B0CLL,  // acos(0.46771037182) = 1.08409775306
    0x00000114F63EF8F2LL,  // acos(0.46966731898) = 1.08188241556
    0x0000011464E3EBF3LL,  // acos(0.47162426614) = 1.07966446410
    0x00000113D35CAD33LL,  // acos(0.47358121331) = 1.07744387845
    0x0000011341A8E515LL,  // acos(0.47553816047) = 1.07522063821
    0x00000112AFC83B41LL,  // acos(0.47749510763) = 1.07299472281
    0x000001121DBA5697LL,  // acos(0.47945205479) = 1.07076611151
    0x000001118B7EDD34LL,  // acos(0.48140900196) = 1.06853478337
    0x00000110F915746ELL,  // acos(0.48336594912) = 1.06630071728
    0x00000110667DC0CELL,  // acos(0.48532289628) = 1.06406389196
    0x0000010FD3B76610LL,  // acos(0.48727984344) = 1.06182428591
    0x0000010F40C2071FLL,  // acos(0.48923679061) = 1.05958187746
    0x0000010EAD9D4612LL,  // acos(0.49119373777) = 1.05733664475
    0x0000010E1A48C42BLL,  // acos(0.49315068493) = 1.05508856572
    0x0000010D86C421D2LL,  // acos(0.49510763209) = 1.05283761812
    0x0000010CF30EFE91LL,  // acos(0.49706457926) = 1.05058377948
    0x0000010C5F28F914LL,  // acos(0.49902152642) = 1.04832702714
    0x0000010BCB11AF24LL,  // acos(0.50097847358) = 1.04606733824
    0x0000010B36C8BDA2LL,  // acos(0.50293542074) = 1.04380468969
    0x0000010AA24DC087LL,  // acos(0.50489236791) = 1.04153905821
    0x0000010A0DA052E1LL,  // acos(0.50684931507) = 1.03927042030
    0x0000010978C00ECCLL,  // acos(0.50880626223) = 1.03699875222
    0x00000108E3AC8D6FLL,  // acos(0.51076320939) = 1.03472403005
    0x000001084E6566FCLL,  // acos(0.51272015656) = 1.03244622959
    0x00000107B8EA32AALL,  // acos(0.51467710372) = 1.03016532647
    0x00000107233A86B2LL,  // acos(0.51663405088) = 1.02788129605
    0x000001068D55F84ALL,  // acos(0.51859099804) = 1.02559411346
    0x00000105F73C1BA3LL,  // acos(0.52054794521) = 1.02330375361
    0x0000010560EC83E3LL,  // acos(0.52250489237) = 1.02101019115
    0x00000104CA66C325LL,  // acos(0.52446183953) = 1.01871340050
    0x0000010433AA6A6ELL,  // acos(0.52641878669) = 1.01641335581
    0x000001039CB709B2LL,  // acos(0.52837573386) = 1.01411003100
    0x00000103058C2FC8LL,  // acos(0.53033268102) = 1.01180339972
    0x000001026E296A6BLL,  // acos(0.53228962818) = 1.00949343537
    0x00000101D68E4633LL,  // acos(0.53424657534) = 1.00718011106
    0x000001013EBA4E8FLL,  // acos(0.53620352250) = 1.00486339968
    0x00000100A6AD0DC7LL,  // acos(0.53816046967) = 1.00254327380
    0x000001000E660CF0LL,  // acos(0.54011741683) = 1.00021970573
    0x000000FF75E4D3EBLL,  // acos(0.54207436399) = 0.99789266752
    0x000000FEDD28E961LL,  // acos(0.54403131115) = 0.99556213091
    0x000000FE4431D2BCLL,  // acos(0.54598825832) = 0.99322806735
    0x000000FDAAFF1424LL,  // acos(0.54794520548) = 0.99089044801
    0x000000FD11903079LL,  // acos(0.54990215264) = 0.98854924377
    0x000000FC77E4A94DLL,  // acos(0.55185909980) = 0.98620442518
    0x000000FBDDFBFEE0LL,  // acos(0.55381604697) = 0.98385596249
    0x000000FB43D5B01CLL,  // acos(0.55577299413) = 0.98150382566
    0x000000FAA9713A8DLL,  // acos(0.55772994129) = 0.97914798431
    0x000000FA0ECE1A5CLL,  // acos(0.55968688845) = 0.97678840774
    0x000000F973EBCA4ALL,  // acos(0.56164383562) = 0.97442506493
    0x000000F8D8C9C3ABLL,  // acos(0.56360078278) = 0.97205792453
    0x000000F83D677E60LL,  // acos(0.56555772994) = 0.96968695484
    0x000000F7A1C470CDLL,  // acos(0.56751467710) = 0.96731212381
    0x000000F705E00FDALL,  // acos(0.56947162427) = 0.96493339908
    0x000000F669B9CEE7LL,  // acos(0.57142857143) = 0.96255074788
    0x000000F5CD511FC8LL,  // acos(0.57338551859) = 0.96016413713
    0x000000F530A572BELL,  // acos(0.57534246575) = 0.95777353336
    0x000000F493B63671LL,  // acos(0.57729941292) = 0.95537890271
    0x000000F3F682D7E7LL,  // acos(0.57925636008) = 0.95298021098
    0x000000F3590AC282LL,  // acos(0.58121330724) = 0.95057742356
    0x000000F2BB4D5FF3LL,  // acos(0.58317025440) = 0.94817050545
    0x000000F21D4A1837LL,  // acos(0.58512720157) = 0.94575942127
    0x000000F17F00518ELL,  // acos(0.58708414873) = 0.94334413520
    0x000000F0E06F7072LL,  // acos(0.58904109589) = 0.94092461105
    0x000000F04196D794LL,  // acos(0.59099804305) = 0.93850081218
    0x000000EFA275E7D0LL,  // acos(0.59295499022) = 0.93607270155
    0x000000EF030C0026LL,  // acos(0.59491193738) = 0.93364024166
    0x000000EE63587DB1LL,  // acos(0.59686888454) = 0.93120339459
    0x000000EDC35ABBA2LL,  // acos(0.59882583170) = 0.92876212197
    0x000000ED23121333LL,  // acos(0.60078277886) = 0.92631638497
    0x000000EC827DDBA2LL,  // acos(0.60273972603) = 0.92386614430
    0x000000EBE19D6A26LL,  // acos(0.60469667319) = 0.92141136018
    0x000000EB407011E7LL,  // acos(0.60665362035) = 0.91895199239
    0x000000EA9EF523F1LL,  // acos(0.60861056751) = 0.91648800018
    0x000000E9FD2BEF32LL,  // acos(0.61056751468) = 0.91401934232
    0x000000E95B13C069LL,  // acos(0.61252446184) = 0.91154597709
    0x000000E8B8ABE21ELL,  // acos(0.61448140900) = 0.90906786223
    0x000000E815F39C9CLL,  // acos(0.61643835616) = 0.90658495496
    0x000000E772EA35E1LL,  // acos(0.61839530333) = 0.90409721198
    0x000000E6CF8EF194LL,  // acos(0.62035225049) = 0.90160458944
    0x000000E62BE110FELL,  // acos(0.62230919765) = 0.89910704293
    0x000000E587DFD2FBLL,  // acos(0.62426614481) = 0.89660452748
    0x000000E4E38A73F1LL,  // acos(0.62622309198) = 0.89409699755
    0x000000E43EE02DC2LL,  // acos(0.62818003914) = 0.89158440702
    0x000000E399E037C2LL,  // acos(0.63013698630) = 0.88906670915
    0x000000E2F489C6AALL,  // acos(0.63209393346) = 0.88654385662
    0x000000E24EDC0C8BLL,  // acos(0.63405088063) = 0.88401580149
    0x000000E1A8D638C1LL,  // acos(0.63600782779) = 0.88148249517
    0x000000E1027777E6LL,  // acos(0.63796477495) = 0.87894388845
    0x000000E05BBEF3C7LL,  // acos(0.63992172211) = 0.87639993145
    0x000000DFB4ABD352LL,  // acos(0.64187866928) = 0.87385057363
    0x000000DF0D3D3A8ALL,  // acos(0.64383561644) = 0.87129576377
    0x000000DE65724A78LL,  // acos(0.64579256360) = 0.86873544996
    0x000000DDBD4A211DLL,  // acos(0.64774951076) = 0.86616957959
    0x000000DD14C3D961LL,  // acos(0.64970645793) = 0.86359809930
    0x000000DC6BDE8B06LL,  // acos(0.65166340509) = 0.86102095503
    0x000000DBC2994A95LL,  // acos(0.65362035225) = 0.85843809195
    0x000000DB18F3294ELL,  // acos(0.65557729941) = 0.85584945448
    0x000000DA6EEB351BLL,  // acos(0.65753424658) = 0.85325498625
    0x000000D9C4807879LL,  // acos(0.65949119374) = 0.85065463010
    0x000000D919B1FA69LL,  // acos(0.66144814090) = 0.84804832805
    0x000000D86E7EBE5FLL,  // acos(0.66340508806) = 0.84543602131
    0x000000D7C2E5C42DLL,  // acos(0.66536203523) = 0.84281765022
    0x000000D716E607F1LL,  // acos(0.66731898239) = 0.84019315428
    0x000000D66A7E8201LL,  // acos(0.66927592955) = 0.83756247209
    0x000000D5BDAE26D5LL,  // acos(0.67123287671) = 0.83492554138
    0x000000D51073E6F8LL,  // acos(0.67318982387) = 0.83228229894
    0x000000D462CEAEEALL,  // acos(0.67514677104) = 0.82963268061
    0x000000D3B4BD6713LL,  // acos(0.67710371820) = 0.82697662131
    0x000000D3063EF3A4LL,  // acos(0.67906066536) = 0.82431405495
    0x000000D257523488LL,  // acos(0.68101761252) = 0.82164491446
    0x000000D1A7F60544LL,  // acos(0.68297455969) = 0.81896913174
    0x000000D0F8293CE7LL,  // acos(0.68493150685) = 0.81628663766
    0x000000D047EAADEALL,  // acos(0.68688845401) = 0.81359736200
    0x000000CF97392618LL,  // acos(0.68884540117) = 0.81090123348
    0x000000CEE6136E78LL,  // acos(0.69080234834) = 0.80819817969
    0x000000CE34784B2ALL,  // acos(0.69275929550) = 0.80548812709
    0x000000CD82667B50LL,  // acos(0.69471624266) = 0.80277100096
    0x000000CCCFDCB8F0LL,  // acos(0.69667318982) = 0.80004672542
    0x000000CC1CD9B8D6LL,  // acos(0.69863013699) = 0.79731522334
    0x000000CB695C2A76LL,  // acos(0.70058708415) = 0.79457641637
    0x000000CAB562B7CALL,  // acos(0.70254403131) = 0.79183022487
    0x000000CA00EC0534LL,  // acos(0.70450097847) = 0.78907656791
    0x000000C94BF6B15DLL,  // acos(0.70645792564) = 0.78631536322
    0x000000C89681550FLL,  // acos(0.70841487280) = 0.78354652716
    0x000000C7E08A8316LL,  // acos(0.71037181996) = 0.78076997471
    0x000000C72A10C818LL,  // acos(0.71232876712) = 0.77798561940
    0x000000C67312AA71LL,  // acos(0.71428571429) = 0.77519337331
    0x000000C5BB8EAA0BLL,  // acos(0.71624266145) = 0.77239314701
    0x000000C503834036LL,  // acos(0.71819960861) = 0.76958484953
    0x000000C44AEEDF81LL,  // acos(0.72015655577) = 0.76676838833
    0x000000C391CFF38ALL,  // acos(0.72211350294) = 0.76394366928
    0x000000C2D824E0DALL,  // acos(0.72407045010) = 0.76111059656
    0x000000C21DEC04ADLL,  // acos(0.72602739726) = 0.75826907267
    0x000000C16323B4CFLL,  // acos(0.72798434442) = 0.75541899838
    0x000000C0A7CA3F62LL,  // acos(0.72994129159) = 0.75256027267
    0x000000BFEBDDEAAFLL,  // acos(0.73189823875) = 0.74969279270
    0x000000BF2F5CF4F6LL,  // acos(0.73385518591) = 0.74681645375
    0x000000BE72459432LL,  // acos(0.73581213307) = 0.74393114918
    0x000000BDB495F5E7LL,  // acos(0.73776908023) = 0.74103677038
    0x000000BCF64C3EE8LL,  // acos(0.73972602740) = 0.73813320671
    0x000000BC37668B1ALL,  // acos(0.74168297456) = 0.73522034546
    0x000000BB77E2ED38LL,  // acos(0.74363992172) = 0.73229807178
    0x000000BAB7BF6E96LL,  // acos(0.74559686888) = 0.72936626863
    0x000000B9F6FA0EDCLL,  // acos(0.74755381605) = 0.72642481673
    0x000000B93590C3C6LL,  // acos(0.74951076321) = 0.72347359447
    0x000000B8738178DBLL,  // acos(0.75146771037) = 0.72051247788
    0x000000B7B0CA0F26LL,  // acos(0.75342465753) = 0.71754134054
    0x000000B6ED685CEDLL,  // acos(0.75538160470) = 0.71456005353
    0x000000B6295A2D60LL,  // acos(0.75733855186) = 0.71156848533
    0x000000B5649D4047LL,  // acos(0.75929549902) = 0.70856650180
    0x000000B49F2F49B6LL,  // acos(0.76125244618) = 0.70555396604
    0x000000B3D90DF1ADLL,  // acos(0.76320939335) = 0.70253073836
    0x000000B31236D3C7LL,  // acos(0.76516634051) = 0.69949667616
    0x000000B24AA77ED3LL,  // acos(0.76712328767) = 0.69645163390
    0x000000B1825D747ELL,  // acos(0.76908023483) = 0.69339546293
    0x000000B0B95628E6LL,  // acos(0.77103718200) = 0.69032801150
    0x000000AFEF8F0234LL,  // acos(0.77299412916) = 0.68724912456
    0x000000AF25055833LL,  // acos(0.77495107632) = 0.68415864375
    0x000000AE59B673DALL,  // acos(0.77690802348) = 0.68105640725
    0x000000AD8D9F8EDCLL,  // acos(0.77886497065) = 0.67794224966
    0x000000ACC0BDD329LL,  // acos(0.78082191781) = 0.67481600194
    0x000000ABF30E5A74LL,  // acos(0.78277886497) = 0.67167749127
    0x000000AB248E2DACLL,  // acos(0.78473581213) = 0.66852654090
    0x000000AA553A4472LL,  // acos(0.78669275930) = 0.66536297008
    0x000000A9850F848FLL,  // acos(0.78864970646) = 0.66218659388
    0x000000A8B40AC159LL,  // acos(0.79060665362) = 0.65899722310
    0x000000A7E228BB1BLL,  // acos(0.79256360078) = 0.65579466408
    0x000000A70F661E72LL,  // acos(0.79452054795) = 0.65257871860
    0x000000A63BBF83A5LL,  // acos(0.79647749511) = 0.64934918369
    0x000000A567316DF3LL,  // acos(0.79843444227) = 0.64610585150
    0x000000A491B84AE0LL,  // acos(0.80039138943) = 0.64284850910
    0x000000A3BB50716BLL,  // acos(0.80234833659) = 0.63957693833
    0x000000A2E3F62152LL,  // acos(0.80430528376) = 0.63629091562
    0x000000A20BA58235LL,  // acos(0.80626223092) = 0.63299021176
    0x000000A1325AA2C2LL,  // acos(0.80821917808) = 0.62967459177
    0x000000A0581177CCLL,  // acos(0.81017612524) = 0.62634381461
    0x0000009F7CC5DB5CLL,  // acos(0.81213307241) = 0.62299763303
    0x0000009EA0738BB6LL,  // acos(0.81409001957) = 0.61963579331
    0x0000009DC3162A4FLL,  // acos(0.81604696673) = 0.61625803502
    0x0000009CE4A93ABDLL,  // acos(0.81800391389) = 0.61286409077
    0x0000009C05282194LL,  // acos(0.81996086106) = 0.60945368595
    0x0000009B248E2334LL,  // acos(0.82191780822) = 0.60602653846
    0x0000009A42D6628CLL,  // acos(0.82387475538) = 0.60258235842
    0x000000995FFBDFCDLL,  // acos(0.82583170254) = 0.59912084784
    0x000000987BF97708LL,  // acos(0.82778864971) = 0.59564170033
    0x0000009796C9DEBCLL,  // acos(0.82974559687) = 0.59214460075
    0x00000096B067A652LL,  // acos(0.83170254403) = 0.58862922488
    0x00000095C8CD3483LL,  // acos(0.83365949119) = 0.58509523899
    0x00000094DFF4C5A9LL,  // acos(0.83561643836) = 0.58154229952
    0x00000093F5D869F9LL,  // acos(0.83757338552) = 0.57797005260
    0x000000930A7203A2LL,  // acos(0.83953033268) = 0.57437813367
    0x000000921DBB44D6LL,  // acos(0.84148727984) = 0.57076616698
    0x000000912FADADB1LL,  // acos(0.84344422701) = 0.56713376513
    0x0000009040428A0ALL,  // acos(0.84540117417) = 0.56348052855
    0x0000008F4F72EF17LL,  // acos(0.84735812133) = 0.55980604493
    0x0000008E5D37B8FFLL,  // acos(0.84931506849) = 0.55610988871
    0x0000008D69898837LL,  // acos(0.85127201566) = 0.55239162040
    0x0000008C7460BEC2LL,  // acos(0.85322896282) = 0.54865078599
    0x0000008B7DB57D43LL,  // acos(0.85518590998) = 0.54488691624
    0x0000008A857F9FDDLL,  // acos(0.85714285714) = 0.54109952596
    0x000000898BB6BAEDLL,  // acos(0.85909980431) = 0.53728811325
    0x000000889052177FLL,  // acos(0.86105675147) = 0.53345215868
    0x000000879348AF98LL,  // acos(0.86301369863) = 0.52959112441
    0x0000008694912A3BLL,  // acos(0.86497064579) = 0.52570445329
    0x000000859421D72ELL,  // acos(0.86692759295) = 0.52179156784
    0x0000008491F0AA72LL,  // acos(0.86888454012) = 0.51785186921
    0x000000838DF33776LL,  // acos(0.87084148728) = 0.51388473610
    0x00000082881EABEDLL,  // acos(0.87279843444) = 0.50988952348
    0x000000818067CA4BLL,  // acos(0.87475538160) = 0.50586556138
    0x0000008076C2E3E1LL,  // acos(0.87671232877) = 0.50181215347
    0x0000007F6B23D289LL,  // acos(0.87866927593) = 0.49772857561
    0x0000007E5D7DF1DFLL,  // acos(0.88062622309) = 0.49361407428
    0x0000007D4DC417F3LL,  // acos(0.88258317025) = 0.48946786484
    0x0000007C3BE88D77LL,  // acos(0.88454011742) = 0.48528912977
    0x0000007B27DD0550LL,  // acos(0.88649706458) = 0.48107701664
    0x0000007A11929377LL,  // acos(0.88845401174) = 0.47683063603
    0x00000078F8F9A330LL,  // acos(0.89041095890) = 0.47254905924
    0x00000077DE01EC64LL,  // acos(0.89236790607) = 0.46823131582
    0x00000076C09A6830LL,  // acos(0.89432485323) = 0.46387639087
    0x00000075A0B14469LL,  // acos(0.89628180039) = 0.45948322220
    0x000000747E33D61ELL,  // acos(0.89823874755) = 0.45505069711
    0x00000073590E8AE8LL,  // acos(0.90019569472) = 0.45057764903
    0x00000072312CD8ECLL,  // acos(0.90215264188) = 0.44606285377
    0x0000007106792D6ALL,  // acos(0.90410958904) = 0.44150502547
    0x0000006FD8DCD9B3LL,  // acos(0.90606653620) = 0.43690281215
    0x0000006EA83FFE50LL,  // acos(0.90802348337) = 0.43225479087
    0x0000006D74897424LL,  // acos(0.90998043053) = 0.42755946241
    0x0000006C3D9EB355LL,  // acos(0.91193737769) = 0.42281524542
    0x0000006B0363B7A7LL,  // acos(0.91389432485) = 0.41802046999
    0x00000069C5BAE205LL,  // acos(0.91585127202) = 0.41317337053
    0x000000688484D6CDLL,  // acos(0.91780821918) = 0.40827207798
    0x000000673FA05881LL,  // acos(0.91976516634) = 0.40331461106
    0x00000065F6EA1E50LL,  // acos(0.92172211350) = 0.39829886665
    0x00000064AA3CA5F2LL,  // acos(0.92367906067) = 0.39322260906
    0x0000006359700024LL,  // acos(0.92563600783) = 0.38808345798
    0x0000006204599701LL,  // acos(0.92759295499) = 0.38287887513
    0x00000060AACBED44LL,  // acos(0.92954990215) = 0.37760614913
    0x0000005F4C96556BLL,  // acos(0.93150684932) = 0.37226237855
    0x0000005DE9849F59LL,  // acos(0.93346379648) = 0.36684445277
    0x0000005C815EBB0CLL,  // acos(0.93542074364) = 0.36134903018
    0x0000005B13E84E6FLL,  // acos(0.93737769080) = 0.35577251353
    0x00000059A0E03C1ELL,  // acos(0.93933463796) = 0.35011102169
    0x000000582800186DLL,  // acos(0.94129158513) = 0.34436035725
    0x00000056A8FB895CLL,  // acos(0.94324853229) = 0.33851596931
    0x00000055237F8D78LL,  // acos(0.94520547945) = 0.33257291035
    0x000000539731A4AELL,  // acos(0.94716242661) = 0.32652578612
    0x0000005203AED4DBLL,  // acos(0.94911937378) = 0.32036869714
    0x00000050688A8263LL,  // acos(0.95107632094) = 0.31409516986
    0x0000004EC54D12F4LL,  // acos(0.95303326810) = 0.30769807542
    0x0000004D19724E09LL,  // acos(0.95499021526) = 0.30116953283
    0x0000004B64676B1BLL,  // acos(0.95694716243) = 0.29450079312
    0x00000049A588B8A3LL,  // acos(0.95890410959) = 0.28768209942
    0x00000047DC1EC08CLL,  // acos(0.96086105675) = 0.28070251656
    0x00000046075AC59FLL,  // acos(0.96281800391) = 0.27354972195
    0x00000044265268D7LL,  // acos(0.96477495108) = 0.26620974598
    0x0000004237FA336DLL,  // acos(0.96673189824) = 0.25866664653
    0x000000403B1EA871LL,  // acos(0.96868884540) = 0.25090209591
    0x0000003E2E5B59F0LL,  // acos(0.97064579256) = 0.24289484926
    0x0000003C100F4394LL,  // acos(0.97260273973) = 0.23462005043
    0x00000039DE4D521DLL,  // acos(0.97455968689) = 0.22604830985
    0x0000003796C76F98LL,  // acos(0.97651663405) = 0.21714445567
    0x0000003536B18019LL,  // acos(0.97847358121) = 0.20786580446
    0x00000032BA982905LL,  // acos(0.98043052838) = 0.19815970422
    0x000000301E247384LL,  // acos(0.98238747554) = 0.18795993634
    0x0000002D5BC0275FLL,  // acos(0.98434442270) = 0.17718125306
    0x0000002A6C046F88LL,  // acos(0.98630136986) = 0.16571071361
    0x0000002744C66D73LL,  // acos(0.98825831703) = 0.15339317486
    0x00000023D7623FDALL,  // acos(0.99021526419) = 0.14000524577
    0x000000200D5EC3F1LL,  // acos(0.99217221135) = 0.12520401272
    0x0000001BC0E5B8A7LL,  // acos(0.99412915851) = 0.10841212996
    0x00000016A82D3E1ALL,  // acos(0.99608610568) = 0.08850367323
    0x0000001004ACBEE9LL,  // acos(0.99804305284) = 0.06257133161
    0x0000000000000000LL   // acos(1.00000000000) = 0.00000000000
};

// Fast lookup acos(x) with linear interpolation between table entries
// Input x is in fixed-point format with specified fraction bits representing a value in [-1,1]
// Output is in fixed-point format with the same fraction bits representing acos(x)
// Precision: ~6.2e-5 when fraction_bits=32
inline constexpr auto LookupAcosFast(int64_t x, int input_fraction_bits) noexcept -> int64_t {
    // Constants
    constexpr int kOutputFractionBits = 40;  // Internal calculation format
    constexpr int64_t kPi = 0x000003243F6A8885LL;  // pi = 3.141592653589793

    // Handle negative input using acos(-x) = π - acos(x)
    bool is_negative = false;
    if (x < 0) {
        x = -x;
        is_negative = true;
    }

    // Convert input to internal format if needed
    if (input_fraction_bits != kOutputFractionBits) {
        if (input_fraction_bits < kOutputFractionBits) {
            x <<= (kOutputFractionBits - input_fraction_bits);
        } else {
            x >>= (input_fraction_bits - kOutputFractionBits);
        }
    }

    // Scale x to table index
    constexpr int64_t kScale = static_cast<int64_t>(kAcosLut.size() - 1);
    const int64_t idx_scaled = Primitives::Fixed64Mul(x, kScale << kOutputFractionBits, kOutputFractionBits);
    const int64_t idx = idx_scaled >> kOutputFractionBits;
    const int64_t t = idx_scaled & ((1LL << kOutputFractionBits) - 1);  // Fractional part [0,1)

    // Clamp index to valid range
    if (idx >= static_cast<int64_t>(kAcosLut.size()) - 1) {
        // Return the minimum value (acos(1) = 0)
        int64_t result = kAcosLut[kAcosLut.size() - 1];
        if (is_negative) {
            result = kPi - result;
        }
        if (input_fraction_bits != kOutputFractionBits) {
            if (input_fraction_bits < kOutputFractionBits) {
                result >>= (kOutputFractionBits - input_fraction_bits);
            } else {
                result <<= (input_fraction_bits - kOutputFractionBits);
            }
        }
        return result;
    }

    // Get table values for interpolation
    const int64_t y0 = kAcosLut[idx];
    const int64_t y1 = kAcosLut[idx + 1];

    // Linear interpolation
    int64_t result = y0 + Primitives::Fixed64Mul(y1 - y0, t, kOutputFractionBits);

    // Apply negative input formula if needed
    if (is_negative) {
        result = kPi - result;
    }

    // Convert result back to input format if needed
    if (input_fraction_bits != kOutputFractionBits) {
        if (input_fraction_bits < kOutputFractionBits) {
            result >>= (kOutputFractionBits - input_fraction_bits);
        } else {
            result <<= (input_fraction_bits - kOutputFractionBits);
        }
    }

    return result;
}

// Accurate lookup acos(x) with quadratic interpolation between table entries
// Input x is in fixed-point format with specified fraction bits representing a value in [-1,1]
// Output is in fixed-point format with the same fraction bits representing acos(x)
// Precision: ~1e-5 when fraction_bits=32 (about 300x more accurate than fast version)
inline constexpr auto LookupAcos(int64_t x, int input_fraction_bits) noexcept -> int64_t {
    // Constants
    constexpr int kOutputFractionBits = 40;  // Internal calculation format
    constexpr int64_t kPi = 0x000003243F6A8885LL;  // pi = 3.141592653589793

    // Handle negative input using acos(-x) = π - acos(x)
    bool is_negative = false;
    if (x < 0) {
        x = -x;
        is_negative = true;
    }

    // Convert input to internal format if needed
    if (input_fraction_bits != kOutputFractionBits) {
        if (input_fraction_bits < kOutputFractionBits) {
            x <<= (kOutputFractionBits - input_fraction_bits);
        } else {
            x >>= (input_fraction_bits - kOutputFractionBits);
        }
    }

    // Scale x to table index
    constexpr int64_t kScale = static_cast<int64_t>(kAcosLut.size() - 1);
    const int64_t idx_scaled = Primitives::Fixed64Mul(x, kScale << kOutputFractionBits, kOutputFractionBits);
    const int64_t idx = idx_scaled >> kOutputFractionBits;
    const int64_t t = idx_scaled & ((1LL << kOutputFractionBits) - 1);  // Fractional part [0,1)

    // Clamp index to valid range
    if (idx >= static_cast<int64_t>(kAcosLut.size()) - 1) {
        // Return the minimum value (acos(1) = 0)
        int64_t result = kAcosLut[kAcosLut.size() - 1];
        if (is_negative) {
            result = kPi - result;
        }
        if (input_fraction_bits != kOutputFractionBits) {
            if (input_fraction_bits < kOutputFractionBits) {
                result >>= (kOutputFractionBits - input_fraction_bits);
            } else {
                result <<= (input_fraction_bits - kOutputFractionBits);
            }
        }
        return result;
    }

    // Get table values for quadratic interpolation
    // Need three points: (x0,y0), (x1,y1), (x2,y2)
    const int64_t y1 = kAcosLut[idx];       // Current point
    const int64_t y2 = kAcosLut[idx + 1];   // Next point
    // For the previous point, handle the boundary case
    int64_t y0;
    if (idx > 0) {
        y0 = kAcosLut[idx - 1];  // Previous point
    } else {
        // At the boundary, mirror the slope for better extrapolation
        y0 = y1 + (y1 - y2);
    }

    // Compute derivatives using the fact that acos'(x) = -1/sqrt(1-x²)
    // We'll approximate this using the table values for better stability
    // The derivative is negative and gets steeper as x approaches 1
    // For quadratic interpolation, we'll use the finite difference approximation

    // Quadratic interpolation
    // The correct Lagrange quadratic formula coefficients for points at (-1,y0), (0,y1), (1,y2):
    // a = (y0 + y2)/2 - y1
    // b = (y2 - y0)/2
    // c = y1
    const int64_t a = (y0 + y2)/2 - y1;
    const int64_t b = (y2 - y0)/2;
    const int64_t c = y1;

    // Calculate polynomial a*t^2 + b*t + c
    const int64_t t_squared = Primitives::Fixed64Mul(t, t, kOutputFractionBits);
    int64_t result = c;
    result += Primitives::Fixed64Mul(b, t, kOutputFractionBits);
    result += Primitives::Fixed64Mul(a, t_squared, kOutputFractionBits);

    // Apply negative input formula if needed
    if (is_negative) {
        result = kPi - result;
    }

    // Convert result back to input format if needed
    if (input_fraction_bits != kOutputFractionBits) {
        if (input_fraction_bits < kOutputFractionBits) {
            result >>= (kOutputFractionBits - input_fraction_bits);
        } else {
            result <<= (input_fraction_bits - kOutputFractionBits);
        }
    }

    return result;
}

}  // namespace math::fp::detail