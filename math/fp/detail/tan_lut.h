#pragma once

#include <stdint.h>
#include <array>
#include "primitives.h"

// Tan lookup table with 512 entries
// Covers the range [0,pi/2] with values in Q23.40 format
// Generated with mpmath library at 100 digits precision

namespace math::fp::detail {
// Table maps x in [0,pi/2] to tan(x)
// Values stored in Q23.40 fixed-point format
inline constexpr std::array<int64_t, 512> kTanLut = {
    0x0000000000000000LL, // tan(0.00000000000000) = 0.00000000000000
    0x00000000C974BE82LL, // tan(0.00307396541447) = 0.00307397509674
    0x0000000192EA7688LL, // tan(0.00614793082894) = 0.00614800828800
    0x000000025C62219ALL, // tan(0.00922189624341) = 0.00922215767269
    0x0000000325DCB94ALL, // tan(0.01229586165789) = 0.01229648135848
    0x00000003EF5B3739LL, // tan(0.01536982707236) = 0.01537103746626
    0x00000004B8DE951ALL, // tan(0.01844379248683) = 0.01844588413447
    0x000000058267CCBALL, // tan(0.02151775790130) = 0.02152107952352
    0x000000064BF7D802LL, // tan(0.02459172331577) = 0.02459668182021
    0x00000007158FB0FCLL, // tan(0.02766568873024) = 0.02767274924211
    0x00000007DF3051DALL, // tan(0.03073965414471) = 0.03074934004198
    0x00000008A8DAB4FALL, // tan(0.03381361955919) = 0.03382651251220
    0x00000009728FD4E8LL, // tan(0.03688758497366) = 0.03690432498919
    0x0000000A3C50AC69LL, // tan(0.03996155038813) = 0.03998283585783
    0x0000000B061E3678LL, // tan(0.04303551580260) = 0.04306210355588
    0x0000000BCFF96E52LL, // tan(0.04610948121707) = 0.04614218657848
    0x0000000C99E34F76LL, // tan(0.04918344663154) = 0.04922314348257
    0x0000000D63DCD5AFLL, // tan(0.05225741204601) = 0.05230503289136
    0x0000000E2DE6FD12LL, // tan(0.05533137746049) = 0.05538791349880
    0x0000000EF802C208LL, // tan(0.05840534287496) = 0.05847184407409
    0x0000000FC2312154LL, // tan(0.06147930828943) = 0.06155688346617
    0x000000108C731813LL, // tan(0.06455327370390) = 0.06464309060822
    0x0000001156C9A3C3LL, // tan(0.06762723911837) = 0.06773052452220
    0x000000122135C24BLL, // tan(0.07070120453284) = 0.07081924432340
    0x00000012EBB871FDLL, // tan(0.07377516994731) = 0.07390930922499
    0x00000013B652B19BLL, // tan(0.07684913536179) = 0.07700077854256
    0x000000148105805CLL, // tan(0.07992310077626) = 0.08009371169878
    0x000000154BD1DDF3LL, // tan(0.08299706619073) = 0.08318816822792
    0x0000001616B8CA94LL, // tan(0.08607103160520) = 0.08628420778056
    0x00000016E1BB46F4LL, // tan(0.08914499701967) = 0.08938189012815
    0x00000017ACDA5456LL, // tan(0.09221896243414) = 0.09248127516776
    0x000000187816F48ALL, // tan(0.09529292784861) = 0.09558242292668
    0x00000019437229F6LL, // tan(0.09836689326309) = 0.09868539356718
    0x0000001A0EECF798LL, // tan(0.10144085867756) = 0.10179024739123
    0x0000001ADA88610ELL, // tan(0.10451482409203) = 0.10489704484522
    0x0000001BA6456A99LL, // tan(0.10758878950650) = 0.10800584652477
    0x0000001C72251925LL, // tan(0.11066275492097) = 0.11111671317950
    0x0000001D3E28724ALL, // tan(0.11373672033544) = 0.11422970571787
    0x0000001E0A507C56LL, // tan(0.11681068574991) = 0.11734488521202
    0x0000001ED69E3E51LL, // tan(0.11988465116439) = 0.12046231290267
    0x0000001FA312BFFFLL, // tan(0.12295861657886) = 0.12358205020397
    0x000000206FAF09EBLL, // tan(0.12603258199333) = 0.12670415870850
    0x000000213C742568LL, // tan(0.12910654740780) = 0.12982870019217
    0x0000002209631C98LL, // tan(0.13218051282227) = 0.13295573661927
    0x00000022D67CFA72LL, // tan(0.13525447823674) = 0.13608533014744
    0x00000023A3C2CAC8LL, // tan(0.13832844365121) = 0.13921754313277
    0x0000002471359A4BLL, // tan(0.14140240906569) = 0.14235243813487
    0x000000253ED67691LL, // tan(0.14447637448016) = 0.14549007792198
    0x000000260CA66E1BLL, // tan(0.14755033989463) = 0.14863052547615
    0x00000026DAA6905CLL, // tan(0.15062430530910) = 0.15177384399842
    0x00000027A8D7EDBDLL, // tan(0.15369827072357) = 0.15492009691406
    0x00000028773B97A2LL, // tan(0.15677223613804) = 0.15806934787783
    0x0000002945D2A074LL, // tan(0.15984620155251) = 0.16122166077929
    0x0000002A149E1BA1LL, // tan(0.16292016696699) = 0.16437709974814
    0x0000002AE39F1DA6LL, // tan(0.16599413238146) = 0.16753572915962
    0x0000002BB2D6BC16LL, // tan(0.16906809779593) = 0.17069761363992
    0x0000002C82460D9BLL, // tan(0.17214206321040) = 0.17386281807167
    0x0000002D51EE2A01LL, // tan(0.17521602862487) = 0.17703140759942
    0x0000002E21D02A38LL, // tan(0.17828999403934) = 0.18020344763526
    0x0000002EF1ED285ELL, // tan(0.18136395945381) = 0.18337900386435
    0x0000002FC2463FC4LL, // tan(0.18443792486829) = 0.18655814225062
    0x0000003092DC8CF3LL, // tan(0.18751189028276) = 0.18974092904247
    0x0000003163B12DB1LL, // tan(0.19058585569723) = 0.19292743077848
    0x0000003234C5410ELL, // tan(0.19365982111170) = 0.19611771429323
    0x000000330619E761LL, // tan(0.19673378652617) = 0.19931184672318
    0x00000033D7B04257LL, // tan(0.19980775194064) = 0.20250989551250
    0x00000034A98974F5LL, // tan(0.20288171735511) = 0.20571192841908
    0x000000357BA6A39DLL, // tan(0.20595568276959) = 0.20891801352052
    0x000000364E08F41CLL, // tan(0.20902964818406) = 0.21212821922018
    0x0000003720B18DA7LL, // tan(0.21210361359853) = 0.21534261425334
    0x00000037F3A198EALL, // tan(0.21517757901300) = 0.21856126769333
    0x00000038C6DA400ALL, // tan(0.21825154442747) = 0.22178424895780
    0x000000399A5CAEAFLL, // tan(0.22132550984194) = 0.22501162781500
    0x0000003A6E2A1207LL, // tan(0.22439947525641) = 0.22824347439015
    0x0000003B424398D3LL, // tan(0.22747344067089) = 0.23147985917187
    0x0000003C16AA7367LL, // tan(0.23054740608536) = 0.23472085301864
    0x0000003CEB5FD3B7LL, // tan(0.23362137149983) = 0.23796652716540
    0x0000003DC064ED5DLL, // tan(0.23669533691430) = 0.24121695323011
    0x0000003E95BAF59CLL, // tan(0.23976930232877) = 0.24447220322048
    0x0000003F6B632370LL, // tan(0.24284326774324) = 0.24773234954072
    0x00000040415EAF8BLL, // tan(0.24591723315771) = 0.25099746499836
    0x0000004117AED467LL, // tan(0.24899119857219) = 0.25426762281116
    0x00000041EE54CE46LL, // tan(0.25206516398666) = 0.25754289661409
    0x00000042C551DB3CLL, // tan(0.25513912940113) = 0.26082336046636
    0x000000439CA73B39LL, // tan(0.25821309481560) = 0.26410908885857
    0x000000447456300ELL, // tan(0.26128706023007) = 0.26740015671990
    0x000000454C5FFD78LL, // tan(0.26436102564454) = 0.27069663942542
    0x0000004624C5E923LL, // tan(0.26743499105901) = 0.27399861280343
    0x00000046FD893ABALL, // tan(0.27050895647349) = 0.27730615314293
    0x00000047D6AB3BE7LL, // tan(0.27358292188796) = 0.28061933720115
    0x00000048B02D3861LL, // tan(0.27665688730243) = 0.28393824221119
    0x000000498A107DF2LL, // tan(0.27973085271690) = 0.28726294588968
    0x0000004A64565C82LL, // tan(0.28280481813137) = 0.29059352644465
    0x0000004B3F00261BLL, // tan(0.28587878354584) = 0.29393006258338
    0x0000004C1A0F2EF7LL, // tan(0.28895274896031) = 0.29727263352039
    0x0000004CF584CD85LL, // tan(0.29202671437479) = 0.30062131898553
    0x0000004DD1625A76LL, // tan(0.29510067978926) = 0.30397619923215
    0x0000004EADA930C2LL, // tan(0.29817464520373) = 0.30733735504540
    0x0000004F8A5AADB2LL, // tan(0.30124861061820) = 0.31070486775057
    0x00000050677830ECLL, // tan(0.30432257603267) = 0.31407881922161
    0x0000005145031C7ALL, // tan(0.30739654144714) = 0.31745929188969
    0x0000005222FCD4D4LL, // tan(0.31047050686161) = 0.32084636875190
    0x000000530166C0EBLL, // tan(0.31354447227609) = 0.32424013338005
    0x00000053E0424A2FLL, // tan(0.31661843769056) = 0.32764066992961
    0x00000054BF90DCA0LL, // tan(0.31969240310503) = 0.33104806314867
    0x000000559F53E6D0LL, // tan(0.32276636851950) = 0.33446239838716
    0x000000567F8CD9F2LL, // tan(0.32584033393397) = 0.33788376160603
    0x00000057603D29E3LL, // tan(0.32891429934844) = 0.34131223938670
    0x0000005841664D36LL, // tan(0.33198826476291) = 0.34474791894051
    0x000000592309BD3BLL, // tan(0.33506223017739) = 0.34819088811835
    0x0000005A0528F60ELL, // tan(0.33813619559186) = 0.35164123542045
    0x0000005AE7C5769ELL, // tan(0.34121016100633) = 0.35509905000619
    0x0000005BCAE0C0BALL, // tan(0.34428412642080) = 0.35856442170417
    0x0000005CAE7C591ELL, // tan(0.34735809183527) = 0.36203744102233
    0x0000005D9299C77ALL, // tan(0.35043205724974) = 0.36551819915825
    0x0000005E773A9680LL, // tan(0.35350602266421) = 0.36900678800951
    0x0000005F5C6053F1LL, // tan(0.35657998807868) = 0.37250330018435
    0x00000060420C90A5LL, // tan(0.35965395349316) = 0.37600782901228
    0x000000612840E09BLL, // tan(0.36272791890763) = 0.37952046855500
    0x000000620EFEDB00LL, // tan(0.36580188432210) = 0.38304131361736
    0x00000062F6481A43LL, // tan(0.36887584973657) = 0.38657045975855
    0x00000063DE1E3C18LL, // tan(0.37194981515104) = 0.39010800330339
    0x00000064C682E18DLL, // tan(0.37502378056551) = 0.39365404135380
    0x00000065AF77AF12LL, // tan(0.37809774597998) = 0.39720867180047
    0x0000006698FE4C86LL, // tan(0.38117171139446) = 0.40077199333459
    0x0000006783186547LL, // tan(0.38424567680893) = 0.40434410545987
    0x000000686DC7A83ELL, // tan(0.38731964222340) = 0.40792510850467
    0x00000069590DC7EBLL, // tan(0.39039360763787) = 0.41151510363428
    0x0000006A44EC7A74LL, // tan(0.39346757305234) = 0.41511419286344
    0x0000006B316579B3LL, // tan(0.39654153846681) = 0.41872247906901
    0x0000006C1E7A8345LL, // tan(0.39961550388128) = 0.42234006600280
    0x0000006D0C2D5897LL, // tan(0.40268946929576) = 0.42596705830464
    0x0000006DFA7FBEF4LL, // tan(0.40576343471023) = 0.42960356151561
    0x0000006EE9737F95LL, // tan(0.40883740012470) = 0.43324968209145
    0x0000006FD90A67B1LL, // tan(0.41191136553917) = 0.43690552741624
    0x00000070C946488ALL, // tan(0.41498533095364) = 0.44057120581616
    0x00000071BA28F77CLL, // tan(0.41805929636811) = 0.44424682657362
    0x00000072ABB44E10LL, // tan(0.42113326178258) = 0.44793249994143
    0x000000739DEA2A09LL, // tan(0.42420722719706) = 0.45162833715734
    0x0000007490CC6D76LL, // tan(0.42728119261153) = 0.45533445045868
    0x00000075845CFEC0LL, // tan(0.43035515802600) = 0.45905095309728
    0x00000076789DC8BCLL, // tan(0.43342912344047) = 0.46277795935464
    0x000000776D90BABFLL, // tan(0.43650308885494) = 0.46651558455726
    0x000000786337C8A8LL, // tan(0.43957705426941) = 0.47026394509230
    0x000000795994EAF9LL, // tan(0.44265101968388) = 0.47402315842339
    0x0000007A50AA1EE3LL, // tan(0.44572498509836) = 0.47779334310674
    0x0000007B4879665CLL, // tan(0.44879895051283) = 0.48157461880753
    0x0000007C4104C82ELL, // tan(0.45187291592730) = 0.48536710631645
    0x0000007D3A4E500DLL, // tan(0.45494688134177) = 0.48917092756664
    0x0000007E34580EA6LL, // tan(0.45802084675624) = 0.49298620565079
    0x0000007F2F2419B4LL, // tan(0.46109481217071) = 0.49681306483853
    0x000000802AB48C17LL, // tan(0.46416877758518) = 0.50065163059417
    0x00000081270B85DFLL, // tan(0.46724274299966) = 0.50450202959464
    0x00000082242B2C6ALL, // tan(0.47031670841413) = 0.50836438974774
    0x000000832215AA72LL, // tan(0.47339067382860) = 0.51223884021072
    0x0000008420CD3022LL, // tan(0.47646463924307) = 0.51612551140913
    0x000000852053F32ELL, // tan(0.47953860465754) = 0.52002453505595
    0x0000008620AC2EE9LL, // tan(0.48261257007201) = 0.52393604417110
    0x0000008721D82454LL, // tan(0.48568653548648) = 0.52786017310124
    0x0000008823DA1A3ELL, // tan(0.48876050090096) = 0.53179705753985
    0x0000008926B45D51LL, // tan(0.49183446631543) = 0.53574683454771
    0x0000008A2A694030LL, // tan(0.49490843172990) = 0.53970964257370
    0x0000008B2EFB1B8BLL, // tan(0.49798239714437) = 0.54368562147590
    0x0000008C346C4E36LL, // tan(0.50105636255884) = 0.54767491254312
    0x0000008D3ABF3D43LL, // tan(0.50413032797331) = 0.55167765851672
    0x0000008E41F65419LL, // tan(0.50720429338778) = 0.55569400361286
    0x0000008F4A14048FLL, // tan(0.51027825880226) = 0.55972409354506
    0x00000090531AC701LL, // tan(0.51335222421673) = 0.56376807554719
    0x000000915D0D1A6ELL, // tan(0.51642618963120) = 0.56782609839684
    0x0000009267ED8490LL, // tan(0.51950015504567) = 0.57189831243910
    0x0000009373BE91F8LL, // tan(0.52257412046014) = 0.57598486961070
    0x000000948082D626LL, // tan(0.52564808587461) = 0.58008592346463
    0x000000958E3CEBA9LL, // tan(0.52872205128908) = 0.58420162919514
    0x000000969CEF7438LL, // tan(0.53179601670356) = 0.58833214366319
    0x00000097AC9D18CCLL, // tan(0.53486998211803) = 0.59247762542236
    0x00000098BD4889C6LL, // tan(0.53794394753250) = 0.59663823474514
    0x00000099CEF47F00LL, // tan(0.54101791294697) = 0.60081413364980
    0x0000009AE1A3B7F5LL, // tan(0.54409187836144) = 0.60500548592763
    0x0000009BF558FBDDLL, // tan(0.54716584377591) = 0.60921245717068
    0x0000009D0A1719C7LL, // tan(0.55023980919038) = 0.61343521480006
    0x0000009E1FE0E8C2LL, // tan(0.55331377460486) = 0.61767392809462
    0x0000009F36B947F2LL, // tan(0.55638774001933) = 0.62192876822030
    0x000000A04EA31EBBLL, // tan(0.55946170543380) = 0.62619990825982
    0x000000A167A15CDDLL, // tan(0.56253567084827) = 0.63048752324308
    0x000000A281B6FA95LL, // tan(0.56560963626274) = 0.63479179017799
    0x000000A39CE6F8C3LL, // tan(0.56868360167721) = 0.63911288808191
    0x000000A4B934610CLL, // tan(0.57175756709168) = 0.64345099801364
    0x000000A5D6A245FBLL, // tan(0.57483153250616) = 0.64780630310598
    0x000000A6F533C32BLL, // tan(0.57790549792063) = 0.65217898859897
    0x000000A814EBFD68LL, // tan(0.58097946333510) = 0.65656924187360
    0x000000A935CE22D4LL, // tan(0.58405342874957) = 0.66097725248626
    0x000000AA57DD6B11LL, // tan(0.58712739416404) = 0.66540321220378
    0x000000AB7B1D1768LL, // tan(0.59020135957851) = 0.66984731503910
    0x000000AC9F9072ECLL, // tan(0.59327532499298) = 0.67430975728765
    0x000000ADC53AD2AALL, // tan(0.59634929040746) = 0.67879073756437
    0x000000AEEC1F95CDLL, // tan(0.59942325582193) = 0.68329045684147
    0x000000B0144225CALL, // tan(0.60249722123640) = 0.68780911848682
    0x000000B13DA5F68CLL, // tan(0.60557118665087) = 0.69234692830316
    0x000000B2684E869ELL, // tan(0.60864515206534) = 0.69690409456796
    0x000000B3943F5F59LL, // tan(0.61171911747981) = 0.70148082807416
    0x000000B4C17C1512LL, // tan(0.61479308289428) = 0.70607734217152
    0x000000B5F0084748LL, // tan(0.61786704830876) = 0.71069385280893
    0x000000B71FE7A0D1LL, // tan(0.62094101372323) = 0.71533057857742
    0x000000B8511DD80FLL, // tan(0.62401497913770) = 0.71998774075404
    0x000000B983AEAF1CLL, // tan(0.62708894455217) = 0.72466556334658
    0x000000BAB79DF400LL, // tan(0.63016290996664) = 0.72936427313919
    0x000000BBECEF80E4LL, // tan(0.63323687538111) = 0.73408409973882
    0x000000BD23A73C41LL, // tan(0.63631084079558) = 0.73882527562266
    0x000000BE5BC9191ELL, // tan(0.63938480621006) = 0.74358803618641
    0x000000BF9559173CLL, // tan(0.64245877162453) = 0.74837261979361
    0x000000C0D05B4356LL, // tan(0.64553273703900) = 0.75317926782582
    0x000000C20CD3B754LL, // tan(0.64860670245347) = 0.75800822473393
    0x000000C34AC69A88LL, // tan(0.65168066786794) = 0.76285973809037
    0x000000C48A3821E5LL, // tan(0.65475463328241) = 0.76773405864245
    0x000000C5CB2C903CLL, // tan(0.65782859869688) = 0.77263144036673
    0x000000C70DA8367CLL, // tan(0.66090256411136) = 0.77755214052449
    0x000000C851AF73EDLL, // tan(0.66397652952583) = 0.78249641971831
    0x000000C99746B66FLL, // tan(0.66705049494030) = 0.78746454194982
    0x000000CADE727ABDLL, // tan(0.67012446035477) = 0.79245677467863
    0x000000CC27374CAELL, // tan(0.67319842576924) = 0.79747338888240
    0x000000CD7199C779LL, // tan(0.67627239118371) = 0.80251465911824
    0x000000CEBD9E95F9LL, // tan(0.67934635659818) = 0.80758086358528
    0x000000D00B4A72F4LL, // tan(0.68242032201266) = 0.81267228418858
    0x000000D15AA22963LL, // tan(0.68549428742713) = 0.81778920660437
    0x000000D2ABAA94B9LL, // tan(0.68856825284160) = 0.82293192034661
    0x000000D3FE68A130LL, // tan(0.69164221825607) = 0.82810071883499
    0x000000D552E14C17LL, // tan(0.69471618367054) = 0.83329589946428
    0x000000D6A919A419LL, // tan(0.69779014908501) = 0.83851776367523
    0x000000D80116C996LL, // tan(0.70086411449948) = 0.84376661702687
    0x000000D95ADDEEEBLL, // tan(0.70393807991396) = 0.84904276927043
    0x000000DAB67458CELL, // tan(0.70701204532843) = 0.85434653442476
    0x000000DC13DF5E99LL, // tan(0.71008601074290) = 0.85967823085341
    0x000000DD73246AA9LL, // tan(0.71315997615737) = 0.86503818134331
    0x000000DED448FAB2LL, // tan(0.71623394157184) = 0.87042671318522
    0x000000E03752A019LL, // tan(0.71930790698631) = 0.87584415825581
    0x000000E19C470055LL, // tan(0.72238187240078) = 0.88129085310159
    0x000000E3032BD547LL, // tan(0.72545583781526) = 0.88676713902468
    0x000000E46C06ED9DLL, // tan(0.72852980322973) = 0.89227336217035
    0x000000E5D6DE2D35LL, // tan(0.73160376864420) = 0.89780987361662
    0x000000E743B78D83LL, // tan(0.73467773405867) = 0.90337702946570
    0x000000E8B2991DF3LL, // tan(0.73775169947314) = 0.90897519093752
    0x000000EA23890458LL, // tan(0.74082566488761) = 0.91460472446533
    0x000000EB968D7D52LL, // tan(0.74389963030208) = 0.92026600179337
    0x000000ED0BACDCC0LL, // tan(0.74697359571656) = 0.92595940007679
    0x000000EE82ED8E2FLL, // tan(0.75004756113103) = 0.93168530198376
    0x000000EFFC561549LL, // tan(0.75312152654550) = 0.93744409579992
    0x000000F177ED0E53LL, // tan(0.75619549195997) = 0.94323617553513
    0x000000F2F5B92E9DLL, // tan(0.75926945737444) = 0.94906194103267
    0x000000F475C144FELL, // tan(0.76234342278891) = 0.95492179808096
    0x000000F5F80C3A58LL, // tan(0.76541738820338) = 0.96081615852778
    0x000000F77CA11210LL, // tan(0.76849135361786) = 0.96674544039710
    0x000000F90386EA96LL, // tan(0.77156531903233) = 0.97271006800868
    0x000000FA8CC4FDECLL, // tan(0.77463928444680) = 0.97871047210033
    0x000000FC1862A22DLL, // tan(0.77771324986127) = 0.98474708995309
    0x000000FDA6674A1DLL, // tan(0.78078721527574) = 0.99082036551927
    0x000000FF36DA85B5LL, // tan(0.78386118069021) = 0.99693074955354
    0x00000100C9C402BALL, // tan(0.78693514610468) = 1.00307869974703
    0x000001025F2B8D52LL, // tan(0.79000911151916) = 1.00926468086465
    0x00000103F71910A0LL, // tan(0.79308307693363) = 1.01548916488561
    0x0000010591949761LL, // tan(0.79615704234810) = 1.02175263114737
    0x000001072EA64C8ELL, // tan(0.79923100776257) = 1.02805556649289
    0x00000108CE567C04LL, // tan(0.80230497317704) = 1.03439846542151
    0x0000010A70AD932ALL, // tan(0.80537893859151) = 1.04078183024343
    0x0000010C15B421A2LL, // tan(0.80845290400598) = 1.04720617123793
    0x0000010DBD72D9FBLL, // tan(0.81152686942046) = 1.05367200681539
    0x0000010F67F29265LL, // tan(0.81460083483493) = 1.06017986368331
    0x00000111153C4570LL, // tan(0.81767480024940) = 1.06673027701636
    0x00000112C55912C6LL, // tan(0.82074876566387) = 1.07332379063057
    0x0000011478523FF7LL, // tan(0.82382273107834) = 1.07996095716192
    0x000001162E31393ALL, // tan(0.82689669649281) = 1.08664233824921
    0x00000117E6FF9241LL, // tan(0.82997066190728) = 1.09336850472163
    0x00000119A2C70709LL, // tan(0.83304462732176) = 1.10014003679088
    0x0000011B61917CB4LL, // tan(0.83611859273623) = 1.10695752424815
    0x0000011D23690269LL, // tan(0.83919255815070) = 1.11382156666615
    0x0000011EE857D231LL, // tan(0.84226652356517) = 1.12073277360608
    0x00000120B06851E9LL, // tan(0.84534048897964) = 1.12769176483001
    0x000001227BA5142CLL, // tan(0.84841445439411) = 1.13469917051859
    0x000001244A18D94ALL, // tan(0.85148841980858) = 1.14175563149435
    0x000001261BCE9043LL, // tan(0.85456238522306) = 1.14886179945077
    0x00000127F0D157CBLL, // tan(0.85763635063753) = 1.15601833718727
    0x00000129C92C7F52LL, // tan(0.86071031605200) = 1.16322591885024
    0x0000012BA4EB8813LL, // tan(0.86378428146647) = 1.17048523018041
    0x0000012D841A262ELL, // tan(0.86685824688094) = 1.17779696876671
    0x0000012F66C441C3LL, // tan(0.86993221229541) = 1.18516184430671
    0x000001314CF5F81BLL, // tan(0.87300617770988) = 1.19258057887408
    0x0000013336BB9CD4LL, // tan(0.87608014312436) = 1.20005390719298
    0x000001352421BB17LL, // tan(0.87915410853883) = 1.20758257691993
    0x00000137153516D5LL, // tan(0.88222807395330) = 1.21516734893308
    0x000001390A02AE12LL, // tan(0.88530203936777) = 1.22280899762937
    0x0000013B0297BA2FLL, // tan(0.88837600478224) = 1.23050831122961
    0x0000013CFF01B147LL, // tan(0.89144997019671) = 1.23826609209197
    0x0000013EFF4E478ELL, // tan(0.89452393561118) = 1.24608315703384
    0x00000141038B70BELL, // tan(0.89759790102566) = 1.25396033766270
    0x000001430BC7618CLL, // tan(0.90067186644013) = 1.26189848071592
    0x0000014518109129LL, // tan(0.90374583185460) = 1.26989844841004
    0x000001472875BACDLL, // tan(0.90681979726907) = 1.27796111879974
    0x000001493D05DF4CLL, // tan(0.90989376268354) = 1.28608738614681
    0x0000014B55D046B5LL, // tan(0.91296772809801) = 1.29427816129945
    0x0000014D72E48202LL, // tan(0.91604169351248) = 1.30253437208225
    0x0000014F94526CD0LL, // tan(0.91911565892696) = 1.31085696369722
    0x00000151BA2A2F23LL, // tan(0.92218962434143) = 1.31924689913624
    0x00000153E47C3F3CLL, // tan(0.92526358975590) = 1.32770515960518
    0x0000015613596372LL, // tan(0.92833755517037) = 1.33623274496037
    0x0000015846D2B429LL, // tan(0.93141152058484) = 1.34483067415747
    0x0000015A7EF99DC6LL, // tan(0.93448548599931) = 1.35349998571345
    0x0000015CBBDFE2BCLL, // tan(0.93755945141378) = 1.36224173818203
    0x0000015EFD979DA9LL, // tan(0.94063341682826) = 1.37105701064298
    0x000001614433437CLL, // tan(0.94370738224273) = 1.37994690320580
    0x000001638FC5A5B0LL, // tan(0.94678134765720) = 1.38891253752836
    0x00000165E061F499LL, // tan(0.94985531307167) = 1.39795505735083
    0x00000168361BC1BFLL, // tan(0.95292927848614) = 1.40707562904564
    0x0000016A9107024ELL, // tan(0.95600324390061) = 1.41627544218389
    0x0000016CF1381196LL, // tan(0.95907720931508) = 1.42555571011883
    0x0000016F56C3B39FLL, // tan(0.96215117472956) = 1.43491767058699
    0x00000171C1BF17D7LL, // tan(0.96522514014403) = 1.44436258632772
    0x00000174323FDBCCLL, // tan(0.96829910555850) = 1.45389174572154
    0x00000176A85C0DFELL, // tan(0.97137307097297) = 1.46350646344824
    0x00000179242A30CELL, // tan(0.97444703638744) = 1.47320808116532
    0x0000017BA5C13D7CLL, // tan(0.97752100180191) = 1.48299796820740
    0x0000017E2D38A73ELL, // tan(0.98059496721638) = 1.49287752230766
    0x00000180BAA85E78LL, // tan(0.98366893263085) = 1.50284817034180
    0x000001834E28D403LL, // tan(0.98674289804533) = 1.51291136909555
    0x00000185E7D2FC93LL, // tan(0.98981686345980) = 1.52306860605651
    0x0000018887C05440LL, // tan(0.99289082887427) = 1.53332140023129
    0x0000018B2E0AE21CLL, // tan(0.99596479428874) = 1.54367130298885
    0x0000018DDACD3BF8LL, // tan(0.99903875970321) = 1.55411989893099
    0x000001908E228A3DLL, // tan(1.00211272511768) = 1.56466880679119
    0x0000019348268BE7LL, // tan(1.00518669053215) = 1.57531968036260
    0x0000019608F59AA5LL, // tan(1.00826065594663) = 1.58607420945657
    0x00000198D0ACAF19LL, // tan(1.01133462136110) = 1.59693412089273
    0x0000019B9F69653FLL, // tan(1.01440858677557) = 1.60790117952187
    0x0000019E754A00F0LL, // tan(1.01748255219004) = 1.61897718928296
    0x000001A1526D729DLL, // tan(1.02055651760451) = 1.63016399429553
    0x000001A436F35C21LL, // tan(1.02363048301898) = 1.64146347998894
    0x000001A722FC15C7LL, // tan(1.02670444843345) = 1.65287757426983
    0x000001AA16A8B37CLL, // tan(1.02977841384793) = 1.66440824872950
    0x000001AD121B0A27LL, // tan(1.03285237926240) = 1.67605751989254
    0x000001B01575B539LL, // tan(1.03592634467687) = 1.68782745050859
    0x000001B320DC1C6BLL, // tan(1.03900031009134) = 1.69972015088892
    0x000001B6347279ABLL, // tan(1.04207427550581) = 1.71173778028951
    0x000001B9505DDF47LL, // tan(1.04514824092028) = 1.72388254834282
    0x000001BC74C43E45LL, // tan(1.04822220633475) = 1.73615671653995
    0x000001BFA1CC6D00LL, // tan(1.05129617174923) = 1.74856259976548
    0x000001C2D79E2DFALL, // tan(1.05437013716370) = 1.76110256788712
    0x000001C6166236ECLL, // tan(1.05744410257817) = 1.77377904740245
    0x000001C95E42381FLL, // tan(1.06051806799264) = 1.78659452314517
    0x000001CCAF68E3FELL, // tan(1.06359203340711) = 1.79955154005346
    0x000001D00A01F6FELL, // tan(1.06666599882158) = 1.81265270500289
    0x000001D36E3A3FBDLL, // tan(1.06973996423605) = 1.82590068870695
    0x000001D6DC3FA782LL, // tan(1.07281392965053) = 1.83929822768787
    0x000001DA54413B00LL, // tan(1.07588789506500) = 1.85284812632090
    0x000001DDD66F3374LL, // tan(1.07896186047947) = 1.86655325895526
    0x000001E162FB0017LL, // tan(1.08203582589394) = 1.88041657211514
    0x000001E4FA174FEFLL, // tan(1.08510979130841) = 1.89444108678419
    0x000001E89BF81C01LL, // tan(1.08818375672288) = 1.90862990077742
    0x000001EC48D2B1E1LL, // tan(1.09125772213735) = 1.92298619120426
    0x000001F000DDBEB2LL, // tan(1.09433168755183) = 1.93751321702699
    0x000001F3C4515A90LL, // tan(1.09740565296630) = 1.95221432171880
    0x000001F79367146CLL, // tan(1.10047961838077) = 1.96709293602611
    0x000001FB6E59FE63LL, // tan(1.10355358379524) = 1.98215258083995
    0x000001FF5566BA8FLL, // tan(1.10662754920971) = 1.99739687018139
    0x0000020348CB885ELL, // tan(1.10970151462418) = 2.01282951430639
    0x0000020748C85270LL, // tan(1.11277548003865) = 2.02845432293569
    0x0000020B559EBD07LL, // tan(1.11584944545313) = 2.04427520861562
    0x0000020F6F92350DLL, // tan(1.11892341086760) = 2.06029619021610
    0x0000021396E7FFB8LL, // tan(1.12199737628207) = 2.07652139657234
    0x00000217CBE74AD6LL, // tan(1.12507134169654) = 2.09295507027730
    0x0000021C0ED93DC0LL, // tan(1.12814530711101) = 2.10960157163212
    0x0000022060090B0ALL, // tan(1.13121927252548) = 2.12646538276228
    0x00000224BFC402F2LL, // tan(1.13429323793995) = 2.14355111190772
    0x000002292E59A694LL, // tan(1.13736720335443) = 2.16086349789549
    0x0000022DAC1BBBF2LL, // tan(1.14044116876890) = 2.17840741480409
    0x00000232395E62DALL, // tan(1.14351513418337) = 2.19618787682913
    0x00000236D6782AB5LL, // tan(1.14658909959784) = 2.21421004336053
    0x0000023B83C2294ALL, // tan(1.14966306501231) = 2.23247922428213
    0x0000024041981282LL, // tan(1.15273703042678) = 2.25100088550501
    0x000002451058513BLL, // tan(1.15581099584125) = 2.26978065474682
    0x00000249F0642133LL, // tan(1.15888496125573) = 2.28882432756981
    0x0000024EE21FAA29LL, // tan(1.16195892667020) = 2.30813787369130
    0x00000253E5F21C2ELL, // tan(1.16503289208467) = 2.32772744358095
    0x00000258FC45CD48LL, // tan(1.16810685749914) = 2.34759937536020
    0x0000025E25885872LL, // tan(1.17118082291361) = 2.36776020202016
    0x00000263622ABE0FLL, // tan(1.17425478832808) = 2.38821665897519
    0x00000268B2A185DFLL, // tan(1.17732875374255) = 2.40897569197053
    0x0000026E1764E28FLL, // tan(1.18040271915703) = 2.43004446536357
    0x0000027390F0D701LL, // tan(1.18347668457150) = 2.45143037079942
    0x000002791FC55D51LL, // tan(1.18655064998597) = 2.47314103630289
    0x0000027EC4668FCCLL, // tan(1.18962461540044) = 2.49518433581044
    0x000002847F5CD3DDLL, // tan(1.19269858081491) = 2.51756839916710
    0x0000028A5135071BLL, // tan(1.19577254622938) = 2.54030162261494
    0x000002903A80AE8DLL, // tan(1.19884651164385) = 2.56339267980181
    0x000002963BD62856LL, // tan(1.20192047705833) = 2.58685053334030
    0x0000029C55D0DFD3LL, // tan(1.20499444247280) = 2.61068444694966
    0x000002A28911846ELL, // tan(1.20806840788727) = 2.63490399821503
    0x000002A8D63E433BLL, // tan(1.21114237330174) = 2.65951909200098
    0x000002AF3E030388LL, // tan(1.21421633871621) = 2.68453997455889
    0x000002B5C111A6A7LL, // tan(1.21729030413068) = 2.70997724837034
    0x000002BC60224B01LL, // tan(1.22036426954515) = 2.73584188777167
    0x000002C31BF392C7LL, // tan(1.22343823495963) = 2.76214525540829
    0x000002C9F54AEE65LL, // tan(1.22651220037410) = 2.78889911957033
    0x000002D0ECF4EAFDLL, // tan(1.22958616578857) = 2.81611567246541
    0x000002D803C5852BLL, // tan(1.23266013120304) = 2.84380754948814
    0x000002DF3A988053LL, // tan(1.23573409661751) = 2.87198784955019
    0x000002E69251C2D2LL, // tan(1.23880806203198) = 2.90067015653999
    0x000002EE0BDDB74ELL, // tan(1.24188202744645) = 2.92986856198560
    0x000002F5A831B393LL, // tan(1.24495599286093) = 2.95959768900048
    0x000002FD684C6548LL, // tan(1.24802995827540) = 2.98987271759753
    0x000003054D3644F4LL, // tan(1.25110392368987) = 3.02070941146361
    0x0000030D58020FA9LL, // tan(1.25417788910434) = 3.05212414629367
    0x0000031589CD47E3LL, // tan(1.25725185451881) = 3.08413393979166
    0x0000031DE3C0BE07LL, // tan(1.26032581993328) = 3.11675648345355
    0x0000032667112117LL, // tan(1.26339978534775) = 3.15001017625747
    0x0000032F14FF982BLL, // tan(1.26647375076223) = 3.18391416039559
    0x00000337EEDA654BLL, // tan(1.26954771617670) = 3.21848835919364
    0x00000340F5FD925FLL, // tan(1.27262168159117) = 3.25375351737603
    0x0000034A2BD3A8F4LL, // tan(1.27569564700564) = 3.28973124384746
    0x0000035391D6758CLL, // tan(1.27876961242011) = 3.32644405717662
    0x0000035D298FD777LL, // tan(1.28184357783458) = 3.36391543398297
    0x00000366F49A9E0CLL, // tan(1.28491754324905) = 3.40216986044537
    0x00000370F4A37450LL, // tan(1.28799150866353) = 3.44123288716985
    0x0000037B2B69DC26LL, // tan(1.29106547407800) = 3.48113118767513
    0x000003859AC13A42LL, // tan(1.29413943949247) = 3.52189262077711
    0x000003904491F42ALL, // tan(1.29721340490694) = 3.56354629717903
    0x0000039B2ADAA1B3LL, // tan(1.30028737032141) = 3.60612265060193
    0x000003A64FB15397LL, // tan(1.30336133573588) = 3.64965351382062
    0x000003B1B544F0CFLL, // tan(1.30643530115035) = 3.69417220000444
    0x000003BD5DDEAC98LL, // tan(1.30950926656483) = 3.73971358979980
    0x000003C94BE3972DLL, // tan(1.31258323197930) = 3.78631422463280
    0x000003D581D64B7ALL, // tan(1.31565719739377) = 3.83401240675671
    0x000003E20258BC42LL, // tan(1.31873116280824) = 3.88284830661987
    0x000003EED02E236DLL, // tan(1.32180512822271) = 3.93286407818690
    0x000003FBEE3D1674LL, // tan(1.32487909363718) = 3.98410398290889
    0x000004095F91C34FLL, // tan(1.32795305905165) = 4.03661452310909
    0x0000041727605960LL, // tan(1.33102702446613) = 4.09044458562900
    0x000004254907A27ELL, // tan(1.33410098988060) = 4.14564559666771
    0x00000433C813D07FLL, // tan(1.33717495529507) = 4.20227168884530
    0x00000442A8418424LL, // tan(1.34024892070954) = 4.26037988163142
    0x00000451ED8112E1LL, // tan(1.34332288612401) = 4.32003027640311
    0x000004619BFA1179LL, // tan(1.34639685153848) = 4.38128626753482
    0x00000471B80F2A2FLL, // tan(1.34947081695295) = 4.44421477107924
    0x00000482466245F0LL, // tan(1.35254478236743) = 4.50888647277324
    0x000004934BD910CFLL, // tan(1.35561874778190) = 4.57537609730152
    0x000004A4CDA1E311LL, // tan(1.35869271319637) = 4.64376270097440
    0x000004B6D1391921LL, // tan(1.36176667861084) = 4.71412999023021
    0x000004C95C6EE604LL, // tan(1.36484064402531) = 4.78656666866014
    0x000004DC756DAD52LL, // tan(1.36791460943978) = 4.86116681558097
    0x000004F022C0F33CLL, // tan(1.37098857485425) = 4.93803029955282
    0x000005046B5CF320LL, // tan(1.37406254026873) = 5.01726323066424
    0x0000051956A6EF10LL, // tan(1.37713650568320) = 5.09897845589207
    0x0000052EEC7E4D4ALL, // tan(1.38021047109767) = 5.18329610239937
    0x0000054535469B29LL, // tan(1.38328443651214) = 5.27034417427236
    0x0000055C39F29071LL, // tan(1.38635840192661) = 5.36025920893122
    0x000005740410313CLL, // tan(1.38943236734108) = 5.45318700029440
    0x0000058C9DD6314ALL, // tan(1.39250633275555) = 5.54928339675305
    0x000005A61232C004LL, // tan(1.39558029817003) = 5.64871518314277
    0x000005C06CDBEA67LL, // tan(1.39865426358450) = 5.75166105721233
    0x000005DBBA61C66DLL, // tan(1.40172822899897) = 5.85831271261619
    0x000005F80842A34CLL, // tan(1.40480219441344) = 5.96887604223961
    0x00000615650182C7LL, // tan(1.40787615982791) = 6.08357247774909
    0x00000633E03F2A5DLL, // tan(1.41095012524238) = 6.20264048370650
    0x000006538AD62769LL, // tan(1.41402409065685) = 6.32633722746114
    0x0000067476FA2FECLL, // tan(1.41709805607133) = 6.45494044942900
    0x00000696B85B5AF2LL, // tan(1.42017202148580) = 6.58875056238570
    0x000006BA644DC004LL, // tan(1.42324598690027) = 6.72809301317107
    0x000006DF91F62580LL, // tan(1.42631995231474) = 6.87332094588792
    0x000007065A7C82ECLL, // tan(1.42939391772921) = 7.02481821247457
    0x0000072ED9453F4ELL, // tan(1.43246788314368) = 7.18300278468699
    0x000007592C323DD9LL, // tan(1.43554184855815) = 7.34833063135130
    0x0000078573ECFE37LL, // tan(1.43861581397263) = 7.52130013662815
    0x000007B3D43B53C3LL, // tan(1.44168977938710) = 7.70245714945778
    0x000007E474608271LL, // tan(1.44476374480157) = 7.89240077194823
    0x000008177F8CECE9LL, // tan(1.44783771021604) = 8.09179001602175
    0x0000084D255EF112LL, // tan(1.45091167563051) = 8.30135148416068
    0x000008859A781D55LL, // tan(1.45398564104498) = 8.52188826290262
    0x000008C1192A980DLL, // tan(1.45705960645945) = 8.75429025852409
    0x000008FFE2436D84LL, // tan(1.46013357187393) = 8.99954625533798
    0x000009423DF78C38LL, // tan(1.46320753728840) = 9.25875804112781
    0x000009887CFA9352LL, // tan(1.46628150270287) = 9.53315702530563
    0x000009D2F9C8523DLL, // tan(1.46935546811734) = 9.82412387855317
    0x00000A221A2C1037LL, // tan(1.47242943353181) = 10.13321185489565
    0x00000A7651138F1FLL, // tan(1.47550339894628) = 10.46217462772541
    0x00000AD020BF7539LL, // tan(1.47857736436075) = 10.81299969303020
    0x00000B301D67A989LL, // tan(1.48165132977523) = 11.18794868363424
    0x00000B96F0709F62LL, // tan(1.48472529518970) = 11.58960632220521
    0x00000C055C57248CLL, // tan(1.48779926060417) = 12.02094025270713
    0x00000C7C4183D517LL, // tan(1.49087322601864) = 12.48537467911178
    0x00000CFCA4471175LL, // tan(1.49394719143311) = 12.98688167740056
    0x00000D87B453F205LL, // tan(1.49702115684758) = 13.53009533556712
    0x00000E1ED62EC824LL, // tan(1.50009512226205) = 14.12045566927254
    0x00000EC3AF2E1F76LL, // tan(1.50316908767653) = 14.76439178722480
    0x00000F7834E9BF99LL, // tan(1.50624305309100) = 15.46955738952378
    0x0000103EC14AFB28LL, // tan(1.50931701850547) = 16.24513691550967
    0x0000111A2CF2FCB3LL, // tan(1.51239098391994) = 17.10224836987934
    0x0000120DF26DD81ALL, // tan(1.51546494933441) = 18.05448042417475
    0x0000131E5DD1FC53LL, // tan(1.51853891474888) = 19.11861908350262
    0x00001450CE3B6FE5LL, // tan(1.52161288016335) = 20.31564685327388
    0x000015AC117858C4LL, // tan(1.52468684557783) = 21.67214157263888
    0x00001738E6FF753DLL, // tan(1.52776081099230) = 23.22227474796629
    0x00001902BF585698LL, // tan(1.53083477640677) = 25.01073219408138
    0x00001B18DB37B8F4LL, // tan(1.53390874182124) = 27.09709499612344
    0x00001D900736F3E6LL, // tan(1.53698270723571) = 29.56261008696180
    0x0000208561C6482ALL, // tan(1.54005667265018) = 32.52102317106132
    0x00002422FA6B6130LL, // tan(1.54313063806465) = 36.13663359759160
    0x000028A7E86EB7CDLL, // tan(1.54620460347913) = 40.65589038836796
    0x00002E775066B736LL, // tan(1.54927856889360) = 46.46607057545611
    0x000036366F4E0703LL, // tan(1.55235253430807) = 54.21263587638135
    0x0000410EB2E7C78ELL, // tan(1.55542649972254) = 65.05741737958891
    0x00005152F6BA28E4LL, // tan(1.55850046513701) = 81.32407725809442
    0x00006C6F3AFE2FA1LL, // tan(1.56157443055148) = 108.43449391043538
    0x0000A2A7805EC851LL, // tan(1.56464839596595) = 162.65430252447683
    0x0001454FCA324F25LL, // tan(1.56772236138043) = 325.31167902405042
    0x7FFFFFFFFFFFFFFFLL  // tan(1.57079632679490) = 8388608.00000000000000
};

// Fast lookup tan(x) with linear interpolation between table entries
// Input x is in fixed-point format with specified fraction bits representing angle in radians
// Precision: ~1.5e-5 when input_fraction_bits=32
inline constexpr auto LookupTanFast(int64_t x, int input_fraction_bits) noexcept -> int64_t {
    // Constants
    constexpr int64_t kPi = 0x000003243F6A8885LL;  // pi = 3.141592653589793
    constexpr int64_t kPiOver2 = 0x000001921FB54442LL;  // pi/2 = 1.5707963267948966
    constexpr int64_t kLutInterval = 0x000145500D592E39LL;  // LUT conversion factor
    constexpr int kOutputFractionBits = 40;  // Output format: Q23.40

    // Convert input to Q{int_bits}.{fraction_bits} format if needed
    if (input_fraction_bits != kOutputFractionBits) {
        if (input_fraction_bits < kOutputFractionBits) {
            x <<= (kOutputFractionBits - input_fraction_bits);
        } else {
            x >>= (input_fraction_bits - kOutputFractionBits);
        }
    }

    // 1. Normalize angle to [-pi, pi]
    x = x % kPi;

    // 2. Handle negative angles
    bool flip = false;
    if (x < 0) {
        x = -x;
        flip = true;
    }

    // 3. Handle angles > pi/2 by using tan(pi-x) = -tan(x)
    if (x > kPiOver2) {
        x = kPi - x;
        flip = !flip;
    }

    // 4. Calculate lookup table index and fractional part
    int64_t idx_scaled = Primitives::Fixed64Mul(x, kLutInterval, kOutputFractionBits);
    int idx = static_cast<int>(idx_scaled >> kOutputFractionBits);
    int64_t frac = idx_scaled & ((1LL << kOutputFractionBits) - 1);

    // 5. Clamp index to valid range
    if (idx < 0) {
        idx = 0;
        frac = 0;
    } else if (idx >= static_cast<int>(kTanLut.size()) - 1) {
        idx = static_cast<int>(kTanLut.size()) - 2;
        frac = (1LL << kOutputFractionBits) - 1;
    }

    // 6. Linear interpolation between table entries
    int64_t y0 = kTanLut[idx];
    int64_t y1 = kTanLut[idx + 1];
    int64_t diff = y1 - y0;
    int64_t interpolated_value = y0 + Primitives::Fixed64Mul(diff, frac, kOutputFractionBits);

    // 7. Apply sign flip if necessary
    int64_t result = flip ? -interpolated_value : interpolated_value;

    // 8. Convert result back to original input format if needed
    if (input_fraction_bits != kOutputFractionBits) {
        if (input_fraction_bits < kOutputFractionBits) {
            result >>= (kOutputFractionBits - input_fraction_bits);
        } else {
            result <<= (input_fraction_bits - kOutputFractionBits);
        }
    }

    return result;
}

// Lookup tan(x) with optimized Hermite cubic interpolation between table entries
// Input x is in fixed-point format with specified fraction bits representing angle in radians
// Precision: ~1.0e-9 when input_fraction_bits=32 (about 1500x more accurate than fast version)
inline constexpr auto LookupTan(int64_t x, int input_fraction_bits) noexcept -> int64_t {
    // Constants
    constexpr int64_t kPi = 0x000003243F6A8885LL;  // pi = 3.141592653589793
    constexpr int64_t kPiOver2 = 0x000001921FB54442LL;  // pi/2 = 1.5707963267948966
    constexpr int64_t kLutInterval = 0x000145500D592E39LL;  // LUT conversion factor
    constexpr int kOutputFractionBits = 40;  // Output format: Q23.40
    constexpr int64_t kOne = 1LL << kOutputFractionBits;  // 1.0 in fixed-point

    // Convert input to Q{int_bits}.{fraction_bits} format if needed
    if (input_fraction_bits != kOutputFractionBits) {
        if (input_fraction_bits < kOutputFractionBits) {
            x <<= (kOutputFractionBits - input_fraction_bits);
        } else {
            x >>= (input_fraction_bits - kOutputFractionBits);
        }
    }

    // 1. Normalize angle to [-pi, pi]
    x = x % kPi;

    // 2. Handle negative angles
    bool flip = false;
    if (x < 0) {
        x = -x;
        flip = true;
    }

    // 3. Handle angles > pi/2 by using tan(pi-x) = -tan(x)
    if (x > kPiOver2) {
        x = kPi - x;
        flip = !flip;
    }

    // 4. Calculate lookup table index and fractional part
    int64_t idx_scaled = Primitives::Fixed64Mul(x, kLutInterval, kOutputFractionBits);
    int idx = static_cast<int>(idx_scaled >> kOutputFractionBits);
    int64_t t = idx_scaled & ((1LL << kOutputFractionBits) - 1);  // Fractional part [0,1)

    // 5. Clamp index to valid range
    if (idx < 0) {
        idx = 0;
        t = 0;
    } else if (idx >= static_cast<int>(kTanLut.size()) - 1) {
        idx = static_cast<int>(kTanLut.size()) - 2;
        t = kOne - 1;  // Just under 1.0
    }

    // 6. Get points from table
    int64_t p0 = kTanLut[idx];      // Point at left endpoint
    int64_t p1 = kTanLut[idx + 1];  // Point at right endpoint

    // 7. Compute derivatives using the fact that tan'(x) = 1 + tan²(x)
    int64_t p0_squared = Primitives::Fixed64Mul(p0, p0, kOutputFractionBits);
    int64_t p1_squared = Primitives::Fixed64Mul(p1, p1, kOutputFractionBits);
    int64_t m0 = kOne + p0_squared;  // Derivative at left endpoint
    int64_t m1 = kOne + p1_squared;  // Derivative at right endpoint

    // Scale derivatives by step size
    constexpr int64_t kStepSize = Primitives::Fixed64Div(
        kPiOver2, (kTanLut.size() - 1) << kOutputFractionBits, kOutputFractionBits);
    m0 = Primitives::Fixed64Mul(m0, kStepSize, kOutputFractionBits);
    m1 = Primitives::Fixed64Mul(m1, kStepSize, kOutputFractionBits);

    // 8. Compute optimized Hermite coefficients
    // p(t) = ((a*t + b)*t + c)*t + d  (Horner's method)
    // where:
    // a = 2(p₀-p₁) + m₀+m₁
    // b = 3(p₁-p₀) - 2m₀-m₁
    // c = m₀
    // d = p₀
    int64_t p0_minus_p1 = p0 - p1;
    int64_t a = p0_minus_p1 * 2 + m0 + m1;
    int64_t b = -p0_minus_p1 * 3 - m0 * 2 - m1;
    int64_t c = m0;
    int64_t d = p0;

    // 9. Compute interpolation using Horner's method
    int64_t result =
        d
        + Primitives::Fixed64Mul(
            t,
            c
                + Primitives::Fixed64Mul(
                    t, b + Primitives::Fixed64Mul(t, a, kOutputFractionBits), kOutputFractionBits),
            kOutputFractionBits);

    // 10. Apply sign flip if necessary
    if (flip) {
        result = -result;
    }

    // 11. Convert result back to original input format if needed
    if (input_fraction_bits != kOutputFractionBits) {
        if (input_fraction_bits < kOutputFractionBits) {
            result >>= (kOutputFractionBits - input_fraction_bits);
        } else {
            result <<= (input_fraction_bits - kOutputFractionBits);
        }
    }

    return result;
}

}  // namespace math::fp::detail