#pragma once

#include <stdint.h>
#include <array>

// Atan lookup table with 512 entries
// Covers the range [0,1] with values scaled by 2^63
// Generated with mpmath library at 100 digits fraction_bits

namespace math::fp::detail {
// Table maps x in [0,1] to atan(x)
// Values scaled by 2^63
inline constexpr std::array<int64_t, 513> kAtanLut = {
    0x0000000000000000LL,  // atan(0.000000000) = 0.000000000000000000
    0x003FFFFAAAAB7777LL,  // atan(0.001953125) = 0.001953122516478819
    0x007FFFD5556EEEDCLL,  // atan(0.003906250) = 0.003906230131966972
    0x00BFFF7000C2652DLL,  // atan(0.005859375) = 0.005859307946155889
    0x00FFFEAAADDDD4B9LL,  // atan(0.007812500) = 0.007812341060101111
    0x013FFD655F1929BDLL,  // atan(0.009765625) = 0.009765314576904154
    0x017FFB80184C309ALL,  // atan(0.011718750) = 0.011718213602394129
    0x01BFF8DADF2E78C4LL,  // atan(0.013671875) = 0.013671023245809065
    0x01FFF555BBB729ABLL,  // atan(0.015625000) = 0.015623728620476831
    0x023FF0D0B87CC6C6LL,  // atan(0.017578125) = 0.017576314844495587
    0x027FEB2BE314DFF6LL,  // atan(0.019531250) = 0.019528767041413708
    0x02BFE4474C73AB7FLL,  // atan(0.021484375) = 0.021481070340909056
    0x02FFDC03094B86B5LL,  // atan(0.023437500) = 0.023433209879467586
    0x033FD23F326C5AB3LL,  // atan(0.025390625) = 0.025385170801061140
    0x037FC6DBE522E238LL,  // atan(0.027343750) = 0.027336938257824413
    0x03BFB9B94397CDF8LL,  // atan(0.029296875) = 0.029288497410730974
    0x03FFAAB7752EC495LL,  // atan(0.031250000) = 0.031239833430268277
    0x043F99B6A6E53B77LL,  // atan(0.033203125) = 0.033190931497111595
    0x047F86970BB125D8LL,  // atan(0.035156250) = 0.035141776802796780
    0x04BF7138DCDF772ELL,  // atan(0.037109375) = 0.037092354550391816
    0x04FF597C5A727645LL,  // atan(0.039062500) = 0.039042649955166993
    0x053F3F41CB7FDE56LL,  // atan(0.041015625) = 0.040992648245263781
    0x057F22697E8ECB52LL,  // atan(0.042968750) = 0.042942334662362171
    0x05BF02D3C9F56EC2LL,  // atan(0.044921875) = 0.044891694462346497
    0x05FEE0610C368A7ELL,  // atan(0.046875000) = 0.046840712915969654
    0x063EBAF1AC5EAE9ALL,  // atan(0.048828125) = 0.048789375309515617
    0x067E92661A6137D3LL,  // atan(0.050781250) = 0.050737666945460218
    0x06BE669ECF750BDALL,  // atan(0.052734375) = 0.052685573143130042
    0x06FE377C4E7110E7LL,  // atan(0.054687500) = 0.054633079239359478
    0x073E04DF24285DDELL,  // atan(0.056640625) = 0.056580170589145710
    0x077DCEA7E7C6207DLL,  // atan(0.058593750) = 0.058526832566301770
    0x07BD94B73B2936FALL,  // atan(0.060546875) = 0.060473050564107317
    0x07FD56EDCB3F7A71LL,  // atan(0.062500000) = 0.062418809995957350
    0x083D152C5060B7A5LL,  // atan(0.064453125) = 0.064364096296008574
    0x087CCF538EA9537BLL,  // atan(0.066406250) = 0.066308894919823488
    0x08BC8544565498B8LL,  // atan(0.068359375) = 0.068253191345011968
    0x08FC36DF8416AC6FLL,  // atan(0.070312500) = 0.070196971071870520
    0x093BE406017626B0LL,  // atan(0.072265625) = 0.072140219624018800
    0x097B8C98C5254D01LL,  // atan(0.074218750) = 0.074082922549033731
    0x09BB3078D35AEC20LL,  // atan(0.076171875) = 0.076025065419080717
    0x09FACF873E2ACEB5LL,  // atan(0.078125000) = 0.077966633831542301
    0x0A3A69A525DDCE7DLL,  // atan(0.080078125) = 0.079907613409643877
    0x0A79FEB3B9497D90LL,  // atan(0.082031250) = 0.081847989803076546
    0x0AB98E9436276561LL,  // atan(0.083984375) = 0.083787748688617089
    0x0AF91927E96BD931LL,  // atan(0.085937500) = 0.085726875770744809
    0x0B389E502F9C5986LL,  // atan(0.087890625) = 0.087665356782255441
    0x0B781DEE75258676LL,  // atan(0.089843750) = 0.089603177484871746
    0x0BB797E436B09E6FLL,  // atan(0.091796875) = 0.091540323669851056
    0x0BF70C1301788746LL,  // atan(0.093750000) = 0.093476781158589470
    0x0C367A5C739E5F44LL,  // atan(0.095703125) = 0.095412535803222717
    0x0C75E2A23C7D9417LL,  // atan(0.097656250) = 0.097347573487223671
    0x0CB544C61CFF7D5CLL,  // atan(0.099609375) = 0.099281880125996411
    0x0CF4A0A9E7EE78B4LL,  // atan(0.101562500) = 0.101215441667466668
    0x0D33F62F82488533LL,  // atan(0.103515625) = 0.103148244092668900
    0x0D734538E3915C1CLL,  // atan(0.105468750) = 0.105080273416329528
    0x0DB28DA8162404C7LL,  // atan(0.107421875) = 0.107011515687446629
    0x0DF1CF5F3783E1BELL,  // atan(0.109375000) = 0.108941956989865793
    0x0E310A4078AD34F1LL,  // atan(0.111328125) = 0.110871583442852334
    0x0E703E2E1E651911LL,  // atan(0.113281250) = 0.112800381201659389
    0x0EAF6B0A8188EE1ELL,  // atan(0.115234375) = 0.114728336458092384
    0x0EEE90B80F5D3732LL,  // atan(0.117187500) = 0.116655435441069349
    0x0F2DAF1949DBE79DLL,  // atan(0.119140625) = 0.118581664417177310
    0x0F6CC610C8021D7BLL,  // atan(0.121093750) = 0.120507009691224562
    0x0FABD581361D47E3LL,  // atan(0.123046875) = 0.122431457606788863
    0x0FEADD4D5617B6E3LL,  // atan(0.125000000) = 0.124354994546761438
    0x1029DD57FFC4936ELL,  // atan(0.126953125) = 0.126277606933886760
    0x1068D584212B3D98LL,  // atan(0.128906250) = 0.128199281231298146
    0x10A7C5B4BED20F3ELL,  // atan(0.130859375) = 0.130120003943048762
    0x10E6ADCCF408818ALL,  // atan(0.132812500) = 0.132039761614638762
    0x11258DAFF330B38CLL,  // atan(0.134765625) = 0.133958540833537421
    0x116465410608505ALL,  // atan(0.136718750) = 0.135876328229701304
    0x11A334638DF0D305LL,  // atan(0.138671875) = 0.137793110476087749
    0x11E1FAFB043726E4LL,  // atan(0.140625000) = 0.139708874289163648
    0x1220B8EAFA5AA29BLL,  // atan(0.142578125) = 0.141623606429409937
    0x125F6E171A535C5FLL,  // atan(0.144531250) = 0.143537293701821222
    0x129E1A6326D7D5FELL,  // atan(0.146484375) = 0.145449922956400968
    0x12DCBDB2FBA1FF31LL,  // atan(0.148437500) = 0.147361481088651630
    0x131B57EA8DB38CD4LL,  // atan(0.150390625) = 0.149271955040060439
    0x1359E8EDEB99A396LL,  // atan(0.152343750) = 0.151181331798580065
    0x139870A13DAFD4D9LL,  // atan(0.154296875) = 0.153089598399104659
    0x13D6EEE8C6626C58LL,  // atan(0.156250000) = 0.154996741923940973
    0x141563A8E2700D60LL,  // atan(0.158203125) = 0.156902749503274569
    0x1453CEC6092A9E47LL,  // atan(0.160156250) = 0.158807608315631066
    0x14923024CCB780F5LL,  // atan(0.162109375) = 0.160711305588332493
    0x14D087A9DA4F1747LL,  // atan(0.164062500) = 0.162613828597948568
    0x150ED539FA7B922ALL,  // atan(0.166015625) = 0.164515164670743064
    0x154D18BA11570A46LL,  // atan(0.167968750) = 0.166415301183114928
    0x158B520F1EC8E128LL,  // atan(0.169921875) = 0.168314225562034486
    0x15C9811E3EC269DFLL,  // atan(0.171875000) = 0.170211925285474408
    0x1607A5CCA97AD7F8LL,  // atan(0.173828125) = 0.172108387882835556
    0x1645BFFFB3AA73F0LL,  // atan(0.175781250) = 0.174003600935367708
    0x1683CF9CCEC5140FLL,  // atan(0.177734375) = 0.175897552076584973
    0x16C1D4898933D8DALL,  // atan(0.179687500) = 0.177790228992676075
    0x16FFCEAB8E8E2C20LL,  // atan(0.181640625) = 0.179681619422909278
    0x173DBDE8A7D201D4LL,  // atan(0.183593750) = 0.181571711160032179
    0x177BA226BB9B59E1LL,  // atan(0.185546875) = 0.183460492050666002
    0x17B97B4BCE5B0226LL,  // atan(0.187500000) = 0.185347949995694761
    0x17F7493E028C97E3LL,  // atan(0.189453125) = 0.187234072950648978
    0x18350BE398EBC7D4LL,  // atan(0.191406250) = 0.189118848926083993
    0x1872C322F0A8CC4FLL,  // atan(0.193359375) = 0.191002265987953002
    0x18B06EE2879C28BBLL,  // atan(0.195312500) = 0.192884312257974672
    0x18EE0F08FA79A1C7LL,  // atan(0.197265625) = 0.194764975913995164
    0x192BA37D050271BCLL,  // atan(0.199218750) = 0.196644245190345013
    0x19692C258236B869LL,  // atan(0.201171875) = 0.198522108378190287
    0x19A6A8E96C86261CLL,  // atan(0.203125000) = 0.200398553825878512
    0x19E419AFDDFFE133LL,  // atan(0.205078125) = 0.202273569939278836
    0x1A217E601081A5BCLL,  // atan(0.207031250) = 0.204147145182117018
    0x1A5ED6E15DE61ED3LL,  // atan(0.208984375) = 0.206019268076304635
    0x1A9C231B40327943LL,  // atan(0.210937500) = 0.207889927202262986
    0x1AD962F551C32F18LL,  // atan(0.212890625) = 0.209759111199241371
    0x1B1696574D780BCFLL,  // atan(0.214843750) = 0.211626808765629781
    0x1B53BD290EDF68D1LL,  // atan(0.216796875) = 0.213493008659266154
    0x1B90D7529260A204LL,  // atan(0.218750000) = 0.215357699697738048
    0x1BCDE4BBF565C223LL,  // atan(0.220703125) = 0.217220870758678741
    0x1C0AE54D768466BELL,  // atan(0.222656250) = 0.219082510780057776
    0x1C47D8EF75A5DBADLL,  // atan(0.224609375) = 0.220942608760465897
    0x1C84BF8A742E6DCDLL,  // atan(0.226562500) = 0.222801153759394521
    0x1CC199071523F502LL,  // atan(0.228515625) = 0.224658134897509548
    0x1CFE654E1D539551LL,  // atan(0.230468750) = 0.226513541356919618
    0x1D3B24487376B71DLL,  // atan(0.232421875) = 0.228367362381438815
    0x1D77D5DF20573671LL,  // atan(0.234375000) = 0.230219587276843718
    0x1DB479FB4EF2C973LL,  // atan(0.236328125) = 0.232070205411125025
    0x1DF110864C9D9DF5LL,  // atan(0.238281250) = 0.233919206214733444
    0x1E2D996989242E46LL,  // atan(0.240234375) = 0.235766579180820057
    0x1E6A148E96EC4D61LL,  // atan(0.242187500) = 0.237612313865471242
    0x1EA681DF2B156A93LL,  // atan(0.244140625) = 0.239456399887937849
    0x1EE2E1451D980CCCLL,  // atan(0.246093750) = 0.241298826930858828
    0x1F1F32AA696485CCLL,  // atan(0.248046875) = 0.243139584740479531
    0x1F5B75F92C80DD62LL,  // atan(0.250000000) = 0.244978663126864143
    0x1F97AB1BA825F507LL,  // atan(0.251953125) = 0.246816051964102862
    0x1FD3D1FC40DBE413LL,  // atan(0.253906250) = 0.248651741190513254
    0x200FEA857E958CE4LL,  // atan(0.255859375) = 0.250485720808836354
    0x204BF4A20CCB6B4CLL,  // atan(0.257812500) = 0.252317980886427207
    0x2087F03CBA959CA5LL,  // atan(0.259765625) = 0.254148511555439494
    0x20C3DD407AC521EALL,  // atan(0.261718750) = 0.255977303013005530
    0x20FFBB9863FC5C4DLL,  // atan(0.263671875) = 0.257804345521409739
    0x213B8B2FB0C6C4B1LL,  // atan(0.265625000) = 0.259629629408257512
    0x21774BF1BFAFDE8BLL,  // atan(0.267578125) = 0.261453145066638137
    0x21B2FDCA135966A3LL,  // atan(0.269531250) = 0.263274882955282397
    0x21EEA0A45290BE42LL,  // atan(0.271484375) = 0.265094833598714830
    0x222A346C48639359LL,  // atan(0.273437500) = 0.266912987587400452
    0x2265B90DE433C62FLL,  // atan(0.275390625) = 0.268729335577886086
    0x22A12E7539CA8D43LL,  // atan(0.277343750) = 0.270543868292936585
    0x22DC948E816AD7E5LL,  // atan(0.279296875) = 0.272356576521665117
    0x2317EB4617E2F04CLL,  // atan(0.281250000) = 0.274167451119658789
    0x235332887E9D5DC2LL,  // atan(0.283203125) = 0.275976483009098439
    0x238E6A425BB107A0LL,  // atan(0.285156250) = 0.277783663178873264
    0x23C9926079F099D7LL,  // atan(0.287109375) = 0.279588982684690290
    0x2404AACFC8F92BB9LL,  // atan(0.289062500) = 0.281392432649178459
    0x243FB37D5D4029DCLL,  // atan(0.291015625) = 0.283194004261987431
    0x247AAC56702083C7LL,  // atan(0.292968750) = 0.284993688779881293
    0x24B595485FE71E51LL,  // atan(0.294921875) = 0.286791477526826932
    0x24F06E40AFDE8B7CLL,  // atan(0.296875000) = 0.288587361894077410
    0x252B372D085A08A8LL,  // atan(0.298828125) = 0.290381333340249848
    0x2565EFFB36BFC405LL,  // atan(0.300781250) = 0.292173383391398755
    0x25A098992D926A1BLL,  // atan(0.302734375) = 0.293963503641083534
    0x25DB30F50479FC6ELL,  // atan(0.304687500) = 0.295751685750431537
    0x2615B8FCF84BF210LL,  // atan(0.306640625) = 0.297537921448195741
    0x2650309F6B12A32BLL,  // atan(0.308593750) = 0.299322202530807435
    0x268A97CAE4140077LL,  // atan(0.310546875) = 0.301104520862423897
    0x26C4EE6E0FD7979ALL,  // atan(0.312500000) = 0.302884868374971417
    0x26FF3477C02BE574LL,  // atan(0.314453125) = 0.304663237068182713
    0x273969D6EC2AF768LL,  // atan(0.316406250) = 0.306439619009630126
    0x27738E7AB03E5CA5LL,  // atan(0.318359375) = 0.308214006334753488
    0x27ADA2524E226889LL,  // atan(0.320312500) = 0.309986391246883430
    0x27E7A54D2CE8C729LL,  // atan(0.322265625) = 0.311756766017259546
    0x2821975AD8FA6527LL,  // atan(0.324218750) = 0.313525122985043925
    0x285B786B0418ABE8LL,  // atan(0.326171875) = 0.315291454557330098
    0x2895486D855E1351LL,  // atan(0.328125000) = 0.317055753209147029
    0x28CF0752593E0A33LL,  // atan(0.330078125) = 0.318818011483458286
    0x2908B509A184368FLL,  // atan(0.332031250) = 0.320578221991156986
    0x29425183A5530EDBLL,  // atan(0.333984375) = 0.322336377411055641
    0x297BDCB0D121CD86LL,  // atan(0.335937500) = 0.324092470489871720
    0x29B55681B6B9BFE7LL,  // atan(0.337890625) = 0.325846494042208334
    0x29EEBEE70D32F1CDLL,  // atan(0.339843750) = 0.327598440950530867
    0x2A2815D1B0F036F8LL,  // atan(0.341796875) = 0.329348304165138550
    0x2A615B32A39A93B6LL,  // atan(0.343750000) = 0.331096076704132103
    0x2A9A8EFB0C1C05DELL,  // atan(0.345703125) = 0.332841751653376317
    0x2AD3B11C3699AF80LL,  // atan(0.347656250) = 0.334585322166458976
    0x2B0CC187946D6482LL,  // atan(0.349609375) = 0.336326781464644786
    0x2B45C02EBC1E9C89LL,  // atan(0.351562500) = 0.338066122836825467
    0x2B7EAD03695ACA68LL,  // atan(0.353515625) = 0.339803339639465130
    0x2BB787F77CED1A7ALL,  // atan(0.355468750) = 0.341538425296541714
    0x2BF050FCFCB5992FLL,  // atan(0.357421875) = 0.343271373299484150
    0x2C290806139FC32CLL,  // atan(0.359375000) = 0.345002177207105132
    0x2C61AD0511988050LL,  // atan(0.361328125) = 0.346730830645530119
    0x2C9A3FEC6B838B02LL,  // atan(0.363281250) = 0.348457327308122067
    0x2CD2C0AEBB30451FLL,  // atan(0.365234375) = 0.350181660955401763
    0x2D0B2F3EBF4DFBEDLL,  // atan(0.367187500) = 0.351903825414964788
    0x2D438B8F5B5F9C7CLL,  // atan(0.369140625) = 0.353623814581394025
    0x2D7BD59397AED9CBLL,  // atan(0.371093750) = 0.355341622416168346
    0x2DB40D3EA13EC625LL,  // atan(0.373046875) = 0.357057242947567299
    0x2DEC3283C9BDE11CLL,  // atan(0.375000000) = 0.358770670270572245
    0x2E24455687779B8ELL,  // atan(0.376953125) = 0.360481898546763158
    0x2E5C45AA75455313LL,  // atan(0.378906250) = 0.362190922004212212
    0x2E943373527EC65DLL,  // atan(0.380859375) = 0.363897734937373041
    0x2ECC0EA502EA03E2LL,  // atan(0.382812500) = 0.365602331706966877
    0x2F03D7338EAAD446LL,  // atan(0.384765625) = 0.367304706739864373
    0x2F3B8D132231A206LL,  // atan(0.386718750) = 0.369004854528964421
    0x2F7330380E29DFC4LL,  // atan(0.388671875) = 0.370702769633068918
    0x2FAAC096C767EEB4LL,  // atan(0.390625000) = 0.372398446676754202
    0x2FE23E23E6D686A5LL,  // atan(0.392578125) = 0.374091880350239048
    0x3019A8D42963A10CLL,  // atan(0.394531250) = 0.375783065409248940
    0x3051009C6FECE89FLL,  // atan(0.396484375) = 0.377471996674876964
    0x30884571BF2BAEEBLL,  // atan(0.398437500) = 0.379158669033441809
    0x30BF77493FA0695DLL,  // atan(0.400390625) = 0.380843077436341659
    0x30F696183D7DB749LL,  // atan(0.402343750) = 0.382525216899905152
    0x312DA1D42892F255LL,  // atan(0.404296875) = 0.384205082505239270
    0x31649A7294364ADBLL,  // atan(0.406250000) = 0.385882669398073752
    0x319B7FE9372E71A8LL,  // atan(0.408203125) = 0.387557972788602323
    0x31D2522DEB9BD0A6LL,  // atan(0.410156250) = 0.389230987951320717
    0x32091136AEE153E5LL,  // atan(0.412109375) = 0.390901710224862087
    0x323FBCF9A18CC488LL,  // atan(0.414062500) = 0.392570135011828580
    0x3276556D073EB70ALL,  // atan(0.416015625) = 0.394236257778620702
    0x32ACDA8746920E66LL,  // atan(0.417968750) = 0.395900074055262896
    0x32E34C3EE9031590LL,  // atan(0.419921875) = 0.397561579435227130
    0x3319AA8A9AD630CFLL,  // atan(0.421875000) = 0.399220769575252543
    0x334FF5612AFE2867LL,  // atan(0.423828125) = 0.400877640195163254
    0x33862CB98B020E1BLL,  // atan(0.425781250) = 0.402532187077682513
    0x33BC508ACEE2BF00LL,  // atan(0.427734375) = 0.404184406068244684
    0x33F260CC2D00031BLL,  // atan(0.429687500) = 0.405834293074804120
    0x34285D74FDFD4C56LL,  // atan(0.431640625) = 0.407481844067641652
    0x345E467CBCA61630LL,  // atan(0.433593750) = 0.409127055079168300
    0x34941BDB05D1E7BFLL,  // atan(0.435546875) = 0.410769922203726212
    0x34C9DD879847F96DLL,  // atan(0.437500000) = 0.412410441597387323
    0x34FF8B7A54A27FF5LL,  // atan(0.439453125) = 0.414048609477749352
    0x353525AB3D319E12LL,  // atan(0.441406250) = 0.415684422123729413
    0x356AAC1275DDFE65LL,  // atan(0.443359375) = 0.417317875875355015
    0x35A01EA8440B16FELL,  // atan(0.445312500) = 0.418948967133552841
    0x35D57D650E791810LL,  // atan(0.447265625) = 0.420577692359935140
    0x360AC8415D268736LL,  // atan(0.449218750) = 0.422204048076583627
    0x363FFF35D93188CELL,  // atan(0.451171875) = 0.423828030865831318
    0x3675223B4CB8D8D7LL,  // atan(0.453125000) = 0.425449637370042266
    0x36AA314AA2BC74C3LL,  // atan(0.455078125) = 0.427068864291388572
    0x36DF2C5CE6FDF7C6LL,  // atan(0.457031250) = 0.428685708391625786
    0x3714136B45E0AAF1LL,  // atan(0.458984375) = 0.430300166491865810
    0x3748E66F0C494AA8LL,  // atan(0.460937500) = 0.431912235472348194
    0x377DA561A77D82DALL,  // atan(0.462890625) = 0.433521912272208765
    0x37B2503CA503235ALL,  // atan(0.464843750) = 0.435129193889246868
    0x37E6E6F9B27F0DE4LL,  // atan(0.466796875) = 0.436734077379690111
    0x381B69929D93DF19LL,  // atan(0.468750000) = 0.438336559857957830
    0x384FD80153C053F8LL,  // atan(0.470703125) = 0.439936638496421950
    0x3884323FE23D6D27LL,  // atan(0.472656250) = 0.441534310525166729
    0x38B8784875DC517FLL,  // atan(0.474609375) = 0.443129573231746010
    0x38ECAA155AE3F145LL,  // atan(0.476562500) = 0.444722423960939361
    0x3920C7A0FCEE6B60LL,  // atan(0.478515625) = 0.446312860114505994
    0x3954D0E5E6C63606LL,  // atan(0.480468750) = 0.447900879150937292
    0x3988C5DEC2430C2DLL,  // atan(0.482421875) = 0.449486478585207627
    0x39BCA6865826A12ELL,  // atan(0.484375000) = 0.451069655988523499
    0x39F072D78FF91BECLL,  // atan(0.486328125) = 0.452650408988071074
    0x3A242ACD6FE55ADFLL,  // atan(0.488281250) = 0.454228735266762496
    0x3A57CE631C950258LL,  // atan(0.490234375) = 0.455804632562980372
    0x3A8B5D93D90C5662LL,  // atan(0.492187500) = 0.457378098670320810
    0x3ABED85B0685E180LL,  // atan(0.494140625) = 0.458949131437335345
    0x3AF23EB4244DE9AFLL,  // atan(0.496093750) = 0.460517728767271095
    0x3B25909ACF9DB4F7LL,  // atan(0.498046875) = 0.462083888617809913
    0x3B58CE0AC3769ED1LL,  // atan(0.500000000) = 0.463647609000806094
    0x3B8BF6FFD87CFFBDLL,  // atan(0.501953125) = 0.465208887982022645
    0x3BBF0B7604D2E850LL,  // atan(0.503906250) = 0.466767723680866498
    0x3BF20B695BF2B0FCLL,  // atan(0.505859375) = 0.468324114270122660
    0x3C24F6D60E895FDALL,  // atan(0.507812500) = 0.469878057975686936
    0x3C57CDB86A50E5CALL,  // atan(0.509765625) = 0.471429553076297470
    0x3C8A900CD9EA3413LL,  // atan(0.511718750) = 0.472978597903265574
    0x3CBD3DCFE4B72BD5LL,  // atan(0.513671875) = 0.474525190840205169
    0x3CEFD6FE2EB46887LL,  // atan(0.515625000) = 0.476069330322761219
    0x3D225B947852E6B6LL,  // atan(0.517578125) = 0.477611014838337400
    0x3D54CB8F9E51884BLL,  // atan(0.519531250) = 0.479150242925822534
    0x3D8726EC99967780LL,  // atan(0.521484375) = 0.480687013175316258
    0x3DB96DA87F0869C0LL,  // atan(0.523437500) = 0.482221324227853743
    0x3DEB9FC07F67C3ADLL,  // atan(0.525390625) = 0.483753174775129691
    0x3E1DBD31E7279F68LL,  // atan(0.527343750) = 0.485282563559221281
    0x3E4FC5FA1E46B658LL,  // atan(0.529296875) = 0.486809489372310444
    0x3E81BA16A8282F97LL,  // atan(0.531250000) = 0.488333951056405535
    0x3EB39985236C5428LL,  // atan(0.533203125) = 0.489855947503061828
    0x3EE5644349C92A29LL,  // atan(0.535156250) = 0.491375477653101911
    0x3F171A4EEFE2F80CLL,  // atan(0.537109375) = 0.492892540496334908
    0x3F48BBA60524B11ALL,  // atan(0.539062500) = 0.494407135071275372
    0x3F7A484693984C40LL,  // atan(0.541015625) = 0.495919260464861344
    0x3FABC02EBFBF064ELL,  // atan(0.542968750) = 0.497428915812172245
    0x3FDD235CC86990C7LL,  // atan(0.544921875) = 0.498936100296145657
    0x400E71CF06902E4CLL,  // atan(0.546875000) = 0.500440813147294161
    0x403FAB83ED2ABDC3LL,  // atan(0.548828125) = 0.501943053643420956
    0x4070D07A0908B53DLL,  // atan(0.550781250) = 0.503442821109336358
    0x40A1E0B000A90DBALL,  // atan(0.552734375) = 0.504940114916572091
    0x40D2DC24941220C7LL,  // atan(0.554687500) = 0.506434934483096733
    0x4103C2D69CA97912LL,  // atan(0.556640625) = 0.507927279273029830
    0x413494C50D0B96E3LL,  // atan(0.558593750) = 0.509417148796356356
    0x416551EEF0E3A999LL,  // atan(0.560546875) = 0.510904542608640044
    0x4195FA536CC33F15LL,  // atan(0.562500000) = 0.512389460310737732
    0x41C68DF1BDF9EA25LL,  // atan(0.564453125) = 0.513871901548511700
    0x41F70CC93A6CE0DBLL,  // atan(0.566406250) = 0.515351866012543347
    0x422776D9506E93D8LL,  // atan(0.568359375) = 0.516829353437846195
    0x4257CC2186963F76LL,  // atan(0.570312500) = 0.518304363603578011
    0x42880CA17B9777CELL,  // atan(0.572265625) = 0.519776896332753813
    0x42B83858E619B083LL,  // atan(0.574218750) = 0.521246951491958210
    0x42E84F47948FC151LL,  // atan(0.576171875) = 0.522714528991057747
    0x4318516D6D0F6832LL,  // atan(0.578125000) = 0.524179628782913243
    0x43483ECA6D28CA1FLL,  // atan(0.580078125) = 0.525642250863091909
    0x4378175EA9BDF33ELL,  // atan(0.582031250) = 0.527102395269579582
    0x43A7DB2A4EDA576BLL,  // atan(0.583984375) = 0.528560062082493287
    0x43D78A2D9F8A5400LL,  // atan(0.585937500) = 0.530015251423793132
    0x44072468F5B2B3B3LL,  // atan(0.587890625) = 0.531467963456994874
    0x4436A9DCC1E83569LL,  // atan(0.589843750) = 0.532918198386882147
    0x44661A898B4716DBLL,  // atan(0.591796875) = 0.534365956459219360
    0x4495766FEF4AA3DALL,  // atan(0.593750000) = 0.535811237960463704
    0x44C4BD90A1A4CB18LL,  // atan(0.595703125) = 0.537254043217478716
    0x44F3EFEC6C15B931LL,  // atan(0.597656250) = 0.538694372597246618
    0x45230D842E437ACDLL,  // atan(0.599609375) = 0.540132226506582103
    0x45521658DD91A6B4LL,  // atan(0.601562500) = 0.541567605391845008
    0x45810A6B84F9107FLL,  // atan(0.603515625) = 0.543000509738654547
    0x45AFE9BD44DF84CBLL,  // atan(0.605468750) = 0.544430940071603087
    0x45DEB44F52EF8F9DLL,  // atan(0.607421875) = 0.545858896953970163
    0x460D6A22F9F04DC6LL,  // atan(0.609375000) = 0.547284380987436925
    0x463C0B39999D49F8LL,  // atan(0.611328125) = 0.548707392811801364
    0x466A9794A67E6659LL,  // atan(0.613281250) = 0.550127933104693101
    0x46990F35A9BFD33ALL,  // atan(0.615234375) = 0.551546002581288719
    0x46C7721E410A13B7LL,  // atan(0.617187500) = 0.552961601994028329
    0x46F5C0501E5A10F2LL,  // atan(0.619140625) = 0.554374732132331349
    0x4723F9CD07D93C94LL,  // atan(0.621093750) = 0.555785393822313512
    0x47521E96D7B5C344LL,  // atan(0.623046875) = 0.557193587926503864
    0x47802EAF7BFACFCDLL,  // atan(0.625000000) = 0.558599315343562441
    0x47AE2A18F668DF85LL,  // atan(0.626953125) = 0.560002577007998603
    0x47DC10D55C4E28B6LL,  // atan(0.628906250) = 0.561403373889889368
    0x4809E2E6D65F1396LL,  // atan(0.630859375) = 0.562801706994598860
    0x4837A04FA08EC686LL,  // atan(0.632812500) = 0.564197577362497649
    0x4865491209E7C624LL,  // atan(0.634765625) = 0.565590986068683188
    0x4892DD307464A9D6LL,  // atan(0.636718750) = 0.566981934222700490
    0x48C05CAD54C8E56ELL,  // atan(0.638671875) = 0.568370422968263900
    0x48EDC78B3279A871LL,  // atan(0.640625000) = 0.569756453482978431
    0x491B1DCCA756D39FLL,  // atan(0.642578125) = 0.571140026978062765
    0x49485F745F940556LL,  // atan(0.644531250) = 0.572521144698072360
    0x49758C851991BD4ALL,  // atan(0.646484375) = 0.573899807920623561
    0x49A2A501A5B6983ALL,  // atan(0.648437500) = 0.575276017956117824
    0x49CFA8ECE648A419LL,  // atan(0.650390625) = 0.576649776147467041
    0x49FC9849CF46CD43LL,  // atan(0.652343750) = 0.578021083869819541
    0x4A29731B6642653CLL,  // atan(0.654296875) = 0.579389942530286750
    0x4A563964C238C37BLL,  // atan(0.656250000) = 0.580756353567670414
    0x4A82EB290B6D00CBLL,  // atan(0.658203125) = 0.582120318452190588
    0x4AAF886B7B41CDC2LL,  // atan(0.660156250) = 0.583481838685214860
    0x4ADC112F5C1364BDLL,  // atan(0.662109375) = 0.584840915798987671
    0x4B088578091197EBLL,  // atan(0.664062500) = 0.586197551356360647
    0x4B34E548EE19FBDDLL,  // atan(0.666015625) = 0.587551746950523923
    0x4B6130A587922F06LL,  // atan(0.667968750) = 0.588903504204738137
    0x4B8D679162423EB0LL,  // atan(0.669921875) = 0.590252824772067086
    0x4BB98A101B2F29C5LL,  // atan(0.671875000) = 0.591599710335111384
    0x4BE598255F7581EDLL,  // atan(0.673828125) = 0.592944162605743230
    0x4C1191D4EC242B60LL,  // atan(0.675781250) = 0.594286183324841288
    0x4C3D77228E173BE1LL,  // atan(0.677734375) = 0.595625774262026897
    0x4C69481221D2F940LL,  // atan(0.679687500) = 0.596962937215401501
    0x4C9504A7935EF7D9LL,  // atan(0.681640625) = 0.598297674011284419
    0x4CC0ACE6DE21595DLL,  // atan(0.683593750) = 0.599629986503951384
    0x4CEC40D40CBA2C65LL,  // atan(0.685546875) = 0.600959876575374863
    0x4D17C07338DEED10LL,  // atan(0.687500000) = 0.602287346134964152
    0x4D432BC88B36271ELL,  // atan(0.689453125) = 0.603612397119307476
    0x4D6E82D83B3339E3LL,  // atan(0.691406250) = 0.604935031491913966
    0x4D99C5A68EF23E5ELL,  // atan(0.693359375) = 0.606255251242957982
    0x4DC4F437DB140FD6LL,  // atan(0.695312500) = 0.607573058389022425
    0x4DF00E90829A7754LL,  // atan(0.697265625) = 0.608888454972845272
    0x4E1B14B4F6C47A48LL,  // atan(0.699218750) = 0.610201443063065230
    0x4E4606A9B6EACCA7LL,  // atan(0.701171875) = 0.611512024753969263
    0x4E70E473505C66DCLL,  // atan(0.703125000) = 0.612820202165241357
    0x4E9BAE165E3B3FD4LL,  // atan(0.705078125) = 0.614125977441711157
    0x4EC6639789592B68LL,  // atan(0.707031250) = 0.615429352753105063
    0x4EF104FB8814DD7ELL,  // atan(0.708984375) = 0.616730330293797091
    0x4F1B92471E37121ELL,  // atan(0.710937500) = 0.618028912282561849
    0x4F460B7F1CCFDAC4LL,  // atan(0.712890625) = 0.619325100962327180
    0x4F7070A86214112CLL,  // atan(0.714843750) = 0.620618898599929469
    0x4F9AC1C7D93AEFEALL,  // atan(0.716796875) = 0.621910307485868952
    0x4FC4FEE27A5BD0F6LL,  // atan(0.718750000) = 0.623199329934065904
    0x4FEF27FD4A4C1286LL,  // atan(0.720703125) = 0.624485968281618953
    0x50193D1D5A7D2255LL,  // atan(0.722656250) = 0.625770224888563154
    0x50433E47C8DAAFABLL,  // atan(0.724609375) = 0.627052102137630296
    0x506D2B81BFA9044FLL,  // atan(0.726562500) = 0.628331602434009651
    0x509704D07563849ALL,  // atan(0.728515625) = 0.629608728205109824
    0x50C0CA392C9B56ECLL,  // atan(0.730468750) = 0.630883481900321952
    0x50EA7BC133D632ADLL,  // atan(0.732421875) = 0.632155865990783661
    0x5114196DE56D5704LL,  // atan(0.734375000) = 0.633425882969144594
    0x513DA344A76CA98CLL,  // atan(0.736328125) = 0.634693535349332594
    0x5167194AEB71FD19LL,  // atan(0.738281250) = 0.635958825666321448
    0x51907B862E8C80D1LL,  // atan(0.740234375) = 0.637221756475899070
    0x51B9C9FBF91C57B1LL,  // atan(0.742187500) = 0.638482330354437577
    0x51E304B1DEB258B6LL,  // atan(0.744140625) = 0.639740549898663913
    0x520C2BAD7DEFF7CBLL,  // atan(0.746093750) = 0.640996417725432144
    0x52353EF48067579FLL,  // atan(0.748046875) = 0.642249936471496197
    0x525E3E8C9A7B8492LL,  // atan(0.750000000) = 0.643501108793284371
    0x52872A7B8B40D8CBLL,  // atan(0.751953125) = 0.644749937366674741
    0x52B002C71C5D89B2LL,  // atan(0.753906250) = 0.645996424886771559
    0x52D8C77521EA5ECDLL,  // atan(0.755859375) = 0.647240574067683205
    0x5301788B7A53923FLL,  // atan(0.757812500) = 0.648482387642300595
    0x532A16100E39DAEELL,  // atan(0.759765625) = 0.649721868362077681
    0x5352A008D053A078LL,  // atan(0.761718750) = 0.650959018996812411
    0x537B167BBD4E590ELL,  // atan(0.763671875) = 0.652193842334429119
    0x53A3796EDBB0114ALL,  // atan(0.765625000) = 0.653426341180761927
    0x53CBC8E83BB91E1DLL,  // atan(0.767578125) = 0.654656518359339579
    0x53F404EDF745F8EALL,  // atan(0.769531250) = 0.655884376711170836
    0x541C2D8631B145DCLL,  // atan(0.771484375) = 0.657109919094532313
    0x544442B717B60491LL,  // atan(0.773437500) = 0.658333148384755984
    0x546C4486DF51EB2CLL,  // atan(0.775390625) = 0.659554067474018679
    0x549432FBC7A7EBD5LL,  // atan(0.777343750) = 0.660772679271132701
    0x54BC0E1C18E2E4C6LL,  // atan(0.779296875) = 0.661988986701337656
    0x54E3D5EE24187AE4LL,  // atan(0.781250000) = 0.663202992706093286
    0x550B8A78432C1EF6LL,  // atan(0.783203125) = 0.664414700242873302
    0x55332BC0D8B23D8ALL,  // atan(0.785156250) = 0.665624112284960989
    0x555AB9CE4FD3998CLL,  // atan(0.787109375) = 0.666831231821245707
    0x558234A71C30D199LL,  // atan(0.789062500) = 0.668036061856020158
    0x55A99C51B9C61016LL,  // atan(0.791015625) = 0.669238605408779552
    0x55D0F0D4ACCEE615LL,  // atan(0.792968750) = 0.670438865514021431
    0x55F8323681AA510ALL,  // atan(0.794921875) = 0.671636845221046830
    0x561F607DCCBEEB50LL,  // atan(0.796875000) = 0.672832547593763208
    0x56467BB12A5F478CLL,  // atan(0.798828125) = 0.674025975710487169
    0x566D83D73EAE76E4LL,  // atan(0.800781250) = 0.675217132663749942
    0x569478F6B584BA1ALL,  // atan(0.802734375) = 0.676406021560102988
    0x56BB5B1642545D73LL,  // atan(0.804687500) = 0.677592645519925152
    0x56E22A3CA00EBF83LL,  // atan(0.806640625) = 0.678777007677231481
    0x5708E670910982CELL,  // atan(0.808593750) = 0.679959111179481934
    0x572F8FB8DEE3EA36LL,  // atan(0.810546875) = 0.681138959187392756
    0x5756261C5A6C6040LL,  // atan(0.812500000) = 0.682316554874748071
    0x577CA9A1DB86291CLL,  // atan(0.814453125) = 0.683491901428213255
    0x57A31A50410F3F7ALL,  // atan(0.816406250) = 0.684665002047148974
    0x57C9782E70C65C0BLL,  // atan(0.818359375) = 0.685835859943426551
    0x57EFC343573127C9LL,  // atan(0.820312500) = 0.687004478341245006
    0x5815FB95E78298DCLL,  // atan(0.822265625) = 0.688170860476948532
    0x583C212D1B817A24LL,  // atan(0.824218750) = 0.689335009598845860
    0x5862340FF36F1D59LL,  // atan(0.826171875) = 0.690496928967029855
    0x5888344575EE37B5LL,  // atan(0.828125000) = 0.691656621853199871
    0x58AE21D4AFE9E917LL,  // atan(0.830078125) = 0.692814091540483235
    0x58D3FCC4B47CED9DLL,  // atan(0.832031250) = 0.693969341323259825
    0x58F9C51C9CD8F993LL,  // atan(0.833984375) = 0.695122374506986551
    0x591F7AE3882E3FC2LL,  // atan(0.835937500) = 0.696273194408023599
    0x59451E209B9321F1LL,  // atan(0.837890625) = 0.697421804353461461
    0x596AAEDB01EC0BA1LL,  // atan(0.839843750) = 0.698568207680949960
    0x59902D19EBD376E7LL,  // atan(0.841796875) = 0.699712407738527054
    0x59B598E48F821B48LL,  // atan(0.843750000) = 0.700854407884450192
    0x59DAF24228B7469DLL,  // atan(0.845703125) = 0.701994211487028119
    0x5A003939F8A15FCELL,  // atan(0.847656250) = 0.703131821924453781
    0x5A256DD345C69364LL,  // atan(0.849609375) = 0.704267242584638908
    0x5A4A90155BEDA9D9LL,  // atan(0.851562500) = 0.705400476865049031
    0x5A6FA0078C070780LL,  // atan(0.853515625) = 0.706531528172540613
    0x5A949DB12C15D609LL,  // atan(0.855468750) = 0.707660399923198069
    0x5AB9891997195772LL,  // atan(0.857421875) = 0.708787095542173118
    0x5ADE62482CF66257LL,  // atan(0.859375000) = 0.709911618463524907
    0x5B0329445261078ELL,  // atan(0.861328125) = 0.711033972130060699
    0x5B27DE1570C660E0LL,  // atan(0.863281250) = 0.712154159993178659
    0x5B4C80C2F63688E4LL,  // atan(0.865234375) = 0.713272185512711099
    0x5B711154554EBBC8LL,  // atan(0.867187500) = 0.714388052156769038
    0x5B958FD10523A0F1LL,  // atan(0.869140625) = 0.715501763401587887
    0x5BB9FC40812BBD69LL,  // atan(0.871093750) = 0.716613322731374569
    0x5BDE56AA492A0EDFLL,  // atan(0.873046875) = 0.717722733638155308
    0x5C029F15E118CF39LL,  // atan(0.875000000) = 0.718829999621624527
    0x5C26D58AD114608DLL,  // atan(0.876953125) = 0.719935124188995523
    0x5C4AFA10A546615CLL,  // atan(0.878906250) = 0.721038110854851588
    0x5C6F0CAEEDD0E903LL,  // atan(0.880859375) = 0.722138963140998458
    0x5C930D6D3EB9EC32LL,  // atan(0.882812500) = 0.723237684576317874
    0x5CB6FC532FD6C953LL,  // atan(0.884765625) = 0.724334278696622258
    0x5CDAD9685CB7FCBBLL,  // atan(0.886718750) = 0.725428749044510712
    0x5CFEA4B46494FC8BLL,  // atan(0.888671875) = 0.726521099169225582
    0x5D225E3EEA383C17LL,  // atan(0.890625000) = 0.727611332626510676
    0x5D46060F93EB56BALL,  // atan(0.892578125) = 0.728699452978470275
    0x5D699C2E0B6361EELL,  // atan(0.894531250) = 0.729785463793429123
    0x5D8D20A1FDAD668FLL,  // atan(0.896484375) = 0.730869368645794326
    0x5DB093731B1B0119LL,  // atan(0.898437500) = 0.731951171115916566
    0x5DD3F4A9172F28C8LL,  // atan(0.900390625) = 0.733030874789954767
    0x5DF7444BA88B1D73LL,  // atan(0.902343750) = 0.734108483259739653
    0x5E1A826288DB7BFELL,  // atan(0.904296875) = 0.735184000122639847
    0x5E3DAEF574C57940LL,  // atan(0.906250000) = 0.736257428981428097
    0x5E60CA0C2BD44330LL,  // atan(0.908203125) = 0.737328773444149488
    0x5E83D3AE70668844LL,  // atan(0.910156250) = 0.738398037123989548
    0x5EA6CBE4079C24CELL,  // atan(0.912109375) = 0.739465223639144686
    0x5EC9B2B4B943F631LL,  // atan(0.914062500) = 0.740530336612692741
    0x5EEC88284FC9D3DALL,  // atan(0.916015625) = 0.741593379672464637
    0x5F0F4C469824ADBBLL,  // atan(0.917968750) = 0.742654356450917930
    0x5F31FF1761C4D038LL,  // atan(0.919921875) = 0.743713270585010466
    0x5F54A0A27E824D56LL,  // atan(0.921875000) = 0.744770125716075149
    0x5F7730EFC28B8AFCLL,  // atan(0.923828125) = 0.745824925489696589
    0x5F99B0070453F637LL,  // atan(0.925781250) = 0.746877673555587540
    0x5FBC1DF01C82DB38LL,  // atan(0.927734375) = 0.747928373567467442
    0x5FDE7AB2E5E261FDLL,  // atan(0.929687500) = 0.748977029182941401
    0x6000C6573D4EAF78LL,  // atan(0.931640625) = 0.750023644063380512
    0x602300E501A52AFFLL,  // atan(0.933593750) = 0.751068221873802400
    0x60452A6413B3E7E6LL,  // atan(0.935546875) = 0.752110766282753973
    0x606742DC56293320LL,  // atan(0.937500000) = 0.753151280962194414
    0x60894A55AD8344A8LL,  // atan(0.939453125) = 0.754189769587379044
    0x60AB40D8000014A2LL,  // atan(0.941406250) = 0.755226235836744864
    0x60CD266B358D53F8LL,  // atan(0.943359375) = 0.756260683391796307
    0x60EEFB1737B8884CLL,  // atan(0.945312500) = 0.757293115936992445
    0x6110BEE3F19F4B1FLL,  // atan(0.947265625) = 0.758323537159635186
    0x613271D94FDFABF3LL,  // atan(0.949218750) = 0.759351950749758031
    0x615413FF4088B54DLL,  // atan(0.951171875) = 0.760378360400016384
    0x6175A55DB30B145ALL,  // atan(0.953125000) = 0.761402769805578417
    0x619725FC9829E321LL,  // atan(0.955078125) = 0.762425182664016821
    0x61B895E3E1EB9502LL,  // atan(0.957031250) = 0.763445602675201784
    0x61D9F51B838B056BLL,  // atan(0.958984375) = 0.764464033541195076
    0x61FB43AB7168A885LL,  // atan(0.960937500) = 0.765480478966144462
    0x621C819BA0FBDDB8LL,  // atan(0.962890625) = 0.766494942656179457
    0x623DAEF408C463D9LL,  // atan(0.964843750) = 0.767507428319308294
    0x625ECBBCA03BEED5LL,  // atan(0.966796875) = 0.768517939665315009
    0x627FD7FD5FC7DEAALL,  // atan(0.968750000) = 0.769526480405658297
    0x62A0D3BE40AB1789LL,  // atan(0.970703125) = 0.770533054253370819
    0x62C1BF073CF7FAF0LL,  // atan(0.972656250) = 0.771537664922959610
    0x62E299E04F82818BLL,  // atan(0.974609375) = 0.772540316130307048
    0x6303645173D275BELL,  // atan(0.976562500) = 0.773541011592573491
    0x63241E62A615CE9CLL,  // atan(0.978515625) = 0.774539755028099908
    0x6344C81BE3132B27LL,  // atan(0.980468750) = 0.775536550156311733
    0x63656185281C6DACLL,  // atan(0.982421875) = 0.776531400697624163
    0x6385EAA673017709LL,  // atan(0.984375000) = 0.777524310373347793
    0x63A66387C20301BBLL,  // atan(0.986328125) = 0.778515282905594574
    0x63C6CC3113C59C77LL,  // atan(0.988281250) = 0.779504322017186335
    0x63E724AA6744C433LL,  // atan(0.990234375) = 0.780491431431562188
    0x64076CFBBBC61D68LL,  // atan(0.992187500) = 0.781476614872688269
    0x6427A52D10CCCC5ALL,  // atan(0.994140625) = 0.782459876064967808
    0x6447CD46660CEC4ELL,  // atan(0.996093750) = 0.783441218733151756
    0x6467E54FBB5F2569LL,  // atan(0.998046875) = 0.784420646602250859
    0x6487ED5110B4611ALL   // atan(1.000000000) = 0.785398163397448279
};

// Lookup atan(x) with linear interpolation between table entries
inline constexpr auto LookupAtan(int64_t x, int fraction_bits) noexcept -> int64_t {
    // Ensure x is in [0,1] range scaled by 2^fraction_bits
    if (x <= 0)
        return 0;
    
    const int64_t one = static_cast<int64_t>(1) << fraction_bits;
    if (x >= one)
        return kAtanLut[kAtanLut.size() - 1] >> (63 - fraction_bits);
    
    // Scale x to table index
    const int64_t scale = static_cast<int64_t>(kAtanLut.size() - 1);
    const int64_t idx_scaled = (x * scale) >> fraction_bits;
    const int index = static_cast<int>(idx_scaled);
    
    // Get table values for interpolation
    const int64_t y0 = kAtanLut[index];
    const int64_t y1 = kAtanLut[index + 1];
    
    // Calculate fractional part for interpolation (keeping fraction_bits)
    const int64_t frac = (x * scale) - (idx_scaled << fraction_bits);
    
    // Linear interpolation
    int64_t result = y0 + ((y1 - y0) * frac >> fraction_bits);
    
    // Return scaled to requested fraction_bits
    return result >> (63 - fraction_bits);
}

}  // namespace math::fp::detail